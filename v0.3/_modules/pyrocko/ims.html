

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pyrocko.ims &mdash; Pyrocko v0.3 Manual</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Pyrocko v0.3 Manual"
          href="../../_static/opensearch.xml"/>
    <link rel="top" title="Pyrocko v0.3 Manual" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">Pyrocko v0.3 Manual</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
          <div class="body">
            
  <h1>Source code for pyrocko.ims</h1><div class="highlight"><pre>
<span class="sd">&#39;&#39;&#39;Module to read and write GSE2.0, GSE2.1, and IMS1.0 files.&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">from</span> <span class="nn">pyrocko</span> <span class="kn">import</span> <span class="n">util</span>
<span class="kn">from</span> <span class="nn">pyrocko.io_common</span> <span class="kn">import</span> <span class="n">FileLoadError</span><span class="p">,</span> <span class="n">FileSaveError</span>
<span class="kn">from</span> <span class="nn">pyrocko.guts</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Object</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">StringChoice</span><span class="p">,</span> <span class="n">Timestamp</span><span class="p">,</span> <span class="n">Int</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Bool</span><span class="p">,</span> <span class="n">Complex</span><span class="p">,</span>
    <span class="n">ValidationError</span><span class="p">)</span>


<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&#39;pyrocko.ims&#39;</span><span class="p">)</span>

<span class="n">km</span> <span class="o">=</span> <span class="mf">1000.</span>
<span class="n">nm_per_s</span> <span class="o">=</span> <span class="mf">1.0e-9</span>

<span class="n">g_versions</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;GSE2.0&#39;</span><span class="p">,</span> <span class="s">&#39;GSE2.1&#39;</span><span class="p">,</span> <span class="s">&#39;IMS1.0&#39;</span><span class="p">)</span>
<span class="n">g_dialects</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;NOR_NDC&#39;</span><span class="p">,</span> <span class="s">&#39;USA_DMC&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="SerializeError"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.SerializeError">[docs]</a><span class="k">class</span> <span class="nc">SerializeError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Raised when serialization of an IMS/GSE2 object fails.&#39;&#39;&#39;</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="DeserializeError"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.DeserializeError">[docs]</a><span class="k">class</span> <span class="nc">DeserializeError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Raised when deserialization of an IMS/GSE2 object fails.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="ne">Exception</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_line_number</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_line</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_position</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;position&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;format&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_version_dialect</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">set_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">version_dialect</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_line_number</span> <span class="o">=</span> <span class="n">line_number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_line</span> <span class="o">=</span> <span class="n">line</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_version_dialect</span> <span class="o">=</span> <span class="n">version_dialect</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="ne">Exception</span><span class="o">.</span><span class="n">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version_dialect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;format version: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version_dialect</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;dialect: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version_dialect</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_line_number</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;line number: </span><span class="si">%i</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_line_number</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_line</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;line content:</span><span class="se">\n</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_line</span> <span class="ow">or</span>
                                            <span class="s">&#39;*** line is empty ***&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_line</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_position</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;^&#39;</span> <span class="o">*</span> <span class="n">length</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">f</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">length</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">position</span> <span class="o">-</span> <span class="n">i</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span> <span class="o">%</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">element</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>
                        <span class="n">i</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="n">element</span><span class="o">.</span><span class="n">length</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span> <span class="o">%</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;...&#39;</span><span class="p">)</span>
                        <span class="n">i</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">4</span>

                    <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>

        <span class="k">return</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">float_or_none</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>


<span class="k">def</span> <span class="nf">int_or_none</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>


<span class="k">def</span> <span class="nf">float_to_string</span><span class="p">(</span><span class="n">fmt</span><span class="p">):</span>
    <span class="n">ef</span> <span class="o">=</span> <span class="n">fmt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">ef</span> <span class="ow">in</span> <span class="s">&#39;ef&#39;</span>
    <span class="n">l</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">fmt</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">))</span>
    <span class="n">pfmts</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;</span><span class="si">%%%i</span><span class="s">.</span><span class="si">%i%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">dsub</span><span class="p">,</span> <span class="n">ef</span><span class="p">)</span> <span class="k">for</span> <span class="n">dsub</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
    <span class="n">blank</span> <span class="o">=</span> <span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="n">l</span>

    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">blank</span>

        <span class="k">for</span> <span class="n">pfmt</span> <span class="ow">in</span> <span class="n">pfmts</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">pfmt</span> <span class="o">%</span> <span class="n">v</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="n">l</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">s</span>

        <span class="k">raise</span> <span class="n">SerializeError</span><span class="p">(</span><span class="s">&#39;format=&quot;</span><span class="si">%s</span><span class="s">&quot;, value=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pfmt</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">func</span>


<span class="k">def</span> <span class="nf">int_to_string</span><span class="p">(</span><span class="n">fmt</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">fmt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;i&#39;</span>
    <span class="n">pfmt</span> <span class="o">=</span> <span class="s">&#39;%&#39;</span><span class="o">+</span><span class="n">fmt</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="s">&#39;i&#39;</span>
    <span class="n">l</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fmt</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="n">blank</span> <span class="o">=</span> <span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="n">l</span>

    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">blank</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">pfmt</span> <span class="o">%</span> <span class="n">v</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="n">l</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SerializeError</span><span class="p">(</span><span class="s">&#39;format=&quot;</span><span class="si">%s</span><span class="s">&quot;, value=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pfmt</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">func</span>


<span class="k">def</span> <span class="nf">deserialize_string</span><span class="p">(</span><span class="n">fmt</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">fmt</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;?&#39;</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">func</span>


<span class="k">def</span> <span class="nf">serialize_string</span><span class="p">(</span><span class="n">fmt</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">fmt</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;+&#39;</span><span class="p">):</span>
        <span class="n">more_ok</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">more_ok</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="n">fmt</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;?+&#39;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">fmt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;a&#39;</span>
    <span class="n">l</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fmt</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

        <span class="n">v</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">more_ok</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="n">l</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SerializeError</span><span class="p">(</span><span class="s">&#39;max string length: </span><span class="si">%i</span><span class="s">, value=&quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="n">l</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">func</span>


<span class="k">def</span> <span class="nf">rstrip_string</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">x_fixed</span><span class="p">(</span><span class="n">expect</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
        <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">s</span> <span class="o">!=</span> <span class="n">expect</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DeserializeError</span><span class="p">(</span>
                    <span class="s">&#39;expected=&quot;</span><span class="si">%s</span><span class="s">&quot;, value=&quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">expect</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">s</span>

        <span class="k">def</span> <span class="nf">string</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">expect</span>

        <span class="k">return</span> <span class="n">parse</span><span class="p">,</span> <span class="n">string</span>

    <span class="n">func</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">expect</span><span class="p">)</span>
    <span class="n">func</span><span class="o">.</span><span class="n">help_type</span> <span class="o">=</span> <span class="s">&#39;Keyword: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">expect</span>
    <span class="k">return</span> <span class="n">func</span>


<span class="k">def</span> <span class="nf">x_scaled</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">factor</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
        <span class="n">to_string</span> <span class="o">=</span> <span class="n">float_to_string</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">float_or_none</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">factor</span>

        <span class="k">def</span> <span class="nf">string</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">to_string</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">to_string</span><span class="p">(</span><span class="n">v</span><span class="o">/</span><span class="n">factor</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">parse</span><span class="p">,</span> <span class="n">string</span>

    <span class="n">func</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fmt</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">func</span><span class="o">.</span><span class="n">help_type</span> <span class="o">=</span> <span class="s">&#39;float&#39;</span>
    <span class="k">return</span> <span class="n">func</span>


<span class="k">def</span> <span class="nf">x_int_angle</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">string</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;   &#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;</span><span class="si">%3i</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">float_or_none</span><span class="p">,</span> <span class="n">string</span>

<span class="n">x_int_angle</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">x_int_angle</span><span class="o">.</span><span class="n">help_type</span> <span class="o">=</span> <span class="s">&#39;int [0, 360]&#39;</span>


<span class="k">def</span> <span class="nf">x_substitute</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
        <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">s</span> <span class="o">==</span> <span class="s">&#39;&#39;</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="k">def</span> <span class="nf">string</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&#39;&#39;</span>

        <span class="k">return</span> <span class="n">parse</span><span class="p">,</span> <span class="n">string</span>

    <span class="n">func</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">func</span><span class="o">.</span><span class="n">help_type</span> <span class="o">=</span> <span class="s">&#39;Not present in this file version.&#39;</span>
    <span class="k">return</span> <span class="n">func</span>


<span class="k">def</span> <span class="nf">fillup_zeros</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">fmt</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">if</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s">&#39;%Y/%m/</span><span class="si">%d</span><span class="s"> %H:%M:%S.3FRAC&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">s</span> <span class="o">+</span> <span class="s">&#39;0000/01/01 00:00:00.000&#39;</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):]</span>
    <span class="k">elif</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s">&#39;%Y/%m/</span><span class="si">%d</span><span class="s"> %H:%M:%S.2FRAC&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">s</span> <span class="o">+</span> <span class="s">&#39;0000/01/01 00:00:00.00&#39;</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):]</span>

    <span class="k">return</span> <span class="n">s</span>


<span class="k">def</span> <span class="nf">x_date_time</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;%Y/%m/</span><span class="si">%d</span><span class="s"> %H:%M:%S.3FRAC&#39;</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">fillup_zeros</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">str_to_time</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="c"># iris sets this dummy end dates and they don&#39;t fit into 32bit</span>
            <span class="c"># time stamps</span>
            <span class="k">if</span> <span class="n">fmt</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;%Y&#39;</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;2599&#39;</span><span class="p">,</span> <span class="s">&#39;2045&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">None</span>

            <span class="k">elif</span> <span class="n">fmt</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;%Y&#39;</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;2599&#39;</span><span class="p">,</span> <span class="s">&#39;2045&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">None</span>

            <span class="k">raise</span> <span class="n">DeserializeError</span><span class="p">(</span><span class="s">&#39;expected date, value=&quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">string</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">time_to_str</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">parse</span><span class="p">,</span> <span class="n">string</span>

<span class="n">x_date_time</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">23</span>
<span class="n">x_date_time</span><span class="o">.</span><span class="n">help_type</span> <span class="o">=</span> <span class="s">&#39;YYYY/MM/DD HH:MM:SS.FFF&#39;</span>


<span class="k">def</span> <span class="nf">x_date</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">x_date_time</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;%Y/%m/</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">)</span>

<span class="n">x_date</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">x_date</span><span class="o">.</span><span class="n">help_type</span> <span class="o">=</span> <span class="s">&#39;YYYY/MM/DD&#39;</span>


<span class="k">def</span> <span class="nf">x_date_iris</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">x_date_time</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;%m/</span><span class="si">%d</span><span class="s">/%Y&#39;</span><span class="p">)</span>

<span class="n">x_date_iris</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">x_date_iris</span><span class="o">.</span><span class="n">help_type</span> <span class="o">=</span> <span class="s">&#39;MM/DD/YYYY&#39;</span>


<span class="k">def</span> <span class="nf">x_date_time_no_seconds</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">x_date_time</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;%Y/%m/</span><span class="si">%d</span><span class="s"> %H:%M&#39;</span><span class="p">)</span>

<span class="n">x_date_time_no_seconds</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">x_date_time_no_seconds</span><span class="o">.</span><span class="n">help_type</span> <span class="o">=</span> <span class="s">&#39;YYYY/MM/DD HH:MM&#39;</span>


<span class="k">def</span> <span class="nf">x_date_time_2frac</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">x_date_time</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;%Y/%m/</span><span class="si">%d</span><span class="s"> %H:%M:%S.2FRAC&#39;</span><span class="p">)</span>

<span class="n">x_date_time_2frac</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">22</span>
<span class="n">x_date_time_2frac</span><span class="o">.</span><span class="n">help_type</span> <span class="o">=</span> <span class="s">&#39;YYYY/MM/DD HH:MM:SS.FF&#39;</span>


<span class="k">def</span> <span class="nf">x_yesno</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="s">&#39;y&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s">&#39;n&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DeserializeError</span><span class="p">(</span><span class="s">&#39;&quot;y&quot; on &quot;n&quot; expected&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">string</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;ny&#39;</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">)]</span>

    <span class="k">return</span> <span class="n">parse</span><span class="p">,</span> <span class="n">string</span>

<span class="n">x_yesno</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">x_yesno</span><span class="o">.</span><span class="n">help_type</span> <span class="o">=</span> <span class="s">&#39;yes/no&#39;</span>


<span class="k">def</span> <span class="nf">optional</span><span class="p">(</span><span class="n">x_func</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
        <span class="n">parse</span><span class="p">,</span> <span class="n">string</span> <span class="o">=</span> <span class="n">x_func</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">parse_optional</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">parse</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>

        <span class="k">def</span> <span class="nf">string_optional</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="n">x_func</span><span class="o">.</span><span class="n">width</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">string</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">parse_optional</span><span class="p">,</span> <span class="n">string_optional</span>

    <span class="n">func</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">x_func</span><span class="o">.</span><span class="n">width</span>
    <span class="n">func</span><span class="o">.</span><span class="n">help_type</span> <span class="o">=</span> <span class="s">&#39;optional </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">x_func</span><span class="o">.</span><span class="n">help_type</span>

    <span class="k">return</span> <span class="n">func</span>


<span class="k">class</span> <span class="nc">E</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">begin</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">dummy</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">advance</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">dummy</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">advance</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">begin</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">begin</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">end</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">fmt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="s">&#39;ef&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parse</span> <span class="o">=</span> <span class="n">float_or_none</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">string</span> <span class="o">=</span> <span class="n">float_to_string</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
                <span class="n">l</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fmt</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">help_type</span> <span class="o">=</span> <span class="s">&#39;float&#39;</span>
            <span class="k">elif</span> <span class="n">t</span> <span class="o">==</span> <span class="s">&#39;a&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parse</span> <span class="o">=</span> <span class="n">deserialize_string</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">string</span> <span class="o">=</span> <span class="n">serialize_string</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
                <span class="n">l</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fmt</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;+?&#39;</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">help_type</span> <span class="o">=</span> <span class="s">&#39;string&#39;</span>
            <span class="k">elif</span> <span class="n">t</span> <span class="o">==</span> <span class="s">&#39;i&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parse</span> <span class="o">=</span> <span class="n">int_or_none</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">string</span> <span class="o">=</span> <span class="n">int_to_string</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
                <span class="n">l</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fmt</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">help_type</span> <span class="o">=</span> <span class="s">&#39;integer&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&#39;invalid format: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">t</span>

            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">l</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> \
                <span class="s">&#39;inconsistent length for pos=</span><span class="si">%i</span><span class="s">, fmt=</span><span class="si">%s</span><span class="s">&#39;</span> \
                <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">string</span> <span class="o">=</span> <span class="n">fmt</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">help_type</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">help_type</span>


<span class="k">def</span> <span class="nf">end_section</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">line</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="n">ul</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ul</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;DATA_TYPE&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ul</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;STOP&#39;</span><span class="p">)</span> <span class="ow">or</span> \
        <span class="p">(</span><span class="n">extra</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">ul</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">extra</span><span class="p">))</span>


<div class="viewcode-block" id="Section"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.Section">[docs]</a><span class="k">class</span> <span class="nc">Section</span><span class="p">(</span><span class="n">Object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Base class for top level sections in IMS/GSE2 files.</span>

<span class="sd">    Sections as understood by this implementation typically correspond to a</span>
<span class="sd">    DATA_TYPE section in IMS/GSE2 but for some types a finer granularity has</span>
<span class="sd">    been chosen.&#39;&#39;&#39;</span>

    <span class="n">handlers</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c"># filled after section have been defined below</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">reader</span><span class="p">):</span>
        <span class="n">datatype</span> <span class="o">=</span> <span class="n">DataType</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
        <span class="n">reader</span><span class="o">.</span><span class="n">pushback</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">Section</span><span class="o">.</span><span class="n">handlers</span><span class="p">[</span><span class="n">datatype</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_datatype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>
        <span class="n">datatype</span> <span class="o">=</span> <span class="n">DataType</span><span class="p">(</span>
            <span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">keyword</span><span class="p">,</span>
            <span class="n">format</span><span class="o">=</span><span class="n">writer</span><span class="o">.</span><span class="n">version_dialect</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">datatype</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read_table</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">expected_header</span><span class="p">,</span> <span class="n">block_cls</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end_section</span><span class="p">):</span>

        <span class="n">header</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">header</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">expected_header</span><span class="o">.</span><span class="n">upper</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="n">DeserializeError</span><span class="p">(</span><span class="s">&#39;invalid table header line, expected:</span><span class="se">\n</span><span class="s">&#39;</span>
                                   <span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">expected_header</span><span class="p">)</span>

        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="n">reader</span><span class="o">.</span><span class="n">pushback</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">end</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                <span class="k">break</span>

            <span class="k">yield</span> <span class="n">block_cls</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">blocks</span><span class="p">):</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writeline</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">blocks</span><span class="p">:</span>
            <span class="n">block</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">get_versioned</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">version_dialect</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">version_dialect</span><span class="p">),</span> <span class="n">version_dialect</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>


<div class="viewcode-block" id="Block"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.Block">[docs]</a><span class="k">class</span> <span class="nc">Block</span><span class="p">(</span><span class="n">Object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Base class for IMS/GSE2 data blocks / lines.</span>

<span class="sd">    Blocks as understood by this implementation usually correspond to</span>
<span class="sd">    individual logical lines in the IMS/GSE2 file.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">ivals</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">version_dialect</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">get_versioned</span><span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">_format</span><span class="p">,</span> <span class="n">version_dialect</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version_dialect</span><span class="p">):</span>
        <span class="n">ivalue</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">version_dialect</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">length</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">element</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">string</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">ivalue</span><span class="p">])))</span>
            <span class="n">ivalue</span> <span class="o">+=</span> <span class="n">element</span><span class="o">.</span><span class="n">advance</span>

        <span class="n">out</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">slist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">slist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">position</span> <span class="o">-</span> <span class="n">i</span><span class="p">))</span>
            <span class="n">slist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">position</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">slist</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">deserialize_values</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">version_dialect</span><span class="p">):</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">cls</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">version_dialect</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span>
                    <span class="n">line</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">position</span><span class="p">:</span><span class="n">element</span><span class="o">.</span><span class="n">end</span><span class="p">])</span>

                <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">advance</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DeserializeError</span><span class="p">(</span>
                    <span class="s">&#39;Cannot parse </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">element</span><span class="o">.</span><span class="n">help_type</span><span class="p">),</span>
                    <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">length</span><span class="p">),</span>
                    <span class="n">version</span><span class="o">=</span><span class="n">version_dialect</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">dialect</span><span class="o">=</span><span class="n">version_dialect</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">format</span><span class="o">=</span><span class="n">cls</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">version_dialect</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">values</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">validated</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">ValidationError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DeserializeError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">obj</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">regularized</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">regularize</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">ValidationError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DeserializeError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">obj</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">deserialize</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">version_dialect</span><span class="p">):</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">deserialize_values</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">version_dialect</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">validated</span><span class="p">(</span><span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">propnames</span><span class="p">,</span> <span class="n">values</span><span class="p">)))</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">reader</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">reader</span><span class="o">.</span><span class="n">version_dialect</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">writer</span><span class="o">.</span><span class="n">version_dialect</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writeline</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="FreeFormatLine"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.FreeFormatLine">[docs]</a><span class="k">class</span> <span class="nc">FreeFormatLine</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Base class for IMS/GSE2 free format lines.&#39;&#39;&#39;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">deserialize_values</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">version_dialect</span><span class="p">):</span>
        <span class="n">format</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">version_dialect</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">format</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">values_weeded</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">!=</span> <span class="n">x</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">DeserializeError</span><span class="p">(</span>
                        <span class="s">&#39;expected keyword: </span><span class="si">%s</span><span class="s">, found </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">parse</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

                <span class="n">values_weeded</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>

        <span class="n">values_weeded</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">xv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">xv</span> <span class="ow">in</span> <span class="n">values_weeded</span><span class="p">]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">deserialize</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">version_dialect</span><span class="p">):</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">deserialize_values</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">version_dialect</span><span class="p">)</span>
        <span class="n">propnames</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">propnames</span>
        <span class="n">stuff</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">propnames</span><span class="p">,</span> <span class="n">values</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">regularized</span><span class="p">(</span><span class="o">**</span><span class="n">stuff</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version_dialect</span><span class="p">):</span>
        <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">propnames</span>
        <span class="n">props</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">properties</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">version_dialect</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">string</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

                <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">break</span>

                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">props</span><span class="p">[</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_save</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>

        <span class="k">return</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="DataType"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.DataType">[docs]</a><span class="k">class</span> <span class="nc">DataType</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a DATA_TYPE line.&#39;&#39;&#39;</span>

    <span class="nb">type</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="n">subtype</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">format</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="n">subformat</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">deserialize</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">version_dialect</span><span class="p">):</span>
        <span class="n">pat</span> <span class="o">=</span> <span class="s">r&#39;DATA_TYPE +([^ :]+)(:([^ :]+))? +([^ :]+)(:([^ :]+))?&#39;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DeserializeError</span><span class="p">(</span><span class="s">&#39;invalid DATA_TYPE line&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">validated</span><span class="p">(</span>
            <span class="nb">type</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">subtype</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
            <span class="n">format</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
            <span class="n">subformat</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version_dialect</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtype</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;:&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtype</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subformat</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">+=</span> <span class="s">&#39;:&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">subformat</span>

        <span class="k">return</span> <span class="s">&#39;DATA_TYPE </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">reader</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">datatype</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">reader</span><span class="o">.</span><span class="n">version_dialect</span><span class="p">)</span>
        <span class="n">reader</span><span class="o">.</span><span class="n">version_dialect</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">datatype</span><span class="o">.</span><span class="n">format</span>
        <span class="k">return</span> <span class="n">datatype</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">writer</span><span class="o">.</span><span class="n">version_dialect</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">version_dialect</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writeline</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="FTPFile"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.FTPFile">[docs]</a><span class="k">class</span> <span class="nc">FTPFile</span><span class="p">(</span><span class="n">FreeFormatLine</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of an FTP_FILE line.&#39;&#39;&#39;</span>

    <span class="n">_format</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;FTP_FILE&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>

    <span class="n">net_address</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="n">login_mode</span> <span class="o">=</span> <span class="n">StringChoice</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">choices</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;USER&#39;</span><span class="p">,</span> <span class="s">&#39;GUEST&#39;</span><span class="p">),</span> <span class="n">ignore_case</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">directory</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="nb">file</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="WaveformSubformat"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.WaveformSubformat">[docs]</a><span class="k">class</span> <span class="nc">WaveformSubformat</span><span class="p">(</span><span class="n">StringChoice</span><span class="p">):</span>
    <span class="n">choices</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;INT&#39;</span><span class="p">,</span> <span class="s">&#39;CM6&#39;</span><span class="p">,</span> <span class="s">&#39;CM8&#39;</span><span class="p">,</span> <span class="s">&#39;AU6&#39;</span><span class="p">,</span> <span class="s">&#39;AU8&#39;</span><span class="p">]</span>
    <span class="n">ignore_case</span> <span class="o">=</span> <span class="bp">True</span>

</div>
<div class="viewcode-block" id="WID2"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.WID2">[docs]</a><span class="k">class</span> <span class="nc">WID2</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a WID2 line.&#39;&#39;&#39;</span>

    <span class="n">_format</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">x_fixed</span><span class="p">(</span><span class="s">&#39;WID2&#39;</span><span class="p">),</span> <span class="n">dummy</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="n">x_date_time</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="s">&#39;a5&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="s">&#39;a3&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="s">&#39;a4&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="s">&#39;a3&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">49</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="s">&#39;i8&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">58</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="s">&#39;f11.6&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mi">79</span><span class="p">,</span> <span class="n">x_scaled</span><span class="p">(</span><span class="s">&#39;e10.2&#39;</span><span class="p">,</span> <span class="n">nm_per_s</span><span class="p">)),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">81</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="s">&#39;f7.3&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">89</span><span class="p">,</span> <span class="mi">94</span><span class="p">,</span> <span class="s">&#39;a6?&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">96</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="s">&#39;f5.1&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">102</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="s">&#39;f4.1&#39;</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="n">time</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="n">station</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;station code (5 characters)&#39;</span><span class="p">)</span>
    <span class="n">channel</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;channel code (3 characters)&#39;</span><span class="p">)</span>
    <span class="n">location</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;location code (aux_id, 4 characters)&#39;</span><span class="p">)</span>
    <span class="n">sub_format</span> <span class="o">=</span> <span class="n">WaveformSubformat</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&#39;CM6&#39;</span><span class="p">)</span>
    <span class="n">nsamples</span> <span class="o">=</span> <span class="n">Int</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">sample_rate</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">calibration_factor</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;system sensitivity (m/count) at reference period &#39;</span>
             <span class="s">&#39;(calibration_period)&#39;</span><span class="p">)</span>
    <span class="n">calibration_period</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;calibration reference period [s]&#39;</span><span class="p">)</span>
    <span class="n">instrument_type</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;instrument type (6 characters)&#39;</span><span class="p">)</span>
    <span class="n">horizontal_angle</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;horizontal orientation of sensor, clockwise from north [deg]&#39;</span><span class="p">)</span>
    <span class="n">vertical_angle</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;vertical orientation of sensor from vertical [deg]&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="OUT2"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.OUT2">[docs]</a><span class="k">class</span> <span class="nc">OUT2</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of an OUT2 line.&#39;&#39;&#39;</span>

    <span class="n">_format</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">x_fixed</span><span class="p">(</span><span class="s">&#39;OUT2&#39;</span><span class="p">),</span> <span class="n">dummy</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="n">x_date_time</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="s">&#39;a5&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="s">&#39;a3&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="s">&#39;a4&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="s">&#39;f11.3&#39;</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="n">time</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="n">station</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;station code (5 characters)&#39;</span><span class="p">)</span>
    <span class="n">channel</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;channel code (3 characters)&#39;</span><span class="p">)</span>
    <span class="n">location</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;location code (aux_id, 4 characters)&#39;</span><span class="p">)</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="DLY2"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.DLY2">[docs]</a><span class="k">class</span> <span class="nc">DLY2</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a DLY2 line.&#39;&#39;&#39;</span>

    <span class="n">_format</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">x_fixed</span><span class="p">(</span><span class="s">&#39;DLY2&#39;</span><span class="p">),</span> <span class="n">dummy</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="n">x_date_time</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="s">&#39;a5&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="s">&#39;a3&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="s">&#39;a4&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="s">&#39;f11.3&#39;</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="n">time</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="n">station</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;station code (5 characters)&#39;</span><span class="p">)</span>
    <span class="n">channel</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;channel code (3 characters)&#39;</span><span class="p">)</span>
    <span class="n">location</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;location code (aux_id, 4 characters)&#39;</span><span class="p">)</span>
    <span class="n">queue_duration</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;duration of queue [s]&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="DAT2"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.DAT2">[docs]</a><span class="k">class</span> <span class="nc">DAT2</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a DAT2 line.&#39;&#39;&#39;</span>

    <span class="n">_format</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">x_fixed</span><span class="p">(</span><span class="s">&#39;DAT2&#39;</span><span class="p">),</span> <span class="n">dummy</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="n">raw_data</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">())</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">reader</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">dat2</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">reader</span><span class="o">.</span><span class="n">version_dialect</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;CHK2 &#39;</span><span class="p">):</span>
                <span class="n">reader</span><span class="o">.</span><span class="n">pushback</span><span class="p">()</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">reader</span><span class="o">.</span><span class="n">_load_data</span><span class="p">:</span>
                    <span class="n">dat2</span><span class="o">.</span><span class="n">raw_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">dat2</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>
        <span class="n">Block</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="p">:</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writeline</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="STA2"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.STA2">[docs]</a><span class="k">class</span> <span class="nc">STA2</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a STA2 line.&#39;&#39;&#39;</span>

    <span class="n">_format</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">x_fixed</span><span class="p">(</span><span class="s">&#39;STA2&#39;</span><span class="p">),</span> <span class="n">dummy</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="s">&#39;a9&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="s">&#39;f9.5&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">26</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="s">&#39;f10.5&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">37</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="s">&#39;a12&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="n">x_scaled</span><span class="p">(</span><span class="s">&#39;f5.3&#39;</span><span class="p">,</span> <span class="n">km</span><span class="p">)),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">56</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="n">x_scaled</span><span class="p">(</span><span class="s">&#39;f5.3&#39;</span><span class="p">,</span> <span class="n">km</span><span class="p">))</span>
    <span class="p">]</span>

    <span class="c"># the standard requires lat, lon, elevation and depth, we define them as</span>
    <span class="c"># optional, however</span>

    <span class="n">network</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;network code (9 characters)&#39;</span><span class="p">)</span>
    <span class="n">lat</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">lon</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">coordinate_system</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&#39;WGS-84&#39;</span><span class="p">)</span>
    <span class="n">elevation</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;elevation [m]&#39;</span><span class="p">)</span>
    <span class="n">depth</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;emplacement depth [m]&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="CHK2"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.CHK2">[docs]</a><span class="k">class</span> <span class="nc">CHK2</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a CHK2 line.&#39;&#39;&#39;</span>

    <span class="n">_format</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">x_fixed</span><span class="p">(</span><span class="s">&#39;CHK2&#39;</span><span class="p">),</span> <span class="n">dummy</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="s">&#39;i8&#39;</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="n">checksum</span> <span class="o">=</span> <span class="n">Int</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="EID2"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.EID2">[docs]</a><span class="k">class</span> <span class="nc">EID2</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of an EID2 line.&#39;&#39;&#39;</span>

    <span class="n">_format</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">x_fixed</span><span class="p">(</span><span class="s">&#39;EID2&#39;</span><span class="p">),</span> <span class="n">dummy</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="s">&#39;a8&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="s">&#39;a9&#39;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">event_id</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;event ID (8 characters)&#39;</span><span class="p">)</span>
    <span class="n">bulletin_type</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;bulletin type (9 characters)&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="BEA2"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.BEA2">[docs]</a><span class="k">class</span> <span class="nc">BEA2</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a BEA2 line.&#39;&#39;&#39;</span>

    <span class="n">_format</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">x_fixed</span><span class="p">(</span><span class="s">&#39;BEA2&#39;</span><span class="p">),</span> <span class="n">dummy</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="s">&#39;a12&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="s">&#39;f5.1&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="s">&#39;f5.1&#39;</span><span class="p">)]</span>

    <span class="n">beam_id</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;beam ID (12 characters)&#39;</span><span class="p">)</span>
    <span class="n">azimuth</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="n">slowness</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="Network"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.Network">[docs]</a><span class="k">class</span> <span class="nc">Network</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of an entry in a NETWORK section.&#39;&#39;&#39;</span>

    <span class="n">_format</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="s">&#39;a9&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;a64+&#39;</span><span class="p">)]</span>

    <span class="n">network</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;network code (9 characters)&#39;</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;description&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Station"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.Station">[docs]</a><span class="k">class</span> <span class="nc">Station</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of an entry in a STATION section.&#39;&#39;&#39;</span>

    <span class="n">_format</span> <span class="o">=</span> <span class="p">{</span>
        <span class="bp">None</span><span class="p">:</span> <span class="p">[</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="s">&#39;a9&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="s">&#39;a5&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="s">&#39;a4&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="s">&#39;f9.5&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="s">&#39;f10.5&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">43</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="s">&#39;a12&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">56</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="n">x_scaled</span><span class="p">(</span><span class="s">&#39;f5.3&#39;</span><span class="p">,</span> <span class="n">km</span><span class="p">)),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">62</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="n">x_date</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">73</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="n">optional</span><span class="p">(</span><span class="n">x_date</span><span class="p">))</span>
        <span class="p">],</span>
        <span class="s">&#39;GSE2.0&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">x_substitute</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="s">&#39;a5&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s">&#39;a4&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="s">&#39;f9.5&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="s">&#39;f10.5&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="n">x_substitute</span><span class="p">(</span><span class="s">&#39;WGS-84&#39;</span><span class="p">)),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">33</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="n">x_scaled</span><span class="p">(</span><span class="s">&#39;f7.3&#39;</span><span class="p">,</span> <span class="n">km</span><span class="p">)),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">41</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">x_date</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">52</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="n">optional</span><span class="p">(</span><span class="n">x_date</span><span class="p">))]}</span>

    <span class="n">_format</span><span class="p">[</span><span class="s">&#39;IMS1.0&#39;</span><span class="p">,</span> <span class="s">&#39;USA_DMC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_format</span><span class="p">[</span><span class="bp">None</span><span class="p">])</span>
    <span class="n">_format</span><span class="p">[</span><span class="s">&#39;IMS1.0&#39;</span><span class="p">,</span> <span class="s">&#39;USA_DMC&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">62</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="n">x_date_iris</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">73</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="n">optional</span><span class="p">(</span><span class="n">x_date_iris</span><span class="p">))]</span>

    <span class="n">network</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;network code (9 characters)&#39;</span><span class="p">)</span>
    <span class="n">station</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;station code (5 characters)&#39;</span><span class="p">)</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;station type (4 characters) &#39;</span>
             <span class="s">&#39;(1C: single component, 3C: three-component, &#39;</span>
             <span class="s">&#39;hfa: high frequency array, lpa: long period array)&#39;</span><span class="p">)</span>
    <span class="n">lat</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="n">lon</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="n">coordinate_system</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&#39;WGS-84&#39;</span><span class="p">)</span>
    <span class="n">elevation</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;elevation [m]&#39;</span><span class="p">)</span>
    <span class="n">tmin</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="n">tmax</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Channel"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.Channel">[docs]</a><span class="k">class</span> <span class="nc">Channel</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of an entry in a CHANNEL section.&#39;&#39;&#39;</span>

    <span class="n">_format</span> <span class="o">=</span> <span class="p">{</span>
        <span class="bp">None</span><span class="p">:</span> <span class="p">[</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="s">&#39;a9&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="s">&#39;a5&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="s">&#39;a3&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="s">&#39;a4&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">26</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="s">&#39;f9.5&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="s">&#39;f10.5&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">47</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="s">&#39;a12&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">x_scaled</span><span class="p">(</span><span class="s">&#39;f5.3&#39;</span><span class="p">,</span> <span class="n">km</span><span class="p">)),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">66</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="n">x_scaled</span><span class="p">(</span><span class="s">&#39;f5.3&#39;</span><span class="p">,</span> <span class="n">km</span><span class="p">)),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">72</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="s">&#39;f6.1&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">79</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="s">&#39;f5.1&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">85</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="s">&#39;f11.6&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">97</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="s">&#39;a6&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">105</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="n">x_date</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">116</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="n">optional</span><span class="p">(</span><span class="n">x_date</span><span class="p">))],</span>
        <span class="s">&#39;GSE2.0&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">x_substitute</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="s">&#39;a5&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="s">&#39;a3&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="s">&#39;a4&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="s">&#39;f9.5&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">26</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="s">&#39;f10.5&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="n">x_substitute</span><span class="p">(</span><span class="s">&#39;WGS-84&#39;</span><span class="p">)),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">37</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="n">x_scaled</span><span class="p">(</span><span class="s">&#39;f7.3&#39;</span><span class="p">,</span> <span class="n">km</span><span class="p">)),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">x_scaled</span><span class="p">(</span><span class="s">&#39;f6.3&#39;</span><span class="p">,</span> <span class="n">km</span><span class="p">)),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">52</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="s">&#39;f6.1&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">59</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="s">&#39;f5.1&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">65</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="s">&#39;f11.6&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">77</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="s">&#39;a7&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">85</span><span class="p">,</span> <span class="mi">94</span><span class="p">,</span> <span class="n">x_date</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">96</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="n">optional</span><span class="p">(</span><span class="n">x_date</span><span class="p">))]}</span>

    <span class="c"># norsar plays its own game...</span>
    <span class="n">_format</span><span class="p">[</span><span class="s">&#39;GSE2.0&#39;</span><span class="p">,</span> <span class="s">&#39;NOR_NDC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_format</span><span class="p">[</span><span class="s">&#39;GSE2.0&#39;</span><span class="p">])</span>
    <span class="n">_format</span><span class="p">[</span><span class="s">&#39;GSE2.0&#39;</span><span class="p">,</span> <span class="s">&#39;NOR_NDC&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">85</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">x_date_time_no_seconds</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">102</span><span class="p">,</span> <span class="mi">117</span><span class="p">,</span> <span class="n">optional</span><span class="p">(</span><span class="n">x_date_time_no_seconds</span><span class="p">))]</span>

    <span class="c"># also iris plays its own game...</span>
    <span class="n">_format</span><span class="p">[</span><span class="s">&#39;IMS1.0&#39;</span><span class="p">,</span> <span class="s">&#39;USA_DMC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_format</span><span class="p">[</span><span class="bp">None</span><span class="p">])</span>
    <span class="n">_format</span><span class="p">[</span><span class="s">&#39;IMS1.0&#39;</span><span class="p">,</span> <span class="s">&#39;USA_DMC&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">105</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="n">x_date_iris</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">116</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="n">optional</span><span class="p">(</span><span class="n">x_date_iris</span><span class="p">))]</span>

    <span class="n">network</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;network code (9 characters)&#39;</span><span class="p">)</span>
    <span class="n">station</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;station code (5 characters)&#39;</span><span class="p">)</span>
    <span class="n">channel</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;channel code (3 characters)&#39;</span><span class="p">)</span>
    <span class="n">location</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;location code (aux_id, 4 characters)&#39;</span><span class="p">)</span>
    <span class="n">lat</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">lon</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">coordinate_system</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&#39;WGS-84&#39;</span><span class="p">)</span>
    <span class="n">elevation</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;elevation [m]&#39;</span><span class="p">)</span>
    <span class="n">depth</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;emplacement depth [m]&#39;</span><span class="p">)</span>
    <span class="n">horizontal_angle</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;horizontal orientation of sensor, clockwise from north [deg]&#39;</span><span class="p">)</span>
    <span class="n">vertical_angle</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;vertical orientation of sensor from vertical [deg]&#39;</span><span class="p">)</span>
    <span class="n">sample_rate</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="n">instrument_type</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;instrument type (6 characters)&#39;</span><span class="p">)</span>
    <span class="n">tmin</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="n">tmax</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="BeamGroup"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.BeamGroup">[docs]</a><span class="k">class</span> <span class="nc">BeamGroup</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of an entry in a BEAM group table.&#39;&#39;&#39;</span>

    <span class="n">_format</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="s">&#39;a8&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="s">&#39;a5&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="s">&#39;a3&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="s">&#39;a4&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="s">&#39;i3&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">29</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="s">&#39;f9.5&#39;</span><span class="p">)]</span>

    <span class="n">beam_group</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;beam group (8 characters)&#39;</span><span class="p">)</span>
    <span class="n">station</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;station code (5 characters)&#39;</span><span class="p">)</span>
    <span class="n">channel</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;channel code (3 characters)&#39;</span><span class="p">)</span>
    <span class="n">location</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;location code (aux_id, 4 characters)&#39;</span><span class="p">)</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="n">Int</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;weight used for this component when the beam was formed&#39;</span><span class="p">)</span>
    <span class="n">delay</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;beam delay for this component [s] &#39;</span>
             <span class="s">&#39;(used for meabs formed by non-plane waves)&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="BeamType"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.BeamType">[docs]</a><span class="k">class</span> <span class="nc">BeamType</span><span class="p">(</span><span class="n">StringChoice</span><span class="p">):</span>
    <span class="n">choices</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;inc&#39;</span><span class="p">,</span> <span class="s">&#39;coh&#39;</span><span class="p">]</span>
    <span class="n">ignore_case</span> <span class="o">=</span> <span class="bp">True</span>

</div>
<div class="viewcode-block" id="FilterType"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.FilterType">[docs]</a><span class="k">class</span> <span class="nc">FilterType</span><span class="p">(</span><span class="n">StringChoice</span><span class="p">):</span>
    <span class="n">choices</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;BP&#39;</span><span class="p">,</span> <span class="s">&#39;LP&#39;</span><span class="p">,</span> <span class="s">&#39;HP&#39;</span><span class="p">,</span> <span class="s">&#39;BR&#39;</span><span class="p">]</span>
    <span class="n">ignore_case</span> <span class="o">=</span> <span class="bp">True</span>

</div>
<div class="viewcode-block" id="BeamParameters"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.BeamParameters">[docs]</a><span class="k">class</span> <span class="nc">BeamParameters</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of an entry in a BEAM parameters table.&#39;&#39;&#39;</span>

    <span class="n">_format</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="s">&#39;a12&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="s">&#39;a8&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="s">&#39;a3&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="n">x_yesno</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">29</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="s">&#39;f5.1&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="s">&#39;f5.3&#39;</span><span class="p">),</span>  <span class="c"># standard says f5.1 -999.0 is vertical beam</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">41</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="s">&#39;a8&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="s">&#39;f6.2&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">57</span><span class="p">,</span> <span class="mi">62</span><span class="p">,</span> <span class="s">&#39;f6.2&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="s">&#39;i2&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">67</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="n">x_yesno</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">69</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="s">&#39;a2&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">72</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="n">x_date</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">83</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="n">optional</span><span class="p">(</span><span class="n">x_date</span><span class="p">))]</span>

    <span class="n">beam_id</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="n">beam_group</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">BeamType</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="n">is_rotated</span> <span class="o">=</span> <span class="n">Bool</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;rotation flag&#39;</span><span class="p">)</span>
    <span class="n">azimuth</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;azimuth used to steer the beam [deg] (clockwise from North)&#39;</span><span class="p">)</span>
    <span class="n">slowness</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;slowness used to steer the beam [s/deg]&#39;</span><span class="p">)</span>
    <span class="n">phase</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;phase used to set the beam slowness for origin-based beams &#39;</span>
             <span class="s">&#39;(8 characters)&#39;</span><span class="p">)</span>
    <span class="n">filter_fmin</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;low frequency cut-off for the beam filter [Hz]&#39;</span><span class="p">)</span>
    <span class="n">filter_fmax</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;high frequency cut-off for the beam filter [Hz]&#39;</span><span class="p">)</span>
    <span class="n">filter_order</span> <span class="o">=</span> <span class="n">Int</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;order of the beam filter&#39;</span><span class="p">)</span>
    <span class="n">filter_is_zero_phase</span> <span class="o">=</span> <span class="n">Bool</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;flag to indicate zero-phase filtering&#39;</span><span class="p">)</span>
    <span class="n">filter_type</span> <span class="o">=</span> <span class="n">FilterType</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;type of filtering&#39;</span><span class="p">)</span>
    <span class="n">tmin</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;start date of beam use&#39;</span><span class="p">)</span>
    <span class="n">tmax</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;end date of beam use&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="OutageReportPeriod"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.OutageReportPeriod">[docs]</a><span class="k">class</span> <span class="nc">OutageReportPeriod</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a the report period of an OUTAGE section.&#39;&#39;&#39;</span>

    <span class="n">_format</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="n">x_fixed</span><span class="p">(</span><span class="s">&#39;Report period from&#39;</span><span class="p">),</span> <span class="n">dummy</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="n">x_date_time</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">44</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="n">x_fixed</span><span class="p">(</span><span class="s">&#39;to&#39;</span><span class="p">),</span> <span class="n">dummy</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">47</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="n">x_date_time</span><span class="p">)]</span>

    <span class="n">tmin</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="n">tmax</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="Outage"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.Outage">[docs]</a><span class="k">class</span> <span class="nc">Outage</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of an entry in the OUTAGE section table.&#39;&#39;&#39;</span>
    <span class="n">_format</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="s">&#39;a9&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="s">&#39;a5&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="s">&#39;a3&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="s">&#39;a4&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">26</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="n">x_date_time</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="n">x_date_time</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">74</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="s">&#39;f10.3&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">85</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;a48+&#39;</span><span class="p">)]</span>

    <span class="n">network</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;network code (9 characters)&#39;</span><span class="p">)</span>
    <span class="n">station</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;station code (5 characters)&#39;</span><span class="p">)</span>
    <span class="n">channel</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;channel code (3 characters)&#39;</span><span class="p">)</span>
    <span class="n">location</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;location code (aux_id, 4 characters)&#39;</span><span class="p">)</span>
    <span class="n">tmin</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="n">tmax</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="n">comment</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="CAL2"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.CAL2">[docs]</a><span class="k">class</span> <span class="nc">CAL2</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a CAL2 line.&#39;&#39;&#39;</span>

    <span class="n">_format</span> <span class="o">=</span> <span class="p">{</span>
        <span class="bp">None</span><span class="p">:</span> <span class="p">[</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">x_fixed</span><span class="p">(</span><span class="s">&#39;CAL2&#39;</span><span class="p">),</span> <span class="n">dummy</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s">&#39;a5&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="s">&#39;a3&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="s">&#39;a4&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="s">&#39;a6&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="n">x_scaled</span><span class="p">(</span><span class="s">&#39;e15.8&#39;</span><span class="p">,</span> <span class="n">nm_per_s</span><span class="p">)),</span>  <span class="c"># standard: e15.2</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">44</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="s">&#39;f7.3&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">52</span><span class="p">,</span> <span class="mi">62</span><span class="p">,</span> <span class="s">&#39;f11.5&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">79</span><span class="p">,</span> <span class="n">x_date_time_no_seconds</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">81</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="n">optional</span><span class="p">(</span><span class="n">x_date_time_no_seconds</span><span class="p">))],</span>
        <span class="s">&#39;GSE2.0&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">x_fixed</span><span class="p">(</span><span class="s">&#39;CAL2&#39;</span><span class="p">),</span> <span class="n">dummy</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s">&#39;a5&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="s">&#39;a3&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="s">&#39;a4&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="s">&#39;a6&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="n">x_scaled</span><span class="p">(</span><span class="s">&#39;e10.4&#39;</span><span class="p">,</span> <span class="n">nm_per_s</span><span class="p">)),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">39</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="s">&#39;f7.3&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">47</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="s">&#39;f10.5&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">58</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="n">x_date_time_no_seconds</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="n">optional</span><span class="p">(</span><span class="n">x_date_time_no_seconds</span><span class="p">))]}</span>

    <span class="n">station</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;station code (5 characters)&#39;</span><span class="p">)</span>
    <span class="n">channel</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;channel code (3 characters)&#39;</span><span class="p">)</span>
    <span class="n">location</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;location code (aux_id, 4 characters)&#39;</span><span class="p">)</span>
    <span class="n">instrument_type</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;instrument type (6 characters)&#39;</span><span class="p">)</span>
    <span class="n">calibration_factor</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;system sensitivity (m/count) at reference period &#39;</span>
             <span class="s">&#39;(calibration_period)&#39;</span><span class="p">)</span>
    <span class="n">calibration_period</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;calibration reference period [s]&#39;</span><span class="p">)</span>
    <span class="n">sample_rate</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;system output sample rate [Hz]&#39;</span><span class="p">)</span>
    <span class="n">tmin</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;effective start date and time&#39;</span><span class="p">)</span>
    <span class="n">tmax</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;effective end date and time&#39;</span><span class="p">)</span>
    <span class="n">comments</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">reader</span><span class="p">):</span>
        <span class="n">lstart</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">current_line_number</span><span class="p">()</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">reader</span><span class="o">.</span><span class="n">version_dialect</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="c"># make sure all comments are read</span>
            <span class="k">if</span> <span class="n">line</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">):</span>
                <span class="n">reader</span><span class="o">.</span><span class="n">pushback</span><span class="p">()</span>
                <span class="k">break</span>

            <span class="n">obj</span><span class="o">.</span><span class="n">append_dataline</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">reader</span><span class="o">.</span><span class="n">version_dialect</span><span class="p">)</span>

        <span class="n">obj</span><span class="o">.</span><span class="n">comments</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">get_comments_after</span><span class="p">(</span><span class="n">lstart</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">writer</span><span class="o">.</span><span class="n">version_dialect</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writeline</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">comments</span><span class="p">:</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writeline</span><span class="p">(</span><span class="s">&#39; (</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="n">c</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Units"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.Units">[docs]</a><span class="k">class</span> <span class="nc">Units</span><span class="p">(</span><span class="n">StringChoice</span><span class="p">):</span>
    <span class="n">choices</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;C&#39;</span><span class="p">]</span>
    <span class="n">ignore_case</span> <span class="o">=</span> <span class="bp">True</span>

</div>
<div class="viewcode-block" id="Stage"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.Stage">[docs]</a><span class="k">class</span> <span class="nc">Stage</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Base class for IMS/GSE2 response stages.</span>

<span class="sd">    Available response stages are :py:class:`PAZ2`, :py:class:`FAP2`,</span>
<span class="sd">    :py:class:`GEN2`, :py:class:`DIG2`, and :py:class:`FIR2`.</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">stage_number</span> <span class="o">=</span> <span class="n">Int</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;stage sequence number&#39;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">reader</span><span class="p">):</span>
        <span class="n">lstart</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">current_line_number</span><span class="p">()</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">reader</span><span class="o">.</span><span class="n">version_dialect</span><span class="p">)</span>

        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">line</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">):</span>
                <span class="n">reader</span><span class="o">.</span><span class="n">pushback</span><span class="p">()</span>
                <span class="k">break</span>

            <span class="n">obj</span><span class="o">.</span><span class="n">append_dataline</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">reader</span><span class="o">.</span><span class="n">version_dialect</span><span class="p">)</span>

        <span class="n">obj</span><span class="o">.</span><span class="n">comments</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">get_comments_after</span><span class="p">(</span><span class="n">lstart</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">writer</span><span class="o">.</span><span class="n">version_dialect</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writeline</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_datalines</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">comments</span><span class="p">:</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writeline</span><span class="p">(</span><span class="s">&#39; (</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_datalines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>
        <span class="k">pass</span>

</div>
<div class="viewcode-block" id="PAZ2Data"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.PAZ2Data">[docs]</a><span class="k">class</span> <span class="nc">PAZ2Data</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of the complex numbers in PAZ2 sections.&#39;&#39;&#39;</span>

    <span class="n">_format</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="s">&#39;e15.8&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="s">&#39;e15.8&#39;</span><span class="p">)]</span>

    <span class="n">real</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="n">imag</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="PAZ2"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.PAZ2">[docs]</a><span class="k">class</span> <span class="nc">PAZ2</span><span class="p">(</span><span class="n">Stage</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a PAZ2 line.&#39;&#39;&#39;</span>

    <span class="n">_format</span> <span class="o">=</span> <span class="p">{</span>
        <span class="bp">None</span><span class="p">:</span> <span class="p">[</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">x_fixed</span><span class="p">(</span><span class="s">&#39;PAZ2&#39;</span><span class="p">),</span> <span class="n">dummy</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="s">&#39;i2&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="s">&#39;a1&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="s">&#39;e15.8&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="s">&#39;i4&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="s">&#39;f8.3&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">41</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="s">&#39;i3&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="s">&#39;i3&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">49</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;a25+&#39;</span><span class="p">)],</span>
        <span class="p">(</span><span class="s">&#39;IMS1.0&#39;</span><span class="p">,</span> <span class="s">&#39;USA_DMC&#39;</span><span class="p">):</span> <span class="p">[</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">x_fixed</span><span class="p">(</span><span class="s">&#39;PAZ2&#39;</span><span class="p">),</span> <span class="n">dummy</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="s">&#39;i2&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="s">&#39;a1&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="s">&#39;e15.8&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="s">&#39;i4&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="s">&#39;f8.3&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="s">&#39;i3&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">44</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="s">&#39;i3&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="p">(</span><span class="mi">48</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;a25+&#39;</span><span class="p">)]}</span>

    <span class="n">output_units</span> <span class="o">=</span> <span class="n">Units</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;output units code (V=volts, A=amps, C=counts)&#39;</span><span class="p">)</span>
    <span class="n">scale_factor</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;scale factor [ouput units/input units]&#39;</span><span class="p">)</span>
    <span class="n">decimation</span> <span class="o">=</span> <span class="n">Int</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;decimation&#39;</span><span class="p">)</span>
    <span class="n">correction</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;group correction applied [s]&#39;</span><span class="p">)</span>
    <span class="n">npoles</span> <span class="o">=</span> <span class="n">Int</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;number of poles&#39;</span><span class="p">)</span>
    <span class="n">nzeros</span> <span class="o">=</span> <span class="n">Int</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;number of zeros&#39;</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;description&#39;</span><span class="p">)</span>

    <span class="n">poles</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">Complex</span><span class="o">.</span><span class="n">T</span><span class="p">())</span>
    <span class="n">zeros</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">Complex</span><span class="o">.</span><span class="n">T</span><span class="p">())</span>

    <span class="n">comments</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">append_dataline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">version_dialect</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">PAZ2Data</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">version_dialect</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="nb">complex</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">poles</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zeros</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">npoles</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">poles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">npoles</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nzeros</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zeros</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DeserializeError</span><span class="p">(</span>
                <span class="s">&#39;more poles and zeros than expected&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_datalines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">pole</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">poles</span><span class="p">:</span>
            <span class="n">PAZ2Data</span><span class="p">(</span><span class="n">real</span><span class="o">=</span><span class="n">pole</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">imag</span><span class="o">=</span><span class="n">pole</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">zero</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeros</span><span class="p">:</span>
            <span class="n">PAZ2Data</span><span class="p">(</span><span class="n">real</span><span class="o">=</span><span class="n">zero</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">imag</span><span class="o">=</span><span class="n">zero</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="FAP2Data"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.FAP2Data">[docs]</a><span class="k">class</span> <span class="nc">FAP2Data</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of the data tuples in FAP2 section.&#39;&#39;&#39;</span>

    <span class="n">_format</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="s">&#39;f10.5&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="s">&#39;e15.8&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">29</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="s">&#39;i4&#39;</span><span class="p">)]</span>

    <span class="n">frequency</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="n">amplitude</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="n">phase</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="FAP2"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.FAP2">[docs]</a><span class="k">class</span> <span class="nc">FAP2</span><span class="p">(</span><span class="n">Stage</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a FAP2 line.&#39;&#39;&#39;</span>

    <span class="n">_format</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">x_fixed</span><span class="p">(</span><span class="s">&#39;FAP2&#39;</span><span class="p">),</span> <span class="n">dummy</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="s">&#39;i2&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="s">&#39;a1&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="s">&#39;i4&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="s">&#39;f8.3&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="s">&#39;i3&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">29</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="s">&#39;a25&#39;</span><span class="p">)]</span>

    <span class="n">output_units</span> <span class="o">=</span> <span class="n">Units</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;output units code (V=volts, A=amps, C=counts)&#39;</span><span class="p">)</span>
    <span class="n">decimation</span> <span class="o">=</span> <span class="n">Int</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;decimation&#39;</span><span class="p">)</span>
    <span class="n">correction</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;group correction applied [s]&#39;</span><span class="p">)</span>
    <span class="n">ntrip</span> <span class="o">=</span> <span class="n">Int</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;number of frequency, amplitude, phase triplets&#39;</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;description&#39;</span><span class="p">)</span>

    <span class="n">frequencies</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(),</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;frequency [Hz]&#39;</span><span class="p">)</span>
    <span class="n">amplitudes</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(),</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;amplitude [input untits/output units]&#39;</span><span class="p">)</span>
    <span class="n">phases</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(),</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;phase delay [degrees]&#39;</span><span class="p">)</span>

    <span class="n">comments</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">append_dataline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">version_dialect</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">FAP2Data</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">version_dialect</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amplitudes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">amplitude</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">phase</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_datalines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">,</span> <span class="n">phase</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">amplitudes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phases</span><span class="p">):</span>

            <span class="n">FAP2Data</span><span class="p">(</span>
                <span class="n">frequency</span><span class="o">=</span><span class="n">frequency</span><span class="p">,</span>
                <span class="n">amplitude</span><span class="o">=</span><span class="n">amplitude</span><span class="p">,</span>
                <span class="n">phase</span><span class="o">=</span><span class="n">phase</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GEN2Data"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.GEN2Data">[docs]</a><span class="k">class</span> <span class="nc">GEN2Data</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a data tuple in GEN2 section.&#39;&#39;&#39;</span>

    <span class="n">_format</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="s">&#39;f11.5&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="s">&#39;f6.3&#39;</span><span class="p">)]</span>

    <span class="n">corner</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;corner frequency [Hz]&#39;</span><span class="p">)</span>
    <span class="n">slope</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;slope above corner [dB/decate]&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GEN2"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.GEN2">[docs]</a><span class="k">class</span> <span class="nc">GEN2</span><span class="p">(</span><span class="n">Stage</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a GEN2 line.&#39;&#39;&#39;</span>

    <span class="n">_format</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">x_fixed</span><span class="p">(</span><span class="s">&#39;GEN2&#39;</span><span class="p">),</span> <span class="n">dummy</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="s">&#39;i2&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="s">&#39;a1&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="n">x_scaled</span><span class="p">(</span><span class="s">&#39;e15.8&#39;</span><span class="p">,</span> <span class="n">nm_per_s</span><span class="p">)),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="s">&#39;f7.3&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="s">&#39;i4&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="s">&#39;f8.3&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">49</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="s">&#39;i3&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">53</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="s">&#39;a25&#39;</span><span class="p">)]</span>

    <span class="n">output_units</span> <span class="o">=</span> <span class="n">Units</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;output units code (V=volts, A=amps, C=counts)&#39;</span><span class="p">)</span>
    <span class="n">calibration_factor</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;system sensitivity (m/count) at reference period &#39;</span>
             <span class="s">&#39;(calibration_period)&#39;</span><span class="p">)</span>
    <span class="n">calibration_period</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;calibration reference period [s]&#39;</span><span class="p">)</span>
    <span class="n">decimation</span> <span class="o">=</span> <span class="n">Int</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;decimation&#39;</span><span class="p">)</span>
    <span class="n">correction</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;group correction applied [s]&#39;</span><span class="p">)</span>
    <span class="n">ncorners</span> <span class="o">=</span> <span class="n">Int</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;number of corners&#39;</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;description&#39;</span><span class="p">)</span>

    <span class="n">corners</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(),</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;corner frequencies [Hz]&#39;</span><span class="p">)</span>
    <span class="n">slopes</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(),</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;slopes above corners [dB/decade]&#39;</span><span class="p">)</span>

    <span class="n">comments</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">append_dataline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">version_dialect</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">GEN2Data</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">version_dialect</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">corner</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slopes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">slope</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_datalines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">corner</span><span class="p">,</span> <span class="n">slope</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">slopes</span><span class="p">):</span>
            <span class="n">GEN2Data</span><span class="p">(</span><span class="n">corner</span><span class="o">=</span><span class="n">corner</span><span class="p">,</span> <span class="n">slope</span><span class="o">=</span><span class="n">slope</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="DIG2"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.DIG2">[docs]</a><span class="k">class</span> <span class="nc">DIG2</span><span class="p">(</span><span class="n">Stage</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a DIG2 line.&#39;&#39;&#39;</span>

    <span class="n">_format</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">x_fixed</span><span class="p">(</span><span class="s">&#39;DIG2&#39;</span><span class="p">),</span> <span class="n">dummy</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="s">&#39;i2&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="s">&#39;e15.8&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="s">&#39;f11.5&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">37</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;a25+&#39;</span><span class="p">)]</span>

    <span class="n">sensitivity</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;sensitivity [counts/input units]&#39;</span><span class="p">)</span>
    <span class="n">sample_rate</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;digitizer sample rate [Hz]&#39;</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;description&#39;</span><span class="p">)</span>

    <span class="n">comments</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="SymmetryFlag"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.SymmetryFlag">[docs]</a><span class="k">class</span> <span class="nc">SymmetryFlag</span><span class="p">(</span><span class="n">StringChoice</span><span class="p">):</span>
    <span class="n">choices</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="s">&#39;C&#39;</span><span class="p">]</span>
    <span class="n">ignore_case</span> <span class="o">=</span> <span class="bp">True</span>

</div>
<div class="viewcode-block" id="FIR2Data"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.FIR2Data">[docs]</a><span class="k">class</span> <span class="nc">FIR2Data</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a line of coefficients in a FIR2 section.&#39;&#39;&#39;</span>

    <span class="n">_format</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="s">&#39;e15.8&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="s">&#39;e15.8&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">34</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="s">&#39;e15.8&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="s">&#39;e15.8&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">66</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="s">&#39;e15.8&#39;</span><span class="p">)]</span>

    <span class="n">factors</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">factors</span> <span class="o">+</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">5</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">factors</span><span class="p">))</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">deserialize</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">version_dialect</span><span class="p">):</span>
        <span class="n">factors</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">cls</span><span class="o">.</span><span class="n">deserialize_values</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">version_dialect</span><span class="p">)</span>
                   <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">validated</span><span class="p">(</span><span class="n">factors</span><span class="o">=</span><span class="n">factors</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="FIR2"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.FIR2">[docs]</a><span class="k">class</span> <span class="nc">FIR2</span><span class="p">(</span><span class="n">Stage</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a FIR2 line.&#39;&#39;&#39;</span>

    <span class="n">_format</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">x_fixed</span><span class="p">(</span><span class="s">&#39;FIR2&#39;</span><span class="p">),</span> <span class="n">dummy</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="s">&#39;i2&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="s">&#39;e10.2&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="s">&#39;i4&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="s">&#39;f8.3&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="s">&#39;a1&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="s">&#39;i4&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">41</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;a25+&#39;</span><span class="p">)]</span>

    <span class="n">gain</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;filter gain (relative factor, not in dB)&#39;</span><span class="p">)</span>
    <span class="n">decimation</span> <span class="o">=</span> <span class="n">Int</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;decimation&#39;</span><span class="p">)</span>
    <span class="n">correction</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;group correction applied [s]&#39;</span><span class="p">)</span>
    <span class="n">symmetry</span> <span class="o">=</span> <span class="n">SymmetryFlag</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;symmetry flag (A=asymmetric, B=symmetric (odd), &#39;</span>
             <span class="s">&#39;C=symmetric (even))&#39;</span><span class="p">)</span>
    <span class="n">nfactors</span> <span class="o">=</span> <span class="n">Int</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;number of factors&#39;</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;description&#39;</span><span class="p">)</span>

    <span class="n">comments</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>

    <span class="n">factors</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">append_dataline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">version_dialect</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">FIR2Data</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">version_dialect</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">factors</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_datalines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">factors</span><span class="p">):</span>
            <span class="n">FIR2Data</span><span class="p">(</span><span class="n">factors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">factors</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">5</span><span class="p">])</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">5</span>

</div>
<div class="viewcode-block" id="Begin"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.Begin">[docs]</a><span class="k">class</span> <span class="nc">Begin</span><span class="p">(</span><span class="n">FreeFormatLine</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a BEGIN line.&#39;&#39;&#39;</span>

    <span class="n">_format</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;BEGIN&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">version</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">reader</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">reader</span><span class="o">.</span><span class="n">version_dialect</span><span class="p">)</span>
        <span class="n">reader</span><span class="o">.</span><span class="n">version_dialect</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">version</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>
        <span class="n">FreeFormatLine</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">version_dialect</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span>

</div>
<div class="viewcode-block" id="MessageType"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.MessageType">[docs]</a><span class="k">class</span> <span class="nc">MessageType</span><span class="p">(</span><span class="n">StringChoice</span><span class="p">):</span>
    <span class="n">choices</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;REQUEST&#39;</span><span class="p">,</span> <span class="s">&#39;DATA&#39;</span><span class="p">,</span> <span class="s">&#39;SUBSCRIPTION&#39;</span><span class="p">]</span>
    <span class="n">ignore_case</span> <span class="o">=</span> <span class="bp">True</span>

</div>
<div class="viewcode-block" id="MsgType"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.MsgType">[docs]</a><span class="k">class</span> <span class="nc">MsgType</span><span class="p">(</span><span class="n">FreeFormatLine</span><span class="p">):</span>
    <span class="n">_format</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;MSG_TYPE&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">MessageType</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="MsgID"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.MsgID">[docs]</a><span class="k">class</span> <span class="nc">MsgID</span><span class="p">(</span><span class="n">FreeFormatLine</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a MSG_ID line.&#39;&#39;&#39;</span>

    <span class="n">_format</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;MSG_ID&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">msg_id_string</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="n">msg_id_source</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">reader</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">reader</span><span class="o">.</span><span class="n">version_dialect</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">msg_id_source</span> <span class="ow">in</span> <span class="n">g_dialects</span><span class="p">:</span>
            <span class="n">reader</span><span class="o">.</span><span class="n">version_dialect</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">msg_id_source</span>

        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>
        <span class="n">FreeFormatLine</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg_id_source</span> <span class="ow">in</span> <span class="n">g_dialects</span><span class="p">:</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">version_dialect</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg_id_source</span>

</div>
<div class="viewcode-block" id="RefID"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.RefID">[docs]</a><span class="k">class</span> <span class="nc">RefID</span><span class="p">(</span><span class="n">FreeFormatLine</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a REF_ID line.&#39;&#39;&#39;</span>

    <span class="n">_format</span> <span class="o">=</span> <span class="p">{</span>
        <span class="bp">None</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;REF_ID&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;PART&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;OF&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
        <span class="s">&#39;GSE2.0&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;REF_ID&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]}</span>

    <span class="n">msg_id_string</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="n">msg_id_source</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">sequence_number</span> <span class="o">=</span> <span class="n">Int</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">total_number</span> <span class="o">=</span> <span class="n">Int</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version_dialect</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;REF_ID&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg_id_string</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg_id_source</span><span class="p">:</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg_id_source</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence_number</span>
            <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_number</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s">&#39;PART&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s">&#39;OF&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)])</span>

        <span class="k">return</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="LogSection"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.LogSection">[docs]</a><span class="k">class</span> <span class="nc">LogSection</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a DATA_TYPE LOG section.&#39;&#39;&#39;</span>

    <span class="n">keyword</span> <span class="o">=</span> <span class="s">&#39;LOG&#39;</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">())</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">reader</span><span class="p">):</span>
        <span class="n">DataType</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">end_section</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                <span class="n">reader</span><span class="o">.</span><span class="n">pushback</span><span class="p">()</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">lines</span><span class="o">=</span><span class="n">lines</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_datatype</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
            <span class="n">ul</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">ul</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;DATA_TYPE&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ul</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;STOP&#39;</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="n">line</span>

            <span class="n">writer</span><span class="o">.</span><span class="n">writeline</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ErrorLogSection"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.ErrorLogSection">[docs]</a><span class="k">class</span> <span class="nc">ErrorLogSection</span><span class="p">(</span><span class="n">LogSection</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a DATA_TYPE ERROR_LOG section.&#39;&#39;&#39;</span>

    <span class="n">keyword</span> <span class="o">=</span> <span class="s">&#39;ERROR_LOG&#39;</span>

</div>
<div class="viewcode-block" id="FTPLogSection"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.FTPLogSection">[docs]</a><span class="k">class</span> <span class="nc">FTPLogSection</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a DATA_TYPE FTP_LOG section.&#39;&#39;&#39;</span>

    <span class="n">keyword</span> <span class="o">=</span> <span class="s">&#39;FTP_LOG&#39;</span>
    <span class="n">ftp_file</span> <span class="o">=</span> <span class="n">FTPFile</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">reader</span><span class="p">):</span>
        <span class="n">DataType</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
        <span class="n">ftp_file</span> <span class="o">=</span> <span class="n">FTPFile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">ftp_file</span><span class="o">=</span><span class="n">ftp_file</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_datatype</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ftp_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="WID2Section"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.WID2Section">[docs]</a><span class="k">class</span> <span class="nc">WID2Section</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a WID2/STA2/EID2/BEA2/DAT2/CHK2 group.&#39;&#39;&#39;</span>

    <span class="n">wid2</span> <span class="o">=</span> <span class="n">WID2</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="n">sta2</span> <span class="o">=</span> <span class="n">STA2</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">eid2s</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">EID2</span><span class="o">.</span><span class="n">T</span><span class="p">())</span>
    <span class="n">bea2</span> <span class="o">=</span> <span class="n">BEA2</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">dat2</span> <span class="o">=</span> <span class="n">DAT2</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="n">chk2</span> <span class="o">=</span> <span class="n">CHK2</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">reader</span><span class="p">):</span>
        <span class="n">blocks</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">eid2s</span><span class="o">=</span><span class="p">[])</span>
        <span class="n">expect</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;WID2 &#39;</span><span class="p">,</span> <span class="n">WID2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>

        <span class="k">if</span> <span class="n">reader</span><span class="o">.</span><span class="n">version_dialect</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;GSE2.0&#39;</span><span class="p">:</span>
            <span class="c"># should not be there in GSE2.0, but BGR puts it there</span>
            <span class="n">expect</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;STA2 &#39;</span><span class="p">,</span> <span class="n">STA2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">expect</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;STA2 &#39;</span><span class="p">,</span> <span class="n">STA2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="n">expect</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
            <span class="p">(</span><span class="s">&#39;EID2 &#39;</span><span class="p">,</span> <span class="n">EID2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;BEA2 &#39;</span><span class="p">,</span> <span class="n">BEA2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;DAT2&#39;</span><span class="p">,</span> <span class="n">DAT2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;CHK2 &#39;</span><span class="p">,</span> <span class="n">CHK2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">handler</span><span class="p">,</span> <span class="n">required</span> <span class="ow">in</span> <span class="n">expect</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="n">reader</span><span class="o">.</span><span class="n">pushback</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">line</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DeserializeError</span><span class="p">(</span><span class="s">&#39;incomplete waveform section&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
                <span class="n">block</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s">&#39;EID2 &#39;</span><span class="p">:</span>
                    <span class="n">blocks</span><span class="p">[</span><span class="s">&#39;eid2s&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">blocks</span><span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()]</span> <span class="o">=</span> <span class="n">block</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">required</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">DeserializeError</span><span class="p">(</span><span class="s">&#39;expected </span><span class="si">%s</span><span class="s"> block&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>

        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="o">**</span><span class="n">blocks</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wid2</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sta2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sta2</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">eid2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">eid2s</span><span class="p">:</span>
            <span class="n">eid2</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bea2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bea2</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dat2</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chk2</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">pyrocko_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checksum_error</span><span class="o">=</span><span class="s">&#39;raise&#39;</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">pyrocko</span> <span class="kn">import</span> <span class="n">ims_ext</span><span class="p">,</span> <span class="n">trace</span>
        <span class="k">assert</span> <span class="n">checksum_error</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;raise&#39;</span><span class="p">,</span> <span class="s">&#39;warn&#39;</span><span class="p">,</span> <span class="s">&#39;ignore&#39;</span><span class="p">)</span>

        <span class="n">raw_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat2</span><span class="o">.</span><span class="n">raw_data</span>
        <span class="n">nsamples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wid2</span><span class="o">.</span><span class="n">nsamples</span>
        <span class="n">deltat</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">wid2</span><span class="o">.</span><span class="n">sample_rate</span>
        <span class="n">tmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wid2</span><span class="o">.</span><span class="n">time</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sta2</span><span class="p">:</span>
            <span class="n">net</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sta2</span><span class="o">.</span><span class="n">network</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">net</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">sta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wid2</span><span class="o">.</span><span class="n">station</span>
        <span class="n">loc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wid2</span><span class="o">.</span><span class="n">location</span>
        <span class="n">cha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wid2</span><span class="o">.</span><span class="n">channel</span>

        <span class="k">if</span> <span class="n">raw_data</span><span class="p">:</span>
            <span class="n">ydata</span> <span class="o">=</span> <span class="n">ims_ext</span><span class="o">.</span><span class="n">decode_cm6</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">raw_data</span><span class="p">),</span> <span class="n">nsamples</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">checksum_error</span> <span class="o">!=</span> <span class="s">&#39;ignore&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ims_ext</span><span class="o">.</span><span class="n">checksum</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chk2</span><span class="o">.</span><span class="n">checksum</span><span class="p">:</span>
                    <span class="n">mess</span> <span class="o">=</span> <span class="s">&#39;computed checksum value differs from stored value&#39;</span>
                    <span class="k">if</span> <span class="n">checksum_error</span> <span class="o">==</span> <span class="s">&#39;raise&#39;</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">DeserializeError</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">checksum_error</span> <span class="o">==</span> <span class="s">&#39;warn&#39;</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>

            <span class="n">tmax</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tmax</span> <span class="o">=</span> <span class="n">tmin</span> <span class="o">+</span> <span class="p">(</span><span class="n">nsamples</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">deltat</span>
            <span class="n">ydata</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">return</span> <span class="n">trace</span><span class="o">.</span><span class="n">Trace</span><span class="p">(</span>
            <span class="n">net</span><span class="p">,</span> <span class="n">sta</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">cha</span><span class="p">,</span> <span class="n">tmin</span><span class="o">=</span><span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><span class="n">tmax</span><span class="p">,</span>
            <span class="n">deltat</span><span class="o">=</span><span class="n">deltat</span><span class="p">,</span>
            <span class="n">ydata</span><span class="o">=</span><span class="n">ydata</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_pyrocko_trace</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">tr</span><span class="p">,</span>
                           <span class="n">lat</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">elevation</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="kn">from</span> <span class="nn">pyrocko</span> <span class="kn">import</span> <span class="n">ims_ext</span>
        <span class="n">ydata</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">get_ydata</span><span class="p">()</span>
        <span class="n">raw_data</span> <span class="o">=</span> <span class="n">ims_ext</span><span class="o">.</span><span class="n">encode_cm6</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span>
            <span class="n">wid2</span><span class="o">=</span><span class="n">WID2</span><span class="p">(</span>
                <span class="n">nsamples</span><span class="o">=</span><span class="n">tr</span><span class="o">.</span><span class="n">data_len</span><span class="p">(),</span>
                <span class="n">sample_rate</span><span class="o">=</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">tr</span><span class="o">.</span><span class="n">deltat</span><span class="p">,</span>
                <span class="n">time</span><span class="o">=</span><span class="n">tr</span><span class="o">.</span><span class="n">tmin</span><span class="p">,</span>
                <span class="n">station</span><span class="o">=</span><span class="n">tr</span><span class="o">.</span><span class="n">station</span><span class="p">,</span>
                <span class="n">location</span><span class="o">=</span><span class="n">tr</span><span class="o">.</span><span class="n">location</span><span class="p">,</span>
                <span class="n">channel</span><span class="o">=</span><span class="n">tr</span><span class="o">.</span><span class="n">channel</span><span class="p">),</span>
            <span class="n">sta2</span><span class="o">=</span><span class="n">STA2</span><span class="p">(</span>
                <span class="n">network</span><span class="o">=</span><span class="n">tr</span><span class="o">.</span><span class="n">network</span><span class="p">,</span>
                <span class="n">lat</span><span class="o">=</span><span class="n">lat</span><span class="p">,</span>
                <span class="n">lon</span><span class="o">=</span><span class="n">lon</span><span class="p">,</span>
                <span class="n">elevation</span><span class="o">=</span><span class="n">elevation</span><span class="p">,</span>
                <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">),</span>
            <span class="n">dat2</span><span class="o">=</span><span class="n">DAT2</span><span class="p">(</span>
                <span class="n">raw_data</span><span class="o">=</span><span class="p">[</span><span class="n">raw_data</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">80</span><span class="p">:(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">80</span><span class="p">]</span>
                          <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">raw_data</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">80</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]),</span>
            <span class="n">chk2</span><span class="o">=</span><span class="n">CHK2</span><span class="p">(</span>
                <span class="n">checksum</span><span class="o">=</span><span class="n">ims_ext</span><span class="o">.</span><span class="n">checksum</span><span class="p">(</span><span class="n">ydata</span><span class="p">)))</span>

</div>
<div class="viewcode-block" id="OUT2Section"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.OUT2Section">[docs]</a><span class="k">class</span> <span class="nc">OUT2Section</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a OUT2/STA2 group.&#39;&#39;&#39;</span>

    <span class="n">out2</span> <span class="o">=</span> <span class="n">OUT2</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="n">sta2</span> <span class="o">=</span> <span class="n">STA2</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">reader</span><span class="p">):</span>
        <span class="n">out2</span> <span class="o">=</span> <span class="n">OUT2</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">reader</span><span class="o">.</span><span class="n">pushback</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;STA2&#39;</span><span class="p">):</span>
            <span class="c"># the spec sais STA2 is mandatory but in practice, it is not</span>
            <span class="c"># always there...</span>
            <span class="n">sta2</span> <span class="o">=</span> <span class="n">STA2</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sta2</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">out2</span><span class="o">=</span><span class="n">out2</span><span class="p">,</span> <span class="n">sta2</span><span class="o">=</span><span class="n">sta2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out2</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sta2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sta2</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="DLY2Section"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.DLY2Section">[docs]</a><span class="k">class</span> <span class="nc">DLY2Section</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a DLY2/STA2 group.&#39;&#39;&#39;</span>

    <span class="n">dly2</span> <span class="o">=</span> <span class="n">DLY2</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="n">sta2</span> <span class="o">=</span> <span class="n">STA2</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">reader</span><span class="p">):</span>
        <span class="n">dly2</span> <span class="o">=</span> <span class="n">DLY2</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
        <span class="n">sta2</span> <span class="o">=</span> <span class="n">STA2</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">dly2</span><span class="o">=</span><span class="n">dly2</span><span class="p">,</span> <span class="n">sta2</span><span class="o">=</span><span class="n">sta2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dly2</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sta2</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="WaveformSection"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.WaveformSection">[docs]</a><span class="k">class</span> <span class="nc">WaveformSection</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a DATA_TYPE WAVEFORM line.</span>

<span class="sd">    Any subsequent WID2/OUT2/DLY2 groups are handled as indepenent sections, so</span>
<span class="sd">    this type just serves as a dummy to read/write the DATA_TYPE WAVEFORM</span>
<span class="sd">    header.&#39;&#39;&#39;</span>

    <span class="n">keyword</span> <span class="o">=</span> <span class="s">&#39;WAVEFORM&#39;</span>

    <span class="n">datatype</span> <span class="o">=</span> <span class="n">DataType</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">reader</span><span class="p">):</span>
        <span class="n">datatype</span> <span class="o">=</span> <span class="n">DataType</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">datatype</span><span class="o">=</span><span class="n">datatype</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="TableSection"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.TableSection">[docs]</a><span class="k">class</span> <span class="nc">TableSection</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Base class for table style sections.&#39;&#39;&#39;</span>

    <span class="n">has_data_type_header</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">reader</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cls</span><span class="o">.</span><span class="n">has_data_type_header</span><span class="p">:</span>
            <span class="n">DataType</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>

        <span class="n">ts</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">table_setup</span>

        <span class="n">header</span> <span class="o">=</span> <span class="n">get_versioned</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="s">&#39;header&#39;</span><span class="p">],</span> <span class="n">reader</span><span class="o">.</span><span class="n">version_dialect</span><span class="p">)</span>
        <span class="n">blocks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span>
            <span class="n">reader</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">ts</span><span class="p">[</span><span class="s">&#39;cls&#39;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="n">ts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;end&#39;</span><span class="p">,</span> <span class="n">end_section</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">ts</span><span class="p">[</span><span class="s">&#39;attribute&#39;</span><span class="p">]:</span> <span class="n">blocks</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_data_type_header</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_datatype</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>

        <span class="n">ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_setup</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">get_versioned</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="s">&#39;header&#39;</span><span class="p">],</span> <span class="n">writer</span><span class="o">.</span><span class="n">version_dialect</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts</span><span class="p">[</span><span class="s">&#39;attribute&#39;</span><span class="p">]))</span>

</div>
<div class="viewcode-block" id="NetworkSection"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.NetworkSection">[docs]</a><span class="k">class</span> <span class="nc">NetworkSection</span><span class="p">(</span><span class="n">TableSection</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a DATA_TYPE NETWORK section.&#39;&#39;&#39;</span>

    <span class="n">keyword</span> <span class="o">=</span> <span class="s">&#39;NETWORK&#39;</span>
    <span class="n">table_setup</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">header</span><span class="o">=</span><span class="s">&#39;Net       Description&#39;</span><span class="p">,</span>
        <span class="n">attribute</span><span class="o">=</span><span class="s">&#39;networks&#39;</span><span class="p">,</span>
        <span class="n">cls</span><span class="o">=</span><span class="n">Network</span><span class="p">)</span>

    <span class="n">networks</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">Network</span><span class="o">.</span><span class="n">T</span><span class="p">())</span>

</div>
<div class="viewcode-block" id="StationSection"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.StationSection">[docs]</a><span class="k">class</span> <span class="nc">StationSection</span><span class="p">(</span><span class="n">TableSection</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a DATA_TYPE STATION section.&#39;&#39;&#39;</span>

    <span class="n">keyword</span> <span class="o">=</span> <span class="s">&#39;STATION&#39;</span>
    <span class="n">table_setup</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">header</span><span class="o">=</span><span class="p">{</span>
            <span class="bp">None</span><span class="p">:</span> <span class="p">(</span>
                <span class="s">&#39;Net       Sta   Type  Latitude  Longitude Coord &#39;</span>
                <span class="s">&#39;Sys     Elev   On Date   Off Date&#39;</span><span class="p">),</span>
            <span class="s">&#39;GSE2.0&#39;</span><span class="p">:</span> <span class="p">(</span>
                <span class="s">&#39;Sta   Type  Latitude  Longitude    Elev   On Date   &#39;</span>
                <span class="s">&#39;Off Date&#39;</span><span class="p">)},</span>
        <span class="n">attribute</span><span class="o">=</span><span class="s">&#39;stations&#39;</span><span class="p">,</span>
        <span class="n">cls</span><span class="o">=</span><span class="n">Station</span><span class="p">)</span>

    <span class="n">stations</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">Station</span><span class="o">.</span><span class="n">T</span><span class="p">())</span>

</div>
<div class="viewcode-block" id="ChannelSection"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.ChannelSection">[docs]</a><span class="k">class</span> <span class="nc">ChannelSection</span><span class="p">(</span><span class="n">TableSection</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a DATA_TYPE CHANNEL section.&#39;&#39;&#39;</span>

    <span class="n">keyword</span> <span class="o">=</span> <span class="s">&#39;CHANNEL&#39;</span>
    <span class="n">table_setup</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">header</span><span class="o">=</span><span class="p">{</span>
            <span class="bp">None</span><span class="p">:</span> <span class="p">(</span>
                <span class="s">&#39;Net       Sta  Chan Aux   Latitude Longitude  Coord Sys&#39;</span>
                <span class="s">&#39;       Elev   Depth   Hang  Vang Sample Rate Inst      &#39;</span>
                <span class="s">&#39;On Date    Off Date&#39;</span><span class="p">),</span>
            <span class="s">&#39;GSE2.0&#39;</span><span class="p">:</span> <span class="p">(</span>
                <span class="s">&#39;Sta  Chan Aux   Latitude  Longitude    &#39;</span>
                <span class="s">&#39;Elev  Depth   Hang  Vang Sample_Rate Inst       &#39;</span>
                <span class="s">&#39;On Date   Off Date&#39;</span><span class="p">)},</span>
        <span class="n">attribute</span><span class="o">=</span><span class="s">&#39;channels&#39;</span><span class="p">,</span>
        <span class="n">cls</span><span class="o">=</span><span class="n">Channel</span><span class="p">)</span>

    <span class="n">channels</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">Channel</span><span class="o">.</span><span class="n">T</span><span class="p">())</span>

</div>
<div class="viewcode-block" id="BeamSection"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.BeamSection">[docs]</a><span class="k">class</span> <span class="nc">BeamSection</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a DATA_TYPE BEAM section.&#39;&#39;&#39;</span>

    <span class="n">keyword</span> <span class="o">=</span> <span class="s">&#39;BEAM&#39;</span>
    <span class="n">beam_group_header</span> <span class="o">=</span> <span class="s">&#39;Bgroup   Sta  Chan Aux  Wgt     Delay&#39;</span>
    <span class="n">beam_parameters_header</span> <span class="o">=</span> <span class="s">&#39;BeamID       Bgroup Btype R  Azim  Slow &#39;</span>\
                             <span class="s">&#39;Phase       Flo    Fhi  O Z F    &#39;</span>\
                             <span class="s">&#39;On Date    Off Date&#39;</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">BeamGroup</span><span class="o">.</span><span class="n">T</span><span class="p">())</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">BeamParameters</span><span class="o">.</span><span class="n">T</span><span class="p">())</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">reader</span><span class="p">):</span>
        <span class="n">DataType</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;BEAMID&#39;</span><span class="p">)</span>
        <span class="n">group</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="n">cls</span><span class="o">.</span><span class="n">beam_group_header</span><span class="p">,</span> <span class="n">BeamGroup</span><span class="p">,</span>
                                    <span class="n">end</span><span class="p">))</span>

        <span class="n">parameters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="n">cls</span><span class="o">.</span><span class="n">beam_parameters_header</span><span class="p">,</span>
                                         <span class="n">BeamParameters</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_datatype</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_group_header</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writeline</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_parameters_header</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="CAL2Section"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.CAL2Section">[docs]</a><span class="k">class</span> <span class="nc">CAL2Section</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a CAL2 + stages group in a response section.&#39;&#39;&#39;</span>

    <span class="n">cal2</span> <span class="o">=</span> <span class="n">CAL2</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="n">stages</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">Stage</span><span class="o">.</span><span class="n">T</span><span class="p">())</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">reader</span><span class="p">):</span>
        <span class="n">cal2</span> <span class="o">=</span> <span class="n">CAL2</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
        <span class="n">stages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">handlers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;PAZ2&#39;</span><span class="p">:</span> <span class="n">PAZ2</span><span class="p">,</span>
            <span class="s">&#39;FAP2&#39;</span><span class="p">:</span> <span class="n">FAP2</span><span class="p">,</span>
            <span class="s">&#39;GEN2&#39;</span><span class="p">:</span> <span class="n">GEN2</span><span class="p">,</span>
            <span class="s">&#39;DIG2&#39;</span><span class="p">:</span> <span class="n">DIG2</span><span class="p">,</span>
            <span class="s">&#39;FIR2&#39;</span><span class="p">:</span> <span class="n">FIR2</span><span class="p">}</span>

        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="n">reader</span><span class="o">.</span><span class="n">pushback</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">end_section</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&#39;CAL2&#39;</span><span class="p">):</span>
                <span class="k">break</span>

            <span class="n">k</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">handlers</span><span class="p">:</span>
                <span class="n">stages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handlers</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">reader</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DeserializeError</span><span class="p">(</span><span class="s">&#39;unexpected line&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">cal2</span><span class="o">=</span><span class="n">cal2</span><span class="p">,</span> <span class="n">stages</span><span class="o">=</span><span class="n">stages</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cal2</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">stage</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stages</span><span class="p">:</span>
            <span class="n">stage</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ResponseSection"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.ResponseSection">[docs]</a><span class="k">class</span> <span class="nc">ResponseSection</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a DATA_TYPE RESPONSE line.</span>

<span class="sd">    Any subsequent CAL2+stages groups are handled as indepenent sections, so</span>
<span class="sd">    this type just serves as a dummy to read/write the DATA_TYPE RESPONSE</span>
<span class="sd">    header.&#39;&#39;&#39;</span>

    <span class="n">keyword</span> <span class="o">=</span> <span class="s">&#39;RESPONSE&#39;</span>

    <span class="n">datatype</span> <span class="o">=</span> <span class="n">DataType</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">reader</span><span class="p">):</span>
        <span class="n">datatype</span> <span class="o">=</span> <span class="n">DataType</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">datatype</span><span class="o">=</span><span class="n">datatype</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="OutageSection"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.OutageSection">[docs]</a><span class="k">class</span> <span class="nc">OutageSection</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a DATA_TYPE OUTAGE section.&#39;&#39;&#39;</span>

    <span class="n">keyword</span> <span class="o">=</span> <span class="s">&#39;OUTAGE&#39;</span>
    <span class="n">outages_header</span> <span class="o">=</span> <span class="s">&#39;NET       Sta  Chan Aux      Start Date Time&#39;</span>\
                     <span class="s">&#39;          End Date Time        Duration Comment&#39;</span>
    <span class="n">report_period</span> <span class="o">=</span> <span class="n">OutageReportPeriod</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="n">outages</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">Outage</span><span class="o">.</span><span class="n">T</span><span class="p">())</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">reader</span><span class="p">):</span>
        <span class="n">DataType</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
        <span class="n">report_period</span> <span class="o">=</span> <span class="n">OutageReportPeriod</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
        <span class="n">outages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">outages</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="n">cls</span><span class="o">.</span><span class="n">outages_header</span><span class="p">,</span>
                                      <span class="n">Outage</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span>
            <span class="n">report_period</span><span class="o">=</span><span class="n">report_period</span><span class="p">,</span>
            <span class="n">outages</span><span class="o">=</span><span class="n">outages</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_datatype</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_period</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">outages_header</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">outages</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="BulletinTitle"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.BulletinTitle">[docs]</a><span class="k">class</span> <span class="nc">BulletinTitle</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>

    <span class="n">_format</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="s">&#39;a136&#39;</span><span class="p">)]</span>

    <span class="n">title</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>

</div>
<span class="n">g_event_types</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">uk</span><span class="o">=</span><span class="s">&#39;unknown&#39;</span><span class="p">,</span>
    <span class="n">ke</span><span class="o">=</span><span class="s">&#39;known earthquake&#39;</span><span class="p">,</span>
    <span class="n">se</span><span class="o">=</span><span class="s">&#39;suspected earthquake&#39;</span><span class="p">,</span>
    <span class="n">kr</span><span class="o">=</span><span class="s">&#39;known rockburst&#39;</span><span class="p">,</span>
    <span class="n">sr</span><span class="o">=</span><span class="s">&#39;suspected rockburst&#39;</span><span class="p">,</span>
    <span class="n">ki</span><span class="o">=</span><span class="s">&#39;known induced event&#39;</span><span class="p">,</span>
    <span class="n">si</span><span class="o">=</span><span class="s">&#39;suspected induced event&#39;</span><span class="p">,</span>
    <span class="n">km</span><span class="o">=</span><span class="s">&#39;known mine explosion&#39;</span><span class="p">,</span>
    <span class="n">sm</span><span class="o">=</span><span class="s">&#39;suspected mine explosion&#39;</span><span class="p">,</span>
    <span class="n">kx</span><span class="o">=</span><span class="s">&#39;known experimental explosion&#39;</span><span class="p">,</span>
    <span class="n">sx</span><span class="o">=</span><span class="s">&#39;suspected experimental explosion&#39;</span><span class="p">,</span>
    <span class="n">kn</span><span class="o">=</span><span class="s">&#39;known nuclear explosion&#39;</span><span class="p">,</span>
    <span class="n">sn</span><span class="o">=</span><span class="s">&#39;suspected nuclear explosion&#39;</span><span class="p">,</span>
    <span class="n">ls</span><span class="o">=</span><span class="s">&#39;landslide&#39;</span><span class="p">,</span>
    <span class="n">de</span><span class="o">=</span><span class="s">&#39;??&#39;</span><span class="p">,</span>
    <span class="n">fe</span><span class="o">=</span><span class="s">&#39;??&#39;</span><span class="p">,)</span>


<div class="viewcode-block" id="Origin"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.Origin">[docs]</a><span class="k">class</span> <span class="nc">Origin</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>
    <span class="n">_format</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="n">x_date_time_2frac</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="s">&#39;a1?&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="s">&#39;f5.2&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="s">&#39;f5.2&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">37</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="s">&#39;f8.4&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">46</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="s">&#39;f9.4&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">55</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="s">&#39;a1?&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">57</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="n">x_scaled</span><span class="p">(</span><span class="s">&#39;f4.1&#39;</span><span class="p">,</span> <span class="n">km</span><span class="p">)),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">62</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="n">x_scaled</span><span class="p">(</span><span class="s">&#39;f5.1&#39;</span><span class="p">,</span> <span class="n">km</span><span class="p">)),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">68</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="n">x_int_angle</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">72</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="n">x_scaled</span><span class="p">(</span><span class="s">&#39;f5.1&#39;</span><span class="p">,</span> <span class="n">km</span><span class="p">)),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">77</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="s">&#39;a1?&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">79</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="n">x_scaled</span><span class="p">(</span><span class="s">&#39;f4.1&#39;</span><span class="p">,</span> <span class="n">km</span><span class="p">)),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">84</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="s">&#39;i4&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">89</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="s">&#39;i4&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">94</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="n">x_int_angle</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">98</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="s">&#39;f6.2&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">105</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="s">&#39;f6.2&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">112</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="s">&#39;a1?&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">114</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="s">&#39;a1?&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">116</span><span class="p">,</span> <span class="mi">117</span><span class="p">,</span> <span class="s">&#39;a2?&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">119</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="s">&#39;a9&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">129</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="s">&#39;a8&#39;</span><span class="p">)]</span>

    <span class="n">time</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;epicenter date and time&#39;</span><span class="p">)</span>

    <span class="n">time_fixed</span> <span class="o">=</span> <span class="n">StringChoice</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;f&#39;</span><span class="p">],</span>
        <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;fixed flag, ``&quot;f&quot;`` if fixed origin time solution, &#39;</span>
             <span class="s">&#39;``None`` if not&#39;</span><span class="p">)</span>

    <span class="n">time_error</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;origin time error [seconds], ``None`` if fixed origin time&#39;</span><span class="p">)</span>

    <span class="n">residual</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;root mean square of time residuals [seconds]&#39;</span><span class="p">)</span>

    <span class="n">lat</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;latitude&#39;</span><span class="p">)</span>

    <span class="n">lon</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;longitude&#39;</span><span class="p">)</span>

    <span class="n">lat_lon_fixed</span> <span class="o">=</span> <span class="n">StringChoice</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;f&#39;</span><span class="p">],</span> <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;fixed flag, ``&quot;f&quot;`` if fixed epicenter solution, &#39;</span>
             <span class="s">&#39;``None`` if not&#39;</span><span class="p">)</span>

    <span class="n">ellipse_semi_major_axis</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;semi-major axis of 90</span><span class="si">% c</span><span class="s">. i. ellipse or its estimate [m], &#39;</span>
             <span class="s">&#39;``None`` if fixed&#39;</span><span class="p">)</span>

    <span class="n">ellipse_semi_minor_axis</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;semi-minor axis of 90</span><span class="si">% c</span><span class="s">. i. ellipse or its estimate [m], &#39;</span>
             <span class="s">&#39;``None`` if fixed&#39;</span><span class="p">)</span>

    <span class="n">ellipse_strike</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;strike of 90</span><span class="si">% c</span><span class="s">. i. ellipse [0-360], ``None`` if fixed&#39;</span><span class="p">)</span>

    <span class="n">depth</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;depth [m]&#39;</span><span class="p">)</span>

    <span class="n">depth_fixed</span> <span class="o">=</span> <span class="n">StringChoice</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">],</span> <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;fixed flag, ``&quot;f&quot;`` fixed depth station, &quot;d&quot; depth phases, &#39;</span>
             <span class="s">&#39;``None`` if not fixed depth&#39;</span><span class="p">)</span>

    <span class="n">depth_error</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;depth error [m], 90</span><span class="si">% c</span><span class="s">. i., ``None`` if fixed depth&#39;</span><span class="p">)</span>

    <span class="n">nphases</span> <span class="o">=</span> <span class="n">Int</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;number of defining phases&#39;</span><span class="p">)</span>

    <span class="n">nstations</span> <span class="o">=</span> <span class="n">Int</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;number of defining stations&#39;</span><span class="p">)</span>

    <span class="n">azimuthal_gap</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;gap in azimuth coverage [deg]&#39;</span><span class="p">)</span>

    <span class="n">distance_min</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;distance to closest station [deg]&#39;</span><span class="p">)</span>

    <span class="n">distance_max</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;distance to furthest station [deg]&#39;</span><span class="p">)</span>

    <span class="n">analysis_type</span> <span class="o">=</span> <span class="n">StringChoice</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="s">&#39;g&#39;</span><span class="p">],</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;analysis type, ``&quot;a&quot;`` automatic, ``&quot;m&quot;`` manual, ``&quot;g&quot;`` guess&#39;</span><span class="p">)</span>

    <span class="n">location_method</span> <span class="o">=</span> <span class="n">StringChoice</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="s">&#39;p&#39;</span><span class="p">,</span> <span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="s">&#39;o&#39;</span><span class="p">],</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;location method, ``&quot;i&quot;`` inversion, ``&quot;p&quot;`` pattern, &#39;</span>
             <span class="s">&#39;``&quot;g&quot;`` ground truth, ``&quot;o&quot;`` other&#39;</span><span class="p">)</span>

    <span class="n">event_type</span> <span class="o">=</span> <span class="n">StringChoice</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">g_event_types</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;event type, &#39;</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="s">&#39;``&quot;</span><span class="si">%s</span><span class="s">&quot;`` </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">g_event_types</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">g_event_types</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>

    <span class="n">author</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="s">&#39;author of the origin&#39;</span><span class="p">)</span>
    <span class="n">origin_id</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="s">&#39;origin identification&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="OriginSection"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.OriginSection">[docs]</a><span class="k">class</span> <span class="nc">OriginSection</span><span class="p">(</span><span class="n">TableSection</span><span class="p">):</span>
    <span class="n">has_data_type_header</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="n">table_setup</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">header</span><span class="o">=</span><span class="p">{</span>
            <span class="bp">None</span><span class="p">:</span> <span class="p">(</span>
                <span class="s">&#39;   Date       Time        Err   RMS Latitude Longitude  &#39;</span>
                <span class="s">&#39;Smaj  Smin  Az Depth   Err Ndef Nsta Gap  mdist  Mdist &#39;</span>
                <span class="s">&#39;Qual   Author      OrigID&#39;</span><span class="p">)},</span>
        <span class="n">attribute</span><span class="o">=</span><span class="s">&#39;origins&#39;</span><span class="p">,</span>
        <span class="n">end</span><span class="o">=</span><span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="n">end_section</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&#39;EVENT&#39;</span><span class="p">),</span>
        <span class="n">cls</span><span class="o">=</span><span class="n">Origin</span><span class="p">)</span>

    <span class="n">origins</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">Origin</span><span class="o">.</span><span class="n">T</span><span class="p">())</span>

</div>
<div class="viewcode-block" id="EventTitle"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.EventTitle">[docs]</a><span class="k">class</span> <span class="nc">EventTitle</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>
    <span class="n">_format</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">x_fixed</span><span class="p">(</span><span class="s">&#39;Event&#39;</span><span class="p">),</span> <span class="n">dummy</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="s">&#39;a8&#39;</span><span class="p">),</span>
        <span class="n">E</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="s">&#39;a65&#39;</span><span class="p">)]</span>

    <span class="n">event_id</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="n">region</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="EventSection"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.EventSection">[docs]</a><span class="k">class</span> <span class="nc">EventSection</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Groups Event, Arrival, ...&#39;&#39;&#39;</span>

    <span class="n">event_title</span> <span class="o">=</span> <span class="n">EventTitle</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="n">origin_section</span> <span class="o">=</span> <span class="n">OriginSection</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">reader</span><span class="p">):</span>
        <span class="n">event_title</span> <span class="o">=</span> <span class="n">EventTitle</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
        <span class="n">origin_section</span> <span class="o">=</span> <span class="n">OriginSection</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span>
            <span class="n">event_title</span><span class="o">=</span><span class="n">event_title</span><span class="p">,</span>
            <span class="n">origin_section</span><span class="o">=</span><span class="n">origin_section</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_title</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">origin_section</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="EventsSection"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.EventsSection">[docs]</a><span class="k">class</span> <span class="nc">EventsSection</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a DATA_TYPE EVENT section.&#39;&#39;&#39;</span>

    <span class="n">keyword</span> <span class="o">=</span> <span class="s">&#39;EVENT&#39;</span>

    <span class="n">bulletin_title</span> <span class="o">=</span> <span class="n">BulletinTitle</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="n">event_sections</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">EventSection</span><span class="o">.</span><span class="n">T</span><span class="p">())</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">reader</span><span class="p">):</span>
        <span class="n">DataType</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
        <span class="n">bulletin_title</span> <span class="o">=</span> <span class="n">BulletinTitle</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
        <span class="n">event_sections</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="n">reader</span><span class="o">.</span><span class="n">pushback</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">end_section</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                <span class="k">break</span>

            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;EVENT&#39;</span><span class="p">):</span>
                <span class="n">event_sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EventSection</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">reader</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span>
            <span class="n">bulletin_title</span><span class="o">=</span><span class="n">bulletin_title</span><span class="p">,</span>
            <span class="n">event_sections</span><span class="o">=</span><span class="n">event_sections</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_datatype</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bulletin_title</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">event_section</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_sections</span><span class="p">:</span>
            <span class="n">event_section</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="BulletinSection"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.BulletinSection">[docs]</a><span class="k">class</span> <span class="nc">BulletinSection</span><span class="p">(</span><span class="n">EventsSection</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a DATA_TYPE BULLETIN section.&#39;&#39;&#39;</span>

    <span class="n">keyword</span> <span class="o">=</span> <span class="s">&#39;BULLETIN&#39;</span>

</div>
<span class="k">for</span> <span class="n">sec</span> <span class="ow">in</span> <span class="p">(</span>
        <span class="n">LogSection</span><span class="p">,</span> <span class="n">ErrorLogSection</span><span class="p">,</span> <span class="n">FTPLogSection</span><span class="p">,</span> <span class="n">WaveformSection</span><span class="p">,</span>
        <span class="n">NetworkSection</span><span class="p">,</span> <span class="n">StationSection</span><span class="p">,</span> <span class="n">ChannelSection</span><span class="p">,</span> <span class="n">BeamSection</span><span class="p">,</span>
        <span class="n">ResponseSection</span><span class="p">,</span> <span class="n">OutageSection</span><span class="p">,</span> <span class="n">EventsSection</span><span class="p">,</span> <span class="n">BulletinSection</span><span class="p">):</span>

    <span class="n">Section</span><span class="o">.</span><span class="n">handlers</span><span class="p">[</span><span class="n">sec</span><span class="o">.</span><span class="n">keyword</span><span class="p">]</span> <span class="o">=</span> <span class="n">sec</span>

<span class="k">del</span> <span class="n">sec</span>


<div class="viewcode-block" id="MessageHeader"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.MessageHeader">[docs]</a><span class="k">class</span> <span class="nc">MessageHeader</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a BEGIN/MSG_TYPE/MSG_ID/REF_ID group.&#39;&#39;&#39;</span>

    <span class="n">version</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
    <span class="n">msg_id</span> <span class="o">=</span> <span class="n">MsgID</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">ref_id</span> <span class="o">=</span> <span class="n">RefID</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">reader</span><span class="p">):</span>
        <span class="n">handlers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;BEGIN&#39;</span><span class="p">:</span> <span class="n">Begin</span><span class="p">,</span>
            <span class="s">&#39;MSG_TYPE&#39;</span><span class="p">:</span> <span class="n">MsgType</span><span class="p">,</span>
            <span class="s">&#39;MSG_ID&#39;</span><span class="p">:</span> <span class="n">MsgID</span><span class="p">,</span>
            <span class="s">&#39;REF_ID&#39;</span><span class="p">:</span> <span class="n">RefID</span><span class="p">}</span>

        <span class="n">blocks</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="n">reader</span><span class="o">.</span><span class="n">pushback</span><span class="p">()</span>
            <span class="n">ok</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">handlers</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
                    <span class="n">blocks</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">handlers</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
                    <span class="n">ok</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">return</span> <span class="n">MessageHeader</span><span class="p">(</span>
            <span class="nb">type</span><span class="o">=</span><span class="n">blocks</span><span class="p">[</span><span class="s">&#39;MSG_TYPE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>
            <span class="n">version</span><span class="o">=</span><span class="n">blocks</span><span class="p">[</span><span class="s">&#39;BEGIN&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
            <span class="n">msg_id</span><span class="o">=</span><span class="n">blocks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;MSG_ID&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
            <span class="n">ref_id</span><span class="o">=</span><span class="n">blocks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;REF_ID&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>
        <span class="n">Begin</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>
        <span class="n">MsgType</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg_id</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ref_id</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">parse_ff_date_time</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">toks</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">sdate</span><span class="p">,</span> <span class="n">stime</span> <span class="o">=</span> <span class="n">toks</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sdate</span><span class="p">,</span> <span class="n">stime</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;&#39;</span>

    <span class="n">stime</span> <span class="o">+=</span> <span class="s">&#39;00:00:00.000&#39;</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">stime</span><span class="p">):]</span>
    <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">str_to_time</span><span class="p">(</span>
        <span class="n">sdate</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="n">stime</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;%Y/%m/</span><span class="si">%d</span><span class="s"> %H:%M:%S.3FRAC&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">string_ff_date_time</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">time_to_str</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;%Y/%m/</span><span class="si">%d</span><span class="s"> %H:%M:%S.3FRAC&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="TimeStamp"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.TimeStamp">[docs]</a><span class="k">class</span> <span class="nc">TimeStamp</span><span class="p">(</span><span class="n">FreeFormatLine</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a TIME_STAMP line.&#39;&#39;&#39;</span>

    <span class="n">_format</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;TIME_STAMP&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">value</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">deserialize</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">version_dialect</span><span class="p">):</span>
        <span class="p">(</span><span class="n">s</span><span class="p">,)</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">deserialize_values</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">version_dialect</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">parse_ff_date_time</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">version_dialect</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;TIME_STAMP </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">string_ff_date_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Stop"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.Stop">[docs]</a><span class="k">class</span> <span class="nc">Stop</span><span class="p">(</span><span class="n">FreeFormatLine</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a STOP line.&#39;&#39;&#39;</span>

    <span class="n">_format</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;STOP&#39;</span><span class="p">]</span>

    <span class="n">dummy</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="XW01"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.XW01">[docs]</a><span class="k">class</span> <span class="nc">XW01</span><span class="p">(</span><span class="n">FreeFormatLine</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Representation of a XW01 line (which is a relict from GSE1).&#39;&#39;&#39;</span>

    <span class="n">_format</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;XW01&#39;</span><span class="p">]</span>

    <span class="n">dummy</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

</div>
<span class="n">re_comment</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;^(%(.+)\s*| \((#?)(.+)\)\s*)$&#39;</span><span class="p">)</span>
<span class="n">re_comment_usa_dmc</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;^(%(.+)\s*| ?\((#?)(.+)\)\s*)$&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Reader</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">load_data</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dialect</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_f</span> <span class="o">=</span> <span class="n">f</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_data</span> <span class="o">=</span> <span class="n">load_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_fpos</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_lpos</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c"># &quot;physical&quot; line number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_line</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_readline_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pushed_back</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handlers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;DATA_TYPE &#39;</span><span class="p">:</span> <span class="n">Section</span><span class="p">,</span>
            <span class="s">&#39;WID2 &#39;</span><span class="p">:</span> <span class="n">WID2Section</span><span class="p">,</span>
            <span class="s">&#39;OUT2 &#39;</span><span class="p">:</span> <span class="n">OUT2Section</span><span class="p">,</span>
            <span class="s">&#39;DLY2 &#39;</span><span class="p">:</span> <span class="n">DLY2Section</span><span class="p">,</span>
            <span class="s">&#39;CAL2 &#39;</span><span class="p">:</span> <span class="n">CAL2Section</span><span class="p">,</span>
            <span class="s">&#39;BEGIN&#39;</span><span class="p">:</span> <span class="n">MessageHeader</span><span class="p">,</span>
            <span class="s">&#39;STOP&#39;</span><span class="p">:</span> <span class="n">Stop</span><span class="p">,</span>
            <span class="s">&#39;XW01&#39;</span><span class="p">:</span> <span class="n">XW01</span><span class="p">,</span>   <span class="c"># for compatibility with BGR dialect</span>
            <span class="s">&#39;HANG:&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>  <span class="c"># for compatibility with CNDC</span>
            <span class="s">&#39;VANG:&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_comment_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_time_stamps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version_dialect</span> <span class="o">=</span> <span class="p">[</span><span class="n">version</span><span class="p">,</span> <span class="n">dialect</span><span class="p">]</span>  <span class="c"># main version, dialect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_in_garbage</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">tell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_fpos</span>

    <span class="k">def</span> <span class="nf">current_line_number</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_lpos</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pushed_back</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">readline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pushed_back</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pushed_back</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_line</span>

        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_current_fpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_current_lpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readline_count</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_readline_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">l</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_current_line</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">return</span> <span class="bp">None</span>

            <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\r</span><span class="s">&#39;</span><span class="p">)]</span>
            <span class="k">while</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">):</span>
                <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_readline_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\r</span><span class="s">&#39;</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_current_line</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">version_dialect</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;USA_DMC&#39;</span><span class="p">:</span>
                <span class="n">m_comment</span> <span class="o">=</span> <span class="n">re_comment_usa_dmc</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_line</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">m_comment</span> <span class="o">=</span> <span class="n">re_comment</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_line</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="k">pass</span>

            <span class="k">elif</span> <span class="n">m_comment</span><span class="p">:</span>
                <span class="n">comment_type</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">if</span> <span class="n">m_comment</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;#&#39;</span><span class="p">:</span>
                    <span class="n">comment_type</span> <span class="o">=</span> <span class="s">&#39;ISF&#39;</span>
                <span class="k">elif</span> <span class="n">m_comment</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">comment_type</span> <span class="o">=</span> <span class="s">&#39;IMS&#39;</span>

                <span class="n">comment</span> <span class="o">=</span> <span class="n">m_comment</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="ow">or</span> <span class="n">m_comment</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_comment_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_lpos</span><span class="p">,</span> <span class="n">comment_type</span><span class="p">,</span> <span class="n">comment</span><span class="p">))</span>


            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_line</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;TIME_STAMP&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_time_stamps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">TimeStamp</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_current_line</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">version_dialect</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_line</span>

    <span class="k">def</span> <span class="nf">get_comments_after</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lpos</span><span class="p">):</span>
        <span class="n">comments</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_comment_lines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comment_lines</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">lpos</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="n">comments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_comment_lines</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">comments</span>

    <span class="k">def</span> <span class="nf">pushback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pushed_back</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pushed_back</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">line</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">StopIteration</span><span class="p">()</span>

                <span class="n">ignore</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handlers</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handlers</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="n">ignore</span> <span class="o">=</span> <span class="bp">True</span>
                            <span class="k">break</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">pushback</span><span class="p">()</span>
                        <span class="n">sec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handlers</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">Stop</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_in_garbage</span> <span class="o">=</span> <span class="bp">True</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_in_garbage</span> <span class="o">=</span> <span class="bp">False</span>
                        <span class="k">return</span> <span class="n">sec</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_in_garbage</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ignore</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">DeserializeError</span><span class="p">(</span><span class="s">&#39;unexpected line&#39;</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">DeserializeError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">e</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_current_lpos</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_current_line</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">version_dialect</span><span class="p">)</span>
            <span class="k">raise</span>


<span class="k">class</span> <span class="nc">Writer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s">&#39;GSE2.1&#39;</span><span class="p">,</span> <span class="n">dialect</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_f</span> <span class="o">=</span> <span class="n">f</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version_dialect</span> <span class="o">=</span> <span class="p">[</span><span class="n">version</span><span class="p">,</span> <span class="n">dialect</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section</span><span class="p">):</span>
        <span class="n">section</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">writeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">write_string</span><span class="p">(</span><span class="n">sections</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">cStringIO</span> <span class="kn">import</span> <span class="n">StringIO</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">Writer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">:</span>
        <span class="n">w</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>


<div class="viewcode-block" id="iload_fh"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.iload_fh">[docs]</a><span class="k">def</span> <span class="nf">iload_fh</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Load IMS/GSE2 records from open file handle.&#39;&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">Reader</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">section</span>

    <span class="k">except</span> <span class="n">DeserializeError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">FileLoadError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="iload_string"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.iload_string">[docs]</a><span class="k">def</span> <span class="nf">iload_string</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Read IMS/GSE2 sections from string.&#39;&#39;&#39;</span>

    <span class="kn">from</span> <span class="nn">cStringIO</span> <span class="kn">import</span> <span class="n">StringIO</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">iload_fh</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

</div>
<span class="n">iload_filename</span><span class="p">,</span> <span class="n">iload_dirname</span><span class="p">,</span> <span class="n">iload_glob</span><span class="p">,</span> <span class="n">iload</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">make_iload_family</span><span class="p">(</span>
    <span class="n">iload_fh</span><span class="p">,</span> <span class="s">&#39;IMS/GSE2&#39;</span><span class="p">,</span> <span class="s">&#39;:py:class:`Section`&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="dump_fh"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.dump_fh">[docs]</a><span class="k">def</span> <span class="nf">dump_fh</span><span class="p">(</span><span class="n">sections</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Dump IMS/GSE2 sections to open file handle.&#39;&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">Writer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">:</span>
            <span class="n">w</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">SerializeError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">FileSaveError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="dump_string"><a class="viewcode-back" href="../../ims.html#pyrocko.ims.dump_string">[docs]</a><span class="k">def</span> <span class="nf">dump_string</span><span class="p">(</span><span class="n">sections</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Write IMS/GSE2 sections to string.&#39;&#39;&#39;</span>

    <span class="kn">from</span> <span class="nn">cStringIO</span> <span class="kn">import</span> <span class="n">StringIO</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
    <span class="n">dump_fh</span><span class="p">(</span><span class="n">sections</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">optparse</span> <span class="kn">import</span> <span class="n">OptionParser</span>

    <span class="n">usage</span> <span class="o">=</span> <span class="s">&#39;python -m pyrocko.ims &lt;filenames&gt;&#39;</span>

    <span class="n">util</span><span class="o">.</span><span class="n">setup_logging</span><span class="p">(</span><span class="s">&#39;pyrocko.ims.__main__&#39;</span><span class="p">,</span> <span class="s">&#39;warning&#39;</span><span class="p">)</span>

    <span class="n">description</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="s">    Read and print IMS/GSE2 records.</span>
<span class="s">    &#39;&#39;&#39;</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">OptionParser</span><span class="p">(</span>
        <span class="n">usage</span><span class="o">=</span><span class="n">usage</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
        <span class="n">formatter</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">BetterHelpFormatter</span><span class="p">())</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s">&#39;--version&#39;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s">&#39;version&#39;</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">g_versions</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;inial guess for version&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s">&#39;--dialect&#39;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s">&#39;dialect&#39;</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">g_dialects</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;inial guess for dialect&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s">&#39;--load-data&#39;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s">&#39;load_data&#39;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;unpack data samples&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s">&#39;--out-version&#39;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s">&#39;out_version&#39;</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">g_versions</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;output format version&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s">&#39;--out-dialect&#39;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s">&#39;out_dialect&#39;</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">g_dialects</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;output format dialect&#39;</span><span class="p">)</span>

    <span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

    <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

            <span class="n">r</span> <span class="o">=</span> <span class="n">Reader</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">load_data</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">load_data</span><span class="p">,</span>
                       <span class="n">version</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">version</span><span class="p">,</span> <span class="n">dialect</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">dialect</span><span class="p">)</span>

            <span class="n">w</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">out_version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">Writer</span><span class="p">(</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">out_version</span><span class="p">,</span>
                    <span class="n">dialect</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">out_dialect</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">sec</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">w</span><span class="p">:</span>
                    <span class="k">print</span> <span class="n">sec</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">w</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sec</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">WID2Section</span><span class="p">)</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">load_data</span><span class="p">:</span>
                    <span class="n">tr</span> <span class="o">=</span> <span class="n">sec</span><span class="o">.</span><span class="n">pyrocko_trace</span><span class="p">(</span><span class="n">checksum_error</span><span class="o">=</span><span class="s">&#39;warn&#39;</span><span class="p">)</span>
</pre></div>

          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">Pyrocko v0.3 Manual</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2012, Sebastian Heimann. <img src="http://kinherd.org/pyrocko.png" width="5" height="5">
    </div>
  </body>
</html>