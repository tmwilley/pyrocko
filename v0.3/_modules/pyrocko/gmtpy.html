<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pyrocko.gmtpy &#8212; Pyrocko v0.3 Manual</title>
    
    <link rel="stylesheet" href="../../_static/pydoctheme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Pyrocko v0.3 Manual"
          href="../../_static/opensearch.xml"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <link rel="shortcut icon" type="image/png" href="../../_static/favicon.png" />
    <meta name="viewport" content="width=device-width,initial-scale=0.8">
    
    
    

  </head>
  <body role="document">
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="responsive-menu"><a href="#sidebar-anchor" title="Navigation">&#9776;</a></li>
        <li><a href="../../index.html">Pyrocko v0.3 Manual</a> &#187;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
    
  

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <h1>Source code for pyrocko.gmtpy</h1><div class="highlight"><pre>
<span class="sd">&#39;&#39;&#39;A Python interface to GMT.&#39;&#39;&#39;</span>

<span class="c"># This file is part of GmtPy (http://emolch.github.io/gmtpy/)</span>
<span class="c"># See there for copying and licensing information.</span>

<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">from</span> <span class="nn">cStringIO</span> <span class="k">import</span> <span class="n">StringIO</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">izip</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="k">import</span> <span class="n">join</span> <span class="k">as</span> <span class="n">pjoin</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">num</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">select</span> <span class="k">import</span> <span class="n">select</span>


<div class="viewcode-block" id="escape_shell_arg"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.escape_shell_arg">[docs]</a><span class="k">def</span> <span class="nf">escape_shell_arg</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;This function should be used for debugging output only - it could be</span>
<span class="sd">    insecure.&#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&#39;[^a-zA-Z0-9._/=-]&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s">&quot;&#39;</span><span class="se">\\</span><span class="s">&#39;&#39;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;&#39;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">s</span></div>


<div class="viewcode-block" id="escape_shell_args"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.escape_shell_args">[docs]</a><span class="k">def</span> <span class="nf">escape_shell_args</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;This function should be used for debugging output only - it could be</span>
<span class="sd">    insecure.&#39;&#39;&#39;</span>

    <span class="k">return</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">escape_shell_arg</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">])</span></div>


<span class="n">golden_ratio</span> <span class="o">=</span> <span class="mf">1.61803</span>

<span class="c"># units in points</span>
<span class="n">_units</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;i&#39;</span><span class="p">:</span> <span class="mf">72.</span><span class="p">,</span>
    <span class="s">&#39;c&#39;</span><span class="p">:</span> <span class="mf">72.</span><span class="o">/</span><span class="mf">2.54</span><span class="p">,</span>
    <span class="s">&#39;m&#39;</span><span class="p">:</span> <span class="mf">72.</span><span class="o">*</span><span class="mf">100.</span><span class="o">/</span><span class="mf">2.54</span><span class="p">,</span>
    <span class="s">&#39;p&#39;</span><span class="p">:</span> <span class="mf">1.</span><span class="p">}</span>

<span class="n">inch</span> <span class="o">=</span> <span class="n">_units</span><span class="p">[</span><span class="s">&#39;i&#39;</span><span class="p">]</span>
<span class="n">cm</span> <span class="o">=</span> <span class="n">_units</span><span class="p">[</span><span class="s">&#39;c&#39;</span><span class="p">]</span>

<span class="c"># some awsome colors</span>
<span class="n">tango_colors</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;butter1&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">252</span><span class="p">,</span> <span class="mi">233</span><span class="p">,</span>  <span class="mi">79</span><span class="p">),</span>
    <span class="s">&#39;butter2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">237</span><span class="p">,</span> <span class="mi">212</span><span class="p">,</span>   <span class="mi">0</span><span class="p">),</span>
    <span class="s">&#39;butter3&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">196</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span>   <span class="mi">0</span><span class="p">),</span>
    <span class="s">&#39;chameleon1&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">138</span><span class="p">,</span> <span class="mi">226</span><span class="p">,</span>  <span class="mi">52</span><span class="p">),</span>
    <span class="s">&#39;chameleon2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">115</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span>  <span class="mi">22</span><span class="p">),</span>
    <span class="s">&#39;chameleon3&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">78</span><span class="p">,</span> <span class="mi">154</span><span class="p">,</span>   <span class="mi">6</span><span class="p">),</span>
    <span class="s">&#39;orange1&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">252</span><span class="p">,</span> <span class="mi">175</span><span class="p">,</span>  <span class="mi">62</span><span class="p">),</span>
    <span class="s">&#39;orange2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">245</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span>   <span class="mi">0</span><span class="p">),</span>
    <span class="s">&#39;orange3&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">206</span><span class="p">,</span>  <span class="mi">92</span><span class="p">,</span>   <span class="mi">0</span><span class="p">),</span>
    <span class="s">&#39;skyblue1&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">114</span><span class="p">,</span> <span class="mi">159</span><span class="p">,</span> <span class="mi">207</span><span class="p">),</span>
    <span class="s">&#39;skyblue2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">52</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">164</span><span class="p">),</span>
    <span class="s">&#39;skyblue3&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span>  <span class="mi">74</span><span class="p">,</span> <span class="mi">135</span><span class="p">),</span>
    <span class="s">&#39;plum1&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">173</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">168</span><span class="p">),</span>
    <span class="s">&#39;plum2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">117</span><span class="p">,</span>  <span class="mi">80</span><span class="p">,</span> <span class="mi">123</span><span class="p">),</span>
    <span class="s">&#39;plum3&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">92</span><span class="p">,</span>  <span class="mi">53</span><span class="p">,</span> <span class="mi">102</span><span class="p">),</span>
    <span class="s">&#39;chocolate1&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">233</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">110</span><span class="p">),</span>
    <span class="s">&#39;chocolate2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">193</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span>  <span class="mi">17</span><span class="p">),</span>
    <span class="s">&#39;chocolate3&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">143</span><span class="p">,</span>  <span class="mi">89</span><span class="p">,</span>   <span class="mi">2</span><span class="p">),</span>
    <span class="s">&#39;scarletred1&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">239</span><span class="p">,</span>  <span class="mi">41</span><span class="p">,</span>  <span class="mi">41</span><span class="p">),</span>
    <span class="s">&#39;scarletred2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">204</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">),</span>
    <span class="s">&#39;scarletred3&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">164</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">),</span>
    <span class="s">&#39;aluminium1&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">238</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">236</span><span class="p">),</span>
    <span class="s">&#39;aluminium2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">211</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">207</span><span class="p">),</span>
    <span class="s">&#39;aluminium3&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">186</span><span class="p">,</span> <span class="mi">189</span><span class="p">,</span> <span class="mi">182</span><span class="p">),</span>
    <span class="s">&#39;aluminium4&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">136</span><span class="p">,</span> <span class="mi">138</span><span class="p">,</span> <span class="mi">133</span><span class="p">),</span>
    <span class="s">&#39;aluminium5&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">85</span><span class="p">,</span>  <span class="mi">87</span><span class="p">,</span>  <span class="mi">83</span><span class="p">),</span>
    <span class="s">&#39;aluminium6&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">46</span><span class="p">,</span>  <span class="mi">52</span><span class="p">,</span>  <span class="mi">54</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">graph_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">tango_colors</span><span class="p">[</span><span class="n">_x</span><span class="p">]</span> <span class="k">for</span> <span class="n">_x</span> <span class="ow">in</span> <span class="p">(</span>
    <span class="s">&#39;scarletred2&#39;</span><span class="p">,</span> <span class="s">&#39;skyblue3&#39;</span><span class="p">,</span> <span class="s">&#39;chameleon3&#39;</span><span class="p">,</span> <span class="s">&#39;orange2&#39;</span><span class="p">,</span> <span class="s">&#39;plum2&#39;</span><span class="p">,</span> <span class="s">&#39;chocolate2&#39;</span><span class="p">,</span>
    <span class="s">&#39;butter2&#39;</span><span class="p">)]</span>


<div class="viewcode-block" id="color"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.color">[docs]</a><span class="k">def</span> <span class="nf">color</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Generate a string for GMT option arguments expecting a color.</span>

<span class="sd">    If ``x`` is None, a random color is returned. If it is an integer, the</span>
<span class="sd">    corresponding ``gmtpy.graph_colors[x]`` or black returned. If it is a</span>
<span class="sd">    string and the corresponding ``gmtpy.tango_colors[x]`` exists, this is</span>
<span class="sd">    returned, or the string is passed through. If ``x`` is a tuple, it is</span>
<span class="sd">    transformed into the string form which GMT expects.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&#39;%i/%i/%i&#39;</span> <span class="o">%</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span> <span class="k">for</span> <span class="n">_x</span> <span class="ow">in</span> <span class="s">&#39;rgb&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">graph_colors</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&#39;%i/%i/%i&#39;</span> <span class="o">%</span> <span class="n">graph_colors</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;0/0/0&#39;</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tango_colors</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;%i/%i/%i&#39;</span> <span class="o">%</span> <span class="n">tango_colors</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x</span>

    <span class="k">return</span> <span class="s">&#39;%i/%i/%i&#39;</span> <span class="o">%</span> <span class="n">x</span></div>


<span class="k">def</span> <span class="nf">color_tup</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span> <span class="k">for</span> <span class="n">_x</span> <span class="ow">in</span> <span class="s">&#39;rgb&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">graph_colors</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">graph_colors</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tango_colors</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tango_colors</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">x</span>


<span class="n">_gmt_installations</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c"># Set fixed installation(s) to use...</span>
<span class="c"># (use this, if you want to use different GMT versions simultaneously.)</span>

<span class="c"># _gmt_installations[&#39;4.2.1&#39;] = {&#39;home&#39;: &#39;/sw/etch-ia32/gmt-4.2.1&#39;,</span>
<span class="c">#                                &#39;bin&#39;:  &#39;/sw/etch-ia32/gmt-4.2.1/bin&#39;}</span>
<span class="c"># _gmt_installations[&#39;4.3.0&#39;] = {&#39;home&#39;: &#39;/sw/etch-ia32/gmt-4.3.0&#39;,</span>
<span class="c">#                                &#39;bin&#39;:  &#39;/sw/etch-ia32/gmt-4.3.0/bin&#39;}</span>
<span class="c"># _gmt_installations[&#39;4.3.1&#39;] = {&#39;home&#39;: &#39;/sw/share/gmt&#39;,</span>
<span class="c">#                                &#39;bin&#39;:  &#39;/sw/bin&#39; }</span>

<span class="c"># ... or let GmtPy autodetect GMT via $PATH and $GMTHOME</span>


<span class="k">def</span> <span class="nf">cmp_version</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="n">ai</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)]</span>
    <span class="n">bi</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">b</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)]</span>
    <span class="k">return</span> <span class="nb">cmp</span><span class="p">(</span><span class="n">ai</span><span class="p">,</span> <span class="n">bi</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">newest_installed_gmt_version</span><span class="p">():</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">_gmt_installations</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="nb">cmp</span><span class="o">=</span><span class="n">cmp_version</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>


<span class="c"># To have consistent defaults, they are hardcoded here and should not be</span>
<span class="c"># changed.</span>

<span class="n">_gmt_defaults_by_version</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">_gmt_defaults_by_version</span><span class="p">[</span><span class="s">&#39;4.2.1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">r&#39;&#39;&#39;</span>
<span class="s">#</span>
<span class="s">#       GMT-SYSTEM 4.2.1 Defaults file</span>
<span class="s">#</span>
<span class="s">#-------- Plot Media Parameters -------------</span>
<span class="s">PAGE_COLOR              = 255/255/255</span>
<span class="s">PAGE_ORIENTATION        = portrait</span>
<span class="s">PAPER_MEDIA             = a4+</span>
<span class="s">#-------- Basemap Annotation Parameters ------</span>
<span class="s">ANNOT_MIN_ANGLE         = 20</span>
<span class="s">ANNOT_MIN_SPACING       = 0</span>
<span class="s">ANNOT_FONT_PRIMARY      = Helvetica</span>
<span class="s">ANNOT_FONT_SIZE         = 12p</span>
<span class="s">ANNOT_OFFSET_PRIMARY    = 0.075i</span>
<span class="s">ANNOT_FONT_SECONDARY    = Helvetica</span>
<span class="s">ANNOT_FONT_SIZE_SECONDARY       = 16p</span>
<span class="s">ANNOT_OFFSET_SECONDARY  = 0.075i</span>
<span class="s">DEGREE_SYMBOL           = ring</span>
<span class="s">HEADER_FONT             = Helvetica</span>
<span class="s">HEADER_FONT_SIZE        = 36p</span>
<span class="s">HEADER_OFFSET           = 0.1875i</span>
<span class="s">LABEL_FONT              = Helvetica</span>
<span class="s">LABEL_FONT_SIZE         = 14p</span>
<span class="s">LABEL_OFFSET            = 0.1125i</span>
<span class="s">OBLIQUE_ANNOTATION      = 1</span>
<span class="s">PLOT_CLOCK_FORMAT       = hh:mm:ss</span>
<span class="s">PLOT_DATE_FORMAT        = yyyy-mm-dd</span>
<span class="s">PLOT_DEGREE_FORMAT      = +ddd:mm:ss</span>
<span class="s">Y_AXIS_TYPE             = hor_text</span>
<span class="s">#-------- Basemap Layout Parameters ---------</span>
<span class="s">BASEMAP_AXES            = WESN</span>
<span class="s">BASEMAP_FRAME_RGB       = 0/0/0</span>
<span class="s">BASEMAP_TYPE            = plain</span>
<span class="s">FRAME_PEN               = 1.25p</span>
<span class="s">FRAME_WIDTH             = 0.075i</span>
<span class="s">GRID_CROSS_SIZE_PRIMARY = 0i</span>
<span class="s">GRID_CROSS_SIZE_SECONDARY       = 0i</span>
<span class="s">GRID_PEN_PRIMARY        = 0.25p</span>
<span class="s">GRID_PEN_SECONDARY      = 0.5p</span>
<span class="s">MAP_SCALE_HEIGHT        = 0.075i</span>
<span class="s">TICK_LENGTH             = 0.075i</span>
<span class="s">POLAR_CAP               = 85/90</span>
<span class="s">TICK_PEN                = 0.5p</span>
<span class="s">X_AXIS_LENGTH           = 9i</span>
<span class="s">Y_AXIS_LENGTH           = 6i</span>
<span class="s">X_ORIGIN                = 1i</span>
<span class="s">Y_ORIGIN                = 1i</span>
<span class="s">UNIX_TIME               = FALSE</span>
<span class="s">UNIX_TIME_POS           = -0.75i/-0.75i</span>
<span class="s">#-------- Color System Parameters -----------</span>
<span class="s">COLOR_BACKGROUND        = 0/0/0</span>
<span class="s">COLOR_FOREGROUND        = 255/255/255</span>
<span class="s">COLOR_NAN               = 128/128/128</span>
<span class="s">COLOR_IMAGE             = adobe</span>
<span class="s">COLOR_MODEL             = rgb</span>
<span class="s">HSV_MIN_SATURATION      = 1</span>
<span class="s">HSV_MAX_SATURATION      = 0.1</span>
<span class="s">HSV_MIN_VALUE           = 0.3</span>
<span class="s">HSV_MAX_VALUE           = 1</span>
<span class="s">#-------- PostScript Parameters -------------</span>
<span class="s">CHAR_ENCODING           = ISOLatin1+</span>
<span class="s">DOTS_PR_INCH            = 300</span>
<span class="s">N_COPIES                = 1</span>
<span class="s">PS_COLOR                = rgb</span>
<span class="s">PS_IMAGE_COMPRESS       = none</span>
<span class="s">PS_IMAGE_FORMAT         = ascii</span>
<span class="s">PS_LINE_CAP             = round</span>
<span class="s">PS_LINE_JOIN            = miter</span>
<span class="s">PS_MITER_LIMIT          = 0</span>
<span class="s">PS_VERBOSE                      = FALSE</span>
<span class="s">GLOBAL_X_SCALE          = 1</span>
<span class="s">GLOBAL_Y_SCALE          = 1</span>
<span class="s">#-------- I/O Format Parameters -------------</span>
<span class="s">D_FORMAT                = %lg</span>
<span class="s">FIELD_DELIMITER         = tab</span>
<span class="s">GRIDFILE_SHORTHAND      = FALSE</span>
<span class="s">GRID_FORMAT             = nf</span>
<span class="s">INPUT_CLOCK_FORMAT      = hh:mm:ss</span>
<span class="s">INPUT_DATE_FORMAT       = yyyy-mm-dd</span>
<span class="s">IO_HEADER               = FALSE</span>
<span class="s">N_HEADER_RECS           = 1</span>
<span class="s">OUTPUT_CLOCK_FORMAT     = hh:mm:ss</span>
<span class="s">OUTPUT_DATE_FORMAT      = yyyy-mm-dd</span>
<span class="s">OUTPUT_DEGREE_FORMAT    = +D</span>
<span class="s">XY_TOGGLE               = FALSE</span>
<span class="s">#-------- Projection Parameters -------------</span>
<span class="s">ELLIPSOID               = WGS-84</span>
<span class="s">MAP_SCALE_FACTOR        = default</span>
<span class="s">MEASURE_UNIT            = inch</span>
<span class="s">#-------- Calendar/Time Parameters ----------</span>
<span class="s">TIME_FORMAT_PRIMARY     = full</span>
<span class="s">TIME_FORMAT_SECONDARY   = full</span>
<span class="s">TIME_EPOCH              = 2000-01-01T00:00:00</span>
<span class="s">TIME_IS_INTERVAL        = OFF</span>
<span class="s">TIME_INTERVAL_FRACTION  = 0.5</span>
<span class="s">TIME_LANGUAGE           = us</span>
<span class="s">TIME_SYSTEM             = other</span>
<span class="s">TIME_UNIT               = d</span>
<span class="s">TIME_WEEK_START         = Sunday</span>
<span class="s">Y2K_OFFSET_YEAR         = 1950</span>
<span class="s">#-------- Miscellaneous Parameters ----------</span>
<span class="s">HISTORY                 = TRUE</span>
<span class="s">INTERPOLANT             = akima</span>
<span class="s">LINE_STEP               = 0.01i</span>
<span class="s">VECTOR_SHAPE            = 0</span>
<span class="s">VERBOSE                 = FALSE&#39;&#39;&#39;</span>

<span class="n">_gmt_defaults_by_version</span><span class="p">[</span><span class="s">&#39;4.3.0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">r&#39;&#39;&#39;</span>
<span class="s">#</span>
<span class="s">#	GMT-SYSTEM 4.3.0 Defaults file</span>
<span class="s">#</span>
<span class="s">#-------- Plot Media Parameters -------------</span>
<span class="s">PAGE_COLOR		= 255/255/255</span>
<span class="s">PAGE_ORIENTATION	= portrait</span>
<span class="s">PAPER_MEDIA		= a4+</span>
<span class="s">#-------- Basemap Annotation Parameters ------</span>
<span class="s">ANNOT_MIN_ANGLE		= 20</span>
<span class="s">ANNOT_MIN_SPACING	= 0</span>
<span class="s">ANNOT_FONT_PRIMARY	= Helvetica</span>
<span class="s">ANNOT_FONT_SIZE_PRIMARY	= 12p</span>
<span class="s">ANNOT_OFFSET_PRIMARY	= 0.075i</span>
<span class="s">ANNOT_FONT_SECONDARY	= Helvetica</span>
<span class="s">ANNOT_FONT_SIZE_SECONDARY	= 16p</span>
<span class="s">ANNOT_OFFSET_SECONDARY	= 0.075i</span>
<span class="s">DEGREE_SYMBOL		= ring</span>
<span class="s">HEADER_FONT		= Helvetica</span>
<span class="s">HEADER_FONT_SIZE	= 36p</span>
<span class="s">HEADER_OFFSET		= 0.1875i</span>
<span class="s">LABEL_FONT		= Helvetica</span>
<span class="s">LABEL_FONT_SIZE		= 14p</span>
<span class="s">LABEL_OFFSET		= 0.1125i</span>
<span class="s">OBLIQUE_ANNOTATION	= 1</span>
<span class="s">PLOT_CLOCK_FORMAT	= hh:mm:ss</span>
<span class="s">PLOT_DATE_FORMAT	= yyyy-mm-dd</span>
<span class="s">PLOT_DEGREE_FORMAT	= +ddd:mm:ss</span>
<span class="s">Y_AXIS_TYPE		= hor_text</span>
<span class="s">#-------- Basemap Layout Parameters ---------</span>
<span class="s">BASEMAP_AXES		= WESN</span>
<span class="s">BASEMAP_FRAME_RGB	= 0/0/0</span>
<span class="s">BASEMAP_TYPE		= plain</span>
<span class="s">FRAME_PEN		= 1.25p</span>
<span class="s">FRAME_WIDTH		= 0.075i</span>
<span class="s">GRID_CROSS_SIZE_PRIMARY	= 0i</span>
<span class="s">GRID_PEN_PRIMARY	= 0.25p</span>
<span class="s">GRID_CROSS_SIZE_SECONDARY	= 0i</span>
<span class="s">GRID_PEN_SECONDARY	= 0.5p</span>
<span class="s">MAP_SCALE_HEIGHT	= 0.075i</span>
<span class="s">POLAR_CAP		= 85/90</span>
<span class="s">TICK_LENGTH		= 0.075i</span>
<span class="s">TICK_PEN		= 0.5p</span>
<span class="s">X_AXIS_LENGTH		= 9i</span>
<span class="s">Y_AXIS_LENGTH		= 6i</span>
<span class="s">X_ORIGIN		= 1i</span>
<span class="s">Y_ORIGIN		= 1i</span>
<span class="s">UNIX_TIME		= FALSE</span>
<span class="s">UNIX_TIME_POS		= BL/-0.75i/-0.75i</span>
<span class="s">UNIX_TIME_FORMAT	= %Y %b %d %H:%M:%S</span>
<span class="s">#-------- Color System Parameters -----------</span>
<span class="s">COLOR_BACKGROUND	= 0/0/0</span>
<span class="s">COLOR_FOREGROUND	= 255/255/255</span>
<span class="s">COLOR_NAN		= 128/128/128</span>
<span class="s">COLOR_IMAGE		= adobe</span>
<span class="s">COLOR_MODEL		= rgb</span>
<span class="s">HSV_MIN_SATURATION	= 1</span>
<span class="s">HSV_MAX_SATURATION	= 0.1</span>
<span class="s">HSV_MIN_VALUE		= 0.3</span>
<span class="s">HSV_MAX_VALUE		= 1</span>
<span class="s">#-------- PostScript Parameters -------------</span>
<span class="s">CHAR_ENCODING		= ISOLatin1+</span>
<span class="s">DOTS_PR_INCH		= 300</span>
<span class="s">N_COPIES		= 1</span>
<span class="s">PS_COLOR		= rgb</span>
<span class="s">PS_IMAGE_COMPRESS	= none</span>
<span class="s">PS_IMAGE_FORMAT		= ascii</span>
<span class="s">PS_LINE_CAP		= round</span>
<span class="s">PS_LINE_JOIN		= miter</span>
<span class="s">PS_MITER_LIMIT		= 0</span>
<span class="s">PS_VERBOSE		= FALSE</span>
<span class="s">GLOBAL_X_SCALE		= 1</span>
<span class="s">GLOBAL_Y_SCALE		= 1</span>
<span class="s">#-------- I/O Format Parameters -------------</span>
<span class="s">D_FORMAT		= %lg</span>
<span class="s">FIELD_DELIMITER		= tab</span>
<span class="s">GRIDFILE_SHORTHAND	= FALSE</span>
<span class="s">GRID_FORMAT		= nf</span>
<span class="s">INPUT_CLOCK_FORMAT	= hh:mm:ss</span>
<span class="s">INPUT_DATE_FORMAT	= yyyy-mm-dd</span>
<span class="s">IO_HEADER		= FALSE</span>
<span class="s">N_HEADER_RECS		= 1</span>
<span class="s">OUTPUT_CLOCK_FORMAT	= hh:mm:ss</span>
<span class="s">OUTPUT_DATE_FORMAT	= yyyy-mm-dd</span>
<span class="s">OUTPUT_DEGREE_FORMAT	= +D</span>
<span class="s">XY_TOGGLE		= FALSE</span>
<span class="s">#-------- Projection Parameters -------------</span>
<span class="s">ELLIPSOID		= WGS-84</span>
<span class="s">MAP_SCALE_FACTOR	= default</span>
<span class="s">MEASURE_UNIT		= inch</span>
<span class="s">#-------- Calendar/Time Parameters ----------</span>
<span class="s">TIME_FORMAT_PRIMARY	= full</span>
<span class="s">TIME_FORMAT_SECONDARY	= full</span>
<span class="s">TIME_EPOCH		= 2000-01-01T00:00:00</span>
<span class="s">TIME_IS_INTERVAL	= OFF</span>
<span class="s">TIME_INTERVAL_FRACTION	= 0.5</span>
<span class="s">TIME_LANGUAGE		= us</span>
<span class="s">TIME_UNIT		= d</span>
<span class="s">TIME_WEEK_START		= Sunday</span>
<span class="s">Y2K_OFFSET_YEAR		= 1950</span>
<span class="s">#-------- Miscellaneous Parameters ----------</span>
<span class="s">HISTORY			= TRUE</span>
<span class="s">INTERPOLANT		= akima</span>
<span class="s">LINE_STEP		= 0.01i</span>
<span class="s">VECTOR_SHAPE		= 0</span>
<span class="s">VERBOSE			= FALSE&#39;&#39;&#39;</span>


<span class="n">_gmt_defaults_by_version</span><span class="p">[</span><span class="s">&#39;4.3.1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">r&#39;&#39;&#39;</span>
<span class="s">#</span>
<span class="s">#	GMT-SYSTEM 4.3.1 Defaults file</span>
<span class="s">#</span>
<span class="s">#-------- Plot Media Parameters -------------</span>
<span class="s">PAGE_COLOR		= 255/255/255</span>
<span class="s">PAGE_ORIENTATION	= portrait</span>
<span class="s">PAPER_MEDIA		= a4+</span>
<span class="s">#-------- Basemap Annotation Parameters ------</span>
<span class="s">ANNOT_MIN_ANGLE		= 20</span>
<span class="s">ANNOT_MIN_SPACING	= 0</span>
<span class="s">ANNOT_FONT_PRIMARY	= Helvetica</span>
<span class="s">ANNOT_FONT_SIZE_PRIMARY	= 12p</span>
<span class="s">ANNOT_OFFSET_PRIMARY	= 0.075i</span>
<span class="s">ANNOT_FONT_SECONDARY	= Helvetica</span>
<span class="s">ANNOT_FONT_SIZE_SECONDARY	= 16p</span>
<span class="s">ANNOT_OFFSET_SECONDARY	= 0.075i</span>
<span class="s">DEGREE_SYMBOL		= ring</span>
<span class="s">HEADER_FONT		= Helvetica</span>
<span class="s">HEADER_FONT_SIZE	= 36p</span>
<span class="s">HEADER_OFFSET		= 0.1875i</span>
<span class="s">LABEL_FONT		= Helvetica</span>
<span class="s">LABEL_FONT_SIZE		= 14p</span>
<span class="s">LABEL_OFFSET		= 0.1125i</span>
<span class="s">OBLIQUE_ANNOTATION	= 1</span>
<span class="s">PLOT_CLOCK_FORMAT	= hh:mm:ss</span>
<span class="s">PLOT_DATE_FORMAT	= yyyy-mm-dd</span>
<span class="s">PLOT_DEGREE_FORMAT	= +ddd:mm:ss</span>
<span class="s">Y_AXIS_TYPE		= hor_text</span>
<span class="s">#-------- Basemap Layout Parameters ---------</span>
<span class="s">BASEMAP_AXES		= WESN</span>
<span class="s">BASEMAP_FRAME_RGB	= 0/0/0</span>
<span class="s">BASEMAP_TYPE		= plain</span>
<span class="s">FRAME_PEN		= 1.25p</span>
<span class="s">FRAME_WIDTH		= 0.075i</span>
<span class="s">GRID_CROSS_SIZE_PRIMARY	= 0i</span>
<span class="s">GRID_PEN_PRIMARY	= 0.25p</span>
<span class="s">GRID_CROSS_SIZE_SECONDARY	= 0i</span>
<span class="s">GRID_PEN_SECONDARY	= 0.5p</span>
<span class="s">MAP_SCALE_HEIGHT	= 0.075i</span>
<span class="s">POLAR_CAP		= 85/90</span>
<span class="s">TICK_LENGTH		= 0.075i</span>
<span class="s">TICK_PEN		= 0.5p</span>
<span class="s">X_AXIS_LENGTH		= 9i</span>
<span class="s">Y_AXIS_LENGTH		= 6i</span>
<span class="s">X_ORIGIN		= 1i</span>
<span class="s">Y_ORIGIN		= 1i</span>
<span class="s">UNIX_TIME		= FALSE</span>
<span class="s">UNIX_TIME_POS		= BL/-0.75i/-0.75i</span>
<span class="s">UNIX_TIME_FORMAT	= %Y %b %d %H:%M:%S</span>
<span class="s">#-------- Color System Parameters -----------</span>
<span class="s">COLOR_BACKGROUND	= 0/0/0</span>
<span class="s">COLOR_FOREGROUND	= 255/255/255</span>
<span class="s">COLOR_NAN		= 128/128/128</span>
<span class="s">COLOR_IMAGE		= adobe</span>
<span class="s">COLOR_MODEL		= rgb</span>
<span class="s">HSV_MIN_SATURATION	= 1</span>
<span class="s">HSV_MAX_SATURATION	= 0.1</span>
<span class="s">HSV_MIN_VALUE		= 0.3</span>
<span class="s">HSV_MAX_VALUE		= 1</span>
<span class="s">#-------- PostScript Parameters -------------</span>
<span class="s">CHAR_ENCODING		= ISOLatin1+</span>
<span class="s">DOTS_PR_INCH		= 300</span>
<span class="s">N_COPIES		= 1</span>
<span class="s">PS_COLOR		= rgb</span>
<span class="s">PS_IMAGE_COMPRESS	= none</span>
<span class="s">PS_IMAGE_FORMAT		= ascii</span>
<span class="s">PS_LINE_CAP		= round</span>
<span class="s">PS_LINE_JOIN		= miter</span>
<span class="s">PS_MITER_LIMIT		= 0</span>
<span class="s">PS_VERBOSE		= FALSE</span>
<span class="s">GLOBAL_X_SCALE		= 1</span>
<span class="s">GLOBAL_Y_SCALE		= 1</span>
<span class="s">#-------- I/O Format Parameters -------------</span>
<span class="s">D_FORMAT		= %lg</span>
<span class="s">FIELD_DELIMITER		= tab</span>
<span class="s">GRIDFILE_SHORTHAND	= FALSE</span>
<span class="s">GRID_FORMAT		= nf</span>
<span class="s">INPUT_CLOCK_FORMAT	= hh:mm:ss</span>
<span class="s">INPUT_DATE_FORMAT	= yyyy-mm-dd</span>
<span class="s">IO_HEADER		= FALSE</span>
<span class="s">N_HEADER_RECS		= 1</span>
<span class="s">OUTPUT_CLOCK_FORMAT	= hh:mm:ss</span>
<span class="s">OUTPUT_DATE_FORMAT	= yyyy-mm-dd</span>
<span class="s">OUTPUT_DEGREE_FORMAT	= +D</span>
<span class="s">XY_TOGGLE		= FALSE</span>
<span class="s">#-------- Projection Parameters -------------</span>
<span class="s">ELLIPSOID		= WGS-84</span>
<span class="s">MAP_SCALE_FACTOR	= default</span>
<span class="s">MEASURE_UNIT		= inch</span>
<span class="s">#-------- Calendar/Time Parameters ----------</span>
<span class="s">TIME_FORMAT_PRIMARY	= full</span>
<span class="s">TIME_FORMAT_SECONDARY	= full</span>
<span class="s">TIME_EPOCH		= 2000-01-01T00:00:00</span>
<span class="s">TIME_IS_INTERVAL	= OFF</span>
<span class="s">TIME_INTERVAL_FRACTION	= 0.5</span>
<span class="s">TIME_LANGUAGE		= us</span>
<span class="s">TIME_UNIT		= d</span>
<span class="s">TIME_WEEK_START		= Sunday</span>
<span class="s">Y2K_OFFSET_YEAR		= 1950</span>
<span class="s">#-------- Miscellaneous Parameters ----------</span>
<span class="s">HISTORY			= TRUE</span>
<span class="s">INTERPOLANT		= akima</span>
<span class="s">LINE_STEP		= 0.01i</span>
<span class="s">VECTOR_SHAPE		= 0</span>
<span class="s">VERBOSE			= FALSE&#39;&#39;&#39;</span>


<span class="n">_gmt_defaults_by_version</span><span class="p">[</span><span class="s">&#39;4.4.0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">r&#39;&#39;&#39;</span>
<span class="s">#</span>
<span class="s">#       GMT-SYSTEM 4.4.0 [64-bit] Defaults file</span>
<span class="s">#</span>
<span class="s">#-------- Plot Media Parameters -------------</span>
<span class="s">PAGE_COLOR              = 255/255/255</span>
<span class="s">PAGE_ORIENTATION        = portrait</span>
<span class="s">PAPER_MEDIA             = a4+</span>
<span class="s">#-------- Basemap Annotation Parameters ------</span>
<span class="s">ANNOT_MIN_ANGLE         = 20</span>
<span class="s">ANNOT_MIN_SPACING       = 0</span>
<span class="s">ANNOT_FONT_PRIMARY      = Helvetica</span>
<span class="s">ANNOT_FONT_SIZE_PRIMARY = 14p</span>
<span class="s">ANNOT_OFFSET_PRIMARY    = 0.075i</span>
<span class="s">ANNOT_FONT_SECONDARY    = Helvetica</span>
<span class="s">ANNOT_FONT_SIZE_SECONDARY       = 16p</span>
<span class="s">ANNOT_OFFSET_SECONDARY  = 0.075i</span>
<span class="s">DEGREE_SYMBOL           = ring</span>
<span class="s">HEADER_FONT             = Helvetica</span>
<span class="s">HEADER_FONT_SIZE        = 36p</span>
<span class="s">HEADER_OFFSET           = 0.1875i</span>
<span class="s">LABEL_FONT              = Helvetica</span>
<span class="s">LABEL_FONT_SIZE         = 14p</span>
<span class="s">LABEL_OFFSET            = 0.1125i</span>
<span class="s">OBLIQUE_ANNOTATION      = 1</span>
<span class="s">PLOT_CLOCK_FORMAT       = hh:mm:ss</span>
<span class="s">PLOT_DATE_FORMAT        = yyyy-mm-dd</span>
<span class="s">PLOT_DEGREE_FORMAT      = +ddd:mm:ss</span>
<span class="s">Y_AXIS_TYPE             = hor_text</span>
<span class="s">#-------- Basemap Layout Parameters ---------</span>
<span class="s">BASEMAP_AXES            = WESN</span>
<span class="s">BASEMAP_FRAME_RGB       = 0/0/0</span>
<span class="s">BASEMAP_TYPE            = plain</span>
<span class="s">FRAME_PEN               = 1.25p</span>
<span class="s">FRAME_WIDTH             = 0.075i</span>
<span class="s">GRID_CROSS_SIZE_PRIMARY = 0i</span>
<span class="s">GRID_PEN_PRIMARY        = 0.25p</span>
<span class="s">GRID_CROSS_SIZE_SECONDARY       = 0i</span>
<span class="s">GRID_PEN_SECONDARY      = 0.5p</span>
<span class="s">MAP_SCALE_HEIGHT        = 0.075i</span>
<span class="s">POLAR_CAP               = 85/90</span>
<span class="s">TICK_LENGTH             = 0.075i</span>
<span class="s">TICK_PEN                = 0.5p</span>
<span class="s">X_AXIS_LENGTH           = 9i</span>
<span class="s">Y_AXIS_LENGTH           = 6i</span>
<span class="s">X_ORIGIN                = 1i</span>
<span class="s">Y_ORIGIN                = 1i</span>
<span class="s">UNIX_TIME               = FALSE</span>
<span class="s">UNIX_TIME_POS           = BL/-0.75i/-0.75i</span>
<span class="s">UNIX_TIME_FORMAT        = %Y %b %d %H:%M:%S</span>
<span class="s">#-------- Color System Parameters -----------</span>
<span class="s">COLOR_BACKGROUND        = 0/0/0</span>
<span class="s">COLOR_FOREGROUND        = 255/255/255</span>
<span class="s">COLOR_NAN               = 128/128/128</span>
<span class="s">COLOR_IMAGE             = adobe</span>
<span class="s">COLOR_MODEL             = rgb</span>
<span class="s">HSV_MIN_SATURATION      = 1</span>
<span class="s">HSV_MAX_SATURATION      = 0.1</span>
<span class="s">HSV_MIN_VALUE           = 0.3</span>
<span class="s">HSV_MAX_VALUE           = 1</span>
<span class="s">#-------- PostScript Parameters -------------</span>
<span class="s">CHAR_ENCODING           = ISOLatin1+</span>
<span class="s">DOTS_PR_INCH            = 300</span>
<span class="s">N_COPIES                = 1</span>
<span class="s">PS_COLOR                = rgb</span>
<span class="s">PS_IMAGE_COMPRESS       = lzw</span>
<span class="s">PS_IMAGE_FORMAT         = ascii</span>
<span class="s">PS_LINE_CAP             = round</span>
<span class="s">PS_LINE_JOIN            = miter</span>
<span class="s">PS_MITER_LIMIT          = 0</span>
<span class="s">PS_VERBOSE              = FALSE</span>
<span class="s">GLOBAL_X_SCALE          = 1</span>
<span class="s">GLOBAL_Y_SCALE          = 1</span>
<span class="s">#-------- I/O Format Parameters -------------</span>
<span class="s">D_FORMAT                = %lg</span>
<span class="s">FIELD_DELIMITER         = tab</span>
<span class="s">GRIDFILE_SHORTHAND      = FALSE</span>
<span class="s">GRID_FORMAT             = nf</span>
<span class="s">INPUT_CLOCK_FORMAT      = hh:mm:ss</span>
<span class="s">INPUT_DATE_FORMAT       = yyyy-mm-dd</span>
<span class="s">IO_HEADER               = FALSE</span>
<span class="s">N_HEADER_RECS           = 1</span>
<span class="s">OUTPUT_CLOCK_FORMAT     = hh:mm:ss</span>
<span class="s">OUTPUT_DATE_FORMAT      = yyyy-mm-dd</span>
<span class="s">OUTPUT_DEGREE_FORMAT    = +D</span>
<span class="s">XY_TOGGLE               = FALSE</span>
<span class="s">#-------- Projection Parameters -------------</span>
<span class="s">ELLIPSOID               = WGS-84</span>
<span class="s">MAP_SCALE_FACTOR        = default</span>
<span class="s">MEASURE_UNIT            = inch</span>
<span class="s">#-------- Calendar/Time Parameters ----------</span>
<span class="s">TIME_FORMAT_PRIMARY     = full</span>
<span class="s">TIME_FORMAT_SECONDARY   = full</span>
<span class="s">TIME_EPOCH              = 2000-01-01T00:00:00</span>
<span class="s">TIME_IS_INTERVAL        = OFF</span>
<span class="s">TIME_INTERVAL_FRACTION  = 0.5</span>
<span class="s">TIME_LANGUAGE           = us</span>
<span class="s">TIME_UNIT               = d</span>
<span class="s">TIME_WEEK_START         = Sunday</span>
<span class="s">Y2K_OFFSET_YEAR         = 1950</span>
<span class="s">#-------- Miscellaneous Parameters ----------</span>
<span class="s">HISTORY                 = TRUE</span>
<span class="s">INTERPOLANT             = akima</span>
<span class="s">LINE_STEP               = 0.01i</span>
<span class="s">VECTOR_SHAPE            = 0</span>
<span class="s">VERBOSE                 = FALSE</span>
<span class="s">&#39;&#39;&#39;</span>

<span class="n">_gmt_defaults_by_version</span><span class="p">[</span><span class="s">&#39;4.5.2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">r&#39;&#39;&#39;</span>
<span class="s">#</span>
<span class="s">#       GMT-SYSTEM 4.5.2 [64-bit] Defaults file</span>
<span class="s">#</span>
<span class="s">#-------- Plot Media Parameters -------------</span>
<span class="s">PAGE_COLOR              = white</span>
<span class="s">PAGE_ORIENTATION        = portrait</span>
<span class="s">PAPER_MEDIA             = a4+</span>
<span class="s">#-------- Basemap Annotation Parameters ------</span>
<span class="s">ANNOT_MIN_ANGLE         = 20</span>
<span class="s">ANNOT_MIN_SPACING       = 0</span>
<span class="s">ANNOT_FONT_PRIMARY      = Helvetica</span>
<span class="s">ANNOT_FONT_SIZE_PRIMARY = 14p</span>
<span class="s">ANNOT_OFFSET_PRIMARY    = 0.075i</span>
<span class="s">ANNOT_FONT_SECONDARY    = Helvetica</span>
<span class="s">ANNOT_FONT_SIZE_SECONDARY       = 16p</span>
<span class="s">ANNOT_OFFSET_SECONDARY  = 0.075i</span>
<span class="s">DEGREE_SYMBOL           = ring</span>
<span class="s">HEADER_FONT             = Helvetica</span>
<span class="s">HEADER_FONT_SIZE        = 36p</span>
<span class="s">HEADER_OFFSET           = 0.1875i</span>
<span class="s">LABEL_FONT              = Helvetica</span>
<span class="s">LABEL_FONT_SIZE         = 14p</span>
<span class="s">LABEL_OFFSET            = 0.1125i</span>
<span class="s">OBLIQUE_ANNOTATION      = 1</span>
<span class="s">PLOT_CLOCK_FORMAT       = hh:mm:ss</span>
<span class="s">PLOT_DATE_FORMAT        = yyyy-mm-dd</span>
<span class="s">PLOT_DEGREE_FORMAT      = +ddd:mm:ss</span>
<span class="s">Y_AXIS_TYPE             = hor_text</span>
<span class="s">#-------- Basemap Layout Parameters ---------</span>
<span class="s">BASEMAP_AXES            = WESN</span>
<span class="s">BASEMAP_FRAME_RGB       = black</span>
<span class="s">BASEMAP_TYPE            = plain</span>
<span class="s">FRAME_PEN               = 1.25p</span>
<span class="s">FRAME_WIDTH             = 0.075i</span>
<span class="s">GRID_CROSS_SIZE_PRIMARY = 0i</span>
<span class="s">GRID_PEN_PRIMARY        = 0.25p</span>
<span class="s">GRID_CROSS_SIZE_SECONDARY       = 0i</span>
<span class="s">GRID_PEN_SECONDARY      = 0.5p</span>
<span class="s">MAP_SCALE_HEIGHT        = 0.075i</span>
<span class="s">POLAR_CAP               = 85/90</span>
<span class="s">TICK_LENGTH             = 0.075i</span>
<span class="s">TICK_PEN                = 0.5p</span>
<span class="s">X_AXIS_LENGTH           = 9i</span>
<span class="s">Y_AXIS_LENGTH           = 6i</span>
<span class="s">X_ORIGIN                = 1i</span>
<span class="s">Y_ORIGIN                = 1i</span>
<span class="s">UNIX_TIME               = FALSE</span>
<span class="s">UNIX_TIME_POS           = BL/-0.75i/-0.75i</span>
<span class="s">UNIX_TIME_FORMAT        = %Y %b %d %H:%M:%S</span>
<span class="s">#-------- Color System Parameters -----------</span>
<span class="s">COLOR_BACKGROUND        = black</span>
<span class="s">COLOR_FOREGROUND        = white</span>
<span class="s">COLOR_NAN               = 128</span>
<span class="s">COLOR_IMAGE             = adobe</span>
<span class="s">COLOR_MODEL             = rgb</span>
<span class="s">HSV_MIN_SATURATION      = 1</span>
<span class="s">HSV_MAX_SATURATION      = 0.1</span>
<span class="s">HSV_MIN_VALUE           = 0.3</span>
<span class="s">HSV_MAX_VALUE           = 1</span>
<span class="s">#-------- PostScript Parameters -------------</span>
<span class="s">CHAR_ENCODING           = ISOLatin1+</span>
<span class="s">DOTS_PR_INCH            = 300</span>
<span class="s">GLOBAL_X_SCALE          = 1</span>
<span class="s">GLOBAL_Y_SCALE          = 1</span>
<span class="s">N_COPIES                = 1</span>
<span class="s">PS_COLOR                = rgb</span>
<span class="s">PS_IMAGE_COMPRESS       = lzw</span>
<span class="s">PS_IMAGE_FORMAT         = ascii</span>
<span class="s">PS_LINE_CAP             = round</span>
<span class="s">PS_LINE_JOIN            = miter</span>
<span class="s">PS_MITER_LIMIT          = 0</span>
<span class="s">PS_VERBOSE              = FALSE</span>
<span class="s">TRANSPARENCY            = 0</span>
<span class="s">#-------- I/O Format Parameters -------------</span>
<span class="s">D_FORMAT                = %.12lg</span>
<span class="s">FIELD_DELIMITER         = tab</span>
<span class="s">GRIDFILE_FORMAT         = nf</span>
<span class="s">GRIDFILE_SHORTHAND      = FALSE</span>
<span class="s">INPUT_CLOCK_FORMAT      = hh:mm:ss</span>
<span class="s">INPUT_DATE_FORMAT       = yyyy-mm-dd</span>
<span class="s">IO_HEADER               = FALSE</span>
<span class="s">N_HEADER_RECS           = 1</span>
<span class="s">NAN_RECORDS             = pass</span>
<span class="s">OUTPUT_CLOCK_FORMAT     = hh:mm:ss</span>
<span class="s">OUTPUT_DATE_FORMAT      = yyyy-mm-dd</span>
<span class="s">OUTPUT_DEGREE_FORMAT    = D</span>
<span class="s">XY_TOGGLE               = FALSE</span>
<span class="s">#-------- Projection Parameters -------------</span>
<span class="s">ELLIPSOID               = WGS-84</span>
<span class="s">MAP_SCALE_FACTOR        = default</span>
<span class="s">MEASURE_UNIT            = inch</span>
<span class="s">#-------- Calendar/Time Parameters ----------</span>
<span class="s">TIME_FORMAT_PRIMARY     = full</span>
<span class="s">TIME_FORMAT_SECONDARY   = full</span>
<span class="s">TIME_EPOCH              = 2000-01-01T00:00:00</span>
<span class="s">TIME_IS_INTERVAL        = OFF</span>
<span class="s">TIME_INTERVAL_FRACTION  = 0.5</span>
<span class="s">TIME_LANGUAGE           = us</span>
<span class="s">TIME_UNIT               = d</span>
<span class="s">TIME_WEEK_START         = Sunday</span>
<span class="s">Y2K_OFFSET_YEAR         = 1950</span>
<span class="s">#-------- Miscellaneous Parameters ----------</span>
<span class="s">HISTORY                 = TRUE</span>
<span class="s">INTERPOLANT             = akima</span>
<span class="s">LINE_STEP               = 0.01i</span>
<span class="s">VECTOR_SHAPE            = 0</span>
<span class="s">VERBOSE                 = FALSE</span>
<span class="s">&#39;&#39;&#39;</span>

<span class="n">_gmt_defaults_by_version</span><span class="p">[</span><span class="s">&#39;4.5.3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">r&#39;&#39;&#39;</span>
<span class="s">#</span>
<span class="s">#       GMT-SYSTEM 4.5.3 (CVS Jun 18 2010 10:56:07) [64-bit] Defaults file</span>
<span class="s">#</span>
<span class="s">#-------- Plot Media Parameters -------------</span>
<span class="s">PAGE_COLOR              = white</span>
<span class="s">PAGE_ORIENTATION        = portrait</span>
<span class="s">PAPER_MEDIA             = a4+</span>
<span class="s">#-------- Basemap Annotation Parameters ------</span>
<span class="s">ANNOT_MIN_ANGLE         = 20</span>
<span class="s">ANNOT_MIN_SPACING       = 0</span>
<span class="s">ANNOT_FONT_PRIMARY      = Helvetica</span>
<span class="s">ANNOT_FONT_SIZE_PRIMARY = 14p</span>
<span class="s">ANNOT_OFFSET_PRIMARY    = 0.075i</span>
<span class="s">ANNOT_FONT_SECONDARY    = Helvetica</span>
<span class="s">ANNOT_FONT_SIZE_SECONDARY       = 16p</span>
<span class="s">ANNOT_OFFSET_SECONDARY  = 0.075i</span>
<span class="s">DEGREE_SYMBOL           = ring</span>
<span class="s">HEADER_FONT             = Helvetica</span>
<span class="s">HEADER_FONT_SIZE        = 36p</span>
<span class="s">HEADER_OFFSET           = 0.1875i</span>
<span class="s">LABEL_FONT              = Helvetica</span>
<span class="s">LABEL_FONT_SIZE         = 14p</span>
<span class="s">LABEL_OFFSET            = 0.1125i</span>
<span class="s">OBLIQUE_ANNOTATION      = 1</span>
<span class="s">PLOT_CLOCK_FORMAT       = hh:mm:ss</span>
<span class="s">PLOT_DATE_FORMAT        = yyyy-mm-dd</span>
<span class="s">PLOT_DEGREE_FORMAT      = +ddd:mm:ss</span>
<span class="s">Y_AXIS_TYPE             = hor_text</span>
<span class="s">#-------- Basemap Layout Parameters ---------</span>
<span class="s">BASEMAP_AXES            = WESN</span>
<span class="s">BASEMAP_FRAME_RGB       = black</span>
<span class="s">BASEMAP_TYPE            = plain</span>
<span class="s">FRAME_PEN               = 1.25p</span>
<span class="s">FRAME_WIDTH             = 0.075i</span>
<span class="s">GRID_CROSS_SIZE_PRIMARY = 0i</span>
<span class="s">GRID_PEN_PRIMARY        = 0.25p</span>
<span class="s">GRID_CROSS_SIZE_SECONDARY       = 0i</span>
<span class="s">GRID_PEN_SECONDARY      = 0.5p</span>
<span class="s">MAP_SCALE_HEIGHT        = 0.075i</span>
<span class="s">POLAR_CAP               = 85/90</span>
<span class="s">TICK_LENGTH             = 0.075i</span>
<span class="s">TICK_PEN                = 0.5p</span>
<span class="s">X_AXIS_LENGTH           = 9i</span>
<span class="s">Y_AXIS_LENGTH           = 6i</span>
<span class="s">X_ORIGIN                = 1i</span>
<span class="s">Y_ORIGIN                = 1i</span>
<span class="s">UNIX_TIME               = FALSE</span>
<span class="s">UNIX_TIME_POS           = BL/-0.75i/-0.75i</span>
<span class="s">UNIX_TIME_FORMAT        = %Y %b %d %H:%M:%S</span>
<span class="s">#-------- Color System Parameters -----------</span>
<span class="s">COLOR_BACKGROUND        = black</span>
<span class="s">COLOR_FOREGROUND        = white</span>
<span class="s">COLOR_NAN               = 128</span>
<span class="s">COLOR_IMAGE             = adobe</span>
<span class="s">COLOR_MODEL             = rgb</span>
<span class="s">HSV_MIN_SATURATION      = 1</span>
<span class="s">HSV_MAX_SATURATION      = 0.1</span>
<span class="s">HSV_MIN_VALUE           = 0.3</span>
<span class="s">HSV_MAX_VALUE           = 1</span>
<span class="s">#-------- PostScript Parameters -------------</span>
<span class="s">CHAR_ENCODING           = ISOLatin1+</span>
<span class="s">DOTS_PR_INCH            = 300</span>
<span class="s">GLOBAL_X_SCALE          = 1</span>
<span class="s">GLOBAL_Y_SCALE          = 1</span>
<span class="s">N_COPIES                = 1</span>
<span class="s">PS_COLOR                = rgb</span>
<span class="s">PS_IMAGE_COMPRESS       = lzw</span>
<span class="s">PS_IMAGE_FORMAT         = ascii</span>
<span class="s">PS_LINE_CAP             = round</span>
<span class="s">PS_LINE_JOIN            = miter</span>
<span class="s">PS_MITER_LIMIT          = 0</span>
<span class="s">PS_VERBOSE              = FALSE</span>
<span class="s">TRANSPARENCY            = 0</span>
<span class="s">#-------- I/O Format Parameters -------------</span>
<span class="s">D_FORMAT                = %.12lg</span>
<span class="s">FIELD_DELIMITER         = tab</span>
<span class="s">GRIDFILE_FORMAT         = nf</span>
<span class="s">GRIDFILE_SHORTHAND      = FALSE</span>
<span class="s">INPUT_CLOCK_FORMAT      = hh:mm:ss</span>
<span class="s">INPUT_DATE_FORMAT       = yyyy-mm-dd</span>
<span class="s">IO_HEADER               = FALSE</span>
<span class="s">N_HEADER_RECS           = 1</span>
<span class="s">NAN_RECORDS             = pass</span>
<span class="s">OUTPUT_CLOCK_FORMAT     = hh:mm:ss</span>
<span class="s">OUTPUT_DATE_FORMAT      = yyyy-mm-dd</span>
<span class="s">OUTPUT_DEGREE_FORMAT    = D</span>
<span class="s">XY_TOGGLE               = FALSE</span>
<span class="s">#-------- Projection Parameters -------------</span>
<span class="s">ELLIPSOID               = WGS-84</span>
<span class="s">MAP_SCALE_FACTOR        = default</span>
<span class="s">MEASURE_UNIT            = inch</span>
<span class="s">#-------- Calendar/Time Parameters ----------</span>
<span class="s">TIME_FORMAT_PRIMARY     = full</span>
<span class="s">TIME_FORMAT_SECONDARY   = full</span>
<span class="s">TIME_EPOCH              = 2000-01-01T00:00:00</span>
<span class="s">TIME_IS_INTERVAL        = OFF</span>
<span class="s">TIME_INTERVAL_FRACTION  = 0.5</span>
<span class="s">TIME_LANGUAGE           = us</span>
<span class="s">TIME_UNIT               = d</span>
<span class="s">TIME_WEEK_START         = Sunday</span>
<span class="s">Y2K_OFFSET_YEAR         = 1950</span>
<span class="s">#-------- Miscellaneous Parameters ----------</span>
<span class="s">HISTORY                 = TRUE</span>
<span class="s">INTERPOLANT             = akima</span>
<span class="s">LINE_STEP               = 0.01i</span>
<span class="s">VECTOR_SHAPE            = 0</span>
<span class="s">VERBOSE                 = FALSE</span>
<span class="s">&#39;&#39;&#39;</span>


<span class="k">def</span> <span class="nf">get_gmt_version</span><span class="p">(</span><span class="n">gmtdefaultsbinary</span><span class="p">,</span> <span class="n">gmthomedir</span><span class="p">):</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">gmtdefaultsbinary</span><span class="p">]</span>

    <span class="n">environ</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">environ</span><span class="p">[</span><span class="s">&#39;GMTHOME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gmthomedir</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">environ</span><span class="p">)</span>
    <span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">)</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&#39;(\d+(\.\d+)*)&#39;</span><span class="p">,</span> <span class="n">stderr</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Can&#39;t extract version number from output of %s&quot;</span> <span class="o">%</span>
                        <span class="n">gmtdefaultsbinary</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">detect_gmt_installation</span><span class="p">():</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
        <span class="p">[</span><span class="s">&quot;which&quot;</span><span class="p">,</span> <span class="s">&quot;gmtdefaults&quot;</span><span class="p">],</span>
        <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span><span class="o">.</span><span class="n">communicate</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Can&#39;t find GMT installation via PATH&quot;</span><span class="p">)</span>

    <span class="n">gmtbin</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
    <span class="n">gmthome</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;GMTHOME&#39;</span><span class="p">]</span>  <span class="c"># should throw a KeyError if not satisfied</span>

    <span class="n">gmtversion</span> <span class="o">=</span> <span class="n">get_gmt_version</span><span class="p">(</span><span class="n">pjoin</span><span class="p">(</span><span class="n">gmtbin</span><span class="p">,</span> <span class="s">&#39;gmtdefaults&#39;</span><span class="p">),</span> <span class="n">gmthome</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gmtversion</span><span class="p">,</span> <span class="n">gmthome</span><span class="p">,</span> <span class="n">gmtbin</span>


<span class="k">def</span> <span class="nf">check_default_ubuntu_gmt_path</span><span class="p">():</span>
    <span class="n">gmtbin</span> <span class="o">=</span> <span class="n">pjoin</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="s">&#39;usr&#39;</span><span class="p">,</span> <span class="s">&#39;lib&#39;</span><span class="p">,</span> <span class="s">&#39;gmt&#39;</span><span class="p">,</span> <span class="s">&#39;bin&#39;</span><span class="p">)</span>
    <span class="n">gmthome</span> <span class="o">=</span> <span class="n">pjoin</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="s">&#39;usr&#39;</span><span class="p">,</span> <span class="s">&#39;lib&#39;</span><span class="p">,</span> <span class="s">&#39;gmt&#39;</span><span class="p">)</span>
    <span class="n">gmtversion</span> <span class="o">=</span> <span class="n">get_gmt_version</span><span class="p">(</span><span class="n">pjoin</span><span class="p">(</span><span class="n">gmtbin</span><span class="p">,</span> <span class="s">&#39;gmtdefaults&#39;</span><span class="p">),</span> <span class="n">gmthome</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gmtversion</span><span class="p">,</span> <span class="n">gmthome</span><span class="p">,</span> <span class="n">gmtbin</span>


<span class="k">def</span> <span class="nf">check_detect_gmt_installation</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">detect_gmt_installation</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">check_default_ubuntu_gmt_path</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Can&#39;t find GMT installation via PATH or default location&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">appropriate_defaults_version</span><span class="p">(</span><span class="n">version</span><span class="p">):</span>

    <span class="n">avails</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">_gmt_defaults_by_version</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="nb">cmp</span><span class="o">=</span><span class="n">cmp_version</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">iavail</span><span class="p">,</span> <span class="n">avail</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">avails</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">cmp_version</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="n">avail</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">version</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">avails</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">iavail</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>

    <span class="k">return</span> <span class="n">avails</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>


<div class="viewcode-block" id="gmt_default_config"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.gmt_default_config">[docs]</a><span class="k">def</span> <span class="nf">gmt_default_config</span><span class="p">(</span><span class="n">version</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Get default GMT configuration dict for given version.&#39;&#39;&#39;</span>

    <span class="n">xversion</span> <span class="o">=</span> <span class="n">appropriate_defaults_version</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>

    <span class="c"># if not version in _gmt_defaults_by_version:</span>
    <span class="c">#     raise Exception(&#39;No GMT defaults for version %s found&#39; % version)</span>

    <span class="n">gmt_defaults</span> <span class="o">=</span> <span class="n">_gmt_defaults_by_version</span><span class="p">[</span><span class="n">xversion</span><span class="p">]</span>

    <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">gmt_defaults</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="n">sline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sline</span> <span class="ow">or</span> <span class="n">sline</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">):</span>
            <span class="k">continue</span>

        <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">sline</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">d</span></div>


<span class="k">def</span> <span class="nf">diff_defaults</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">):</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="n">gmt_default_config</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="n">gmt_default_config</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d2</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s">&#39;%s not in %s&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">d1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="n">d2</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                <span class="nb">print</span> <span class="s">&#39;%s %s = %s&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">d1</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="nb">print</span> <span class="s">&#39;%s %s = %s&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">d2</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d1</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s">&#39;%s not in %s&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v1</span><span class="p">)</span>

<span class="c"># diff_defaults(&#39;4.5.2&#39;, &#39;4.5.3&#39;)</span>


<span class="k">def</span> <span class="nf">setup_gmt_installations</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">setup_gmt_installations</span><span class="o">.</span><span class="n">have_done</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_gmt_installations</span><span class="p">:</span>
            <span class="n">gmtversion</span><span class="p">,</span> <span class="n">gmthome</span><span class="p">,</span> <span class="n">gmtbin</span> <span class="o">=</span> <span class="n">check_detect_gmt_installation</span><span class="p">()</span>
            <span class="n">_gmt_installations</span><span class="p">[</span><span class="n">gmtversion</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;home&#39;</span><span class="p">:</span> <span class="n">gmthome</span><span class="p">,</span> <span class="s">&#39;bin&#39;</span><span class="p">:</span> <span class="n">gmtbin</span><span class="p">}</span>

        <span class="c"># store defaults as dicts into the gmt installations dicts</span>
        <span class="k">for</span> <span class="n">version</span><span class="p">,</span> <span class="n">installation</span> <span class="ow">in</span> <span class="n">_gmt_installations</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">installation</span><span class="p">[</span><span class="s">&#39;defaults&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gmt_default_config</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
            <span class="n">installation</span><span class="p">[</span><span class="s">&#39;version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">version</span>

        <span class="c"># alias for the newest installed gmt version</span>
        <span class="n">_gmt_installations</span><span class="p">[</span><span class="s">&#39;newest&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_gmt_installations</span><span class="p">[</span>
            <span class="n">newest_installed_gmt_version</span><span class="p">()]</span>
        <span class="n">setup_gmt_installations</span><span class="o">.</span><span class="n">have_done</span> <span class="o">=</span> <span class="k">True</span>


<span class="n">setup_gmt_installations</span><span class="o">.</span><span class="n">have_done</span> <span class="o">=</span> <span class="k">False</span>

<span class="n">_paper_sizes_a</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;A0 2380 3368</span>
<span class="s">                      A1 1684 2380</span>
<span class="s">                      A2 1190 1684</span>
<span class="s">                      A3 842 1190</span>
<span class="s">                      A4 595 842</span>
<span class="s">                      A5 421 595</span>
<span class="s">                      A6 297 421</span>
<span class="s">                      A7 210 297</span>
<span class="s">                      A8 148 210</span>
<span class="s">                      A9 105 148</span>
<span class="s">                      A10 74 105</span>
<span class="s">                      B0 2836 4008</span>
<span class="s">                      B1 2004 2836</span>
<span class="s">                      B2 1418 2004</span>
<span class="s">                      B3 1002 1418</span>
<span class="s">                      B4 709 1002</span>
<span class="s">                      B5 501 709</span>
<span class="s">                      archA 648 864</span>
<span class="s">                      archB 864 1296</span>
<span class="s">                      archC 1296 1728</span>
<span class="s">                      archD 1728 2592</span>
<span class="s">                      archE 2592 3456</span>
<span class="s">                      flsa 612 936</span>
<span class="s">                      halfletter 396 612</span>
<span class="s">                      note 540 720</span>
<span class="s">                      letter 612 792</span>
<span class="s">                      legal 612 1008</span>
<span class="s">                      11x17 792 1224</span>
<span class="s">                      ledger 1224 792&#39;&#39;&#39;</span>


<span class="n">_paper_sizes</span> <span class="o">=</span> <span class="p">{}</span>


<span class="k">def</span> <span class="nf">setup_paper_sizes</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_paper_sizes</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">_paper_sizes_a</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
            <span class="n">k</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">_paper_sizes</span><span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">w</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_paper_size</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
    <span class="n">setup_paper_sizes</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">_paper_sizes</span><span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;+&#39;</span><span class="p">)]</span>


<span class="k">def</span> <span class="nf">all_paper_sizes</span><span class="p">():</span>
    <span class="n">setup_paper_sizes</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">_paper_sizes</span>


<span class="k">def</span> <span class="nf">make_bbox</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">gmt_config</span><span class="p">,</span> <span class="n">margins</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)):</span>

    <span class="n">leftmargin</span><span class="p">,</span> <span class="n">topmargin</span><span class="p">,</span> <span class="n">rightmargin</span><span class="p">,</span> <span class="n">bottommargin</span> <span class="o">=</span> <span class="n">margins</span>
    <span class="n">portrait</span> <span class="o">=</span> <span class="n">gmt_config</span><span class="p">[</span><span class="s">&#39;PAGE_ORIENTATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;portrait&#39;</span>

    <span class="n">paper_size</span> <span class="o">=</span> <span class="n">get_paper_size</span><span class="p">(</span><span class="n">gmt_config</span><span class="p">[</span><span class="s">&#39;PAPER_MEDIA&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">portrait</span><span class="p">:</span>
        <span class="n">paper_size</span> <span class="o">=</span> <span class="n">paper_size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">paper_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">xoffset</span> <span class="o">=</span> <span class="p">(</span><span class="n">paper_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">width</span> <span class="o">+</span> <span class="n">leftmargin</span> <span class="o">+</span> <span class="n">rightmargin</span><span class="p">))</span> <span class="o">/</span> \
        <span class="mf">2.0</span> <span class="o">+</span> <span class="n">leftmargin</span>
    <span class="n">yoffset</span> <span class="o">=</span> <span class="p">(</span><span class="n">paper_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">height</span> <span class="o">+</span> <span class="n">topmargin</span> <span class="o">+</span> <span class="n">bottommargin</span><span class="p">))</span> <span class="o">/</span> \
        <span class="mf">2.0</span> <span class="o">+</span> <span class="n">bottommargin</span>

    <span class="k">if</span> <span class="n">portrait</span><span class="p">:</span>
        <span class="n">bb1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">xoffset</span> <span class="o">-</span> <span class="n">leftmargin</span><span class="p">))</span>
        <span class="n">bb2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">yoffset</span> <span class="o">-</span> <span class="n">bottommargin</span><span class="p">))</span>
        <span class="n">bb3</span> <span class="o">=</span> <span class="n">bb1</span> <span class="o">+</span> <span class="nb">int</span><span class="p">((</span><span class="n">width</span><span class="o">+</span><span class="n">leftmargin</span><span class="o">+</span><span class="n">rightmargin</span><span class="p">))</span>
        <span class="n">bb4</span> <span class="o">=</span> <span class="n">bb2</span> <span class="o">+</span> <span class="nb">int</span><span class="p">((</span><span class="n">height</span><span class="o">+</span><span class="n">topmargin</span><span class="o">+</span><span class="n">bottommargin</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bb1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">yoffset</span> <span class="o">-</span> <span class="n">topmargin</span><span class="p">))</span>
        <span class="n">bb2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">xoffset</span> <span class="o">-</span> <span class="n">leftmargin</span><span class="p">))</span>
        <span class="n">bb3</span> <span class="o">=</span> <span class="n">bb1</span> <span class="o">+</span> <span class="nb">int</span><span class="p">((</span><span class="n">height</span><span class="o">+</span><span class="n">topmargin</span><span class="o">+</span><span class="n">bottommargin</span><span class="p">))</span>
        <span class="n">bb4</span> <span class="o">=</span> <span class="n">bb2</span> <span class="o">+</span> <span class="nb">int</span><span class="p">((</span><span class="n">width</span><span class="o">+</span><span class="n">leftmargin</span><span class="o">+</span><span class="n">rightmargin</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">xoffset</span><span class="p">,</span> <span class="n">yoffset</span><span class="p">,</span> <span class="p">(</span><span class="n">bb1</span><span class="p">,</span> <span class="n">bb2</span><span class="p">,</span> <span class="n">bb3</span><span class="p">,</span> <span class="n">bb4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">check_gmt_installation</span><span class="p">(</span><span class="n">installation</span><span class="p">):</span>

    <span class="n">home_dir</span> <span class="o">=</span> <span class="n">installation</span><span class="p">[</span><span class="s">&#39;home&#39;</span><span class="p">]</span>
    <span class="n">bin_dir</span> <span class="o">=</span> <span class="n">installation</span><span class="p">[</span><span class="s">&#39;bin&#39;</span><span class="p">]</span>
    <span class="n">version</span> <span class="o">=</span> <span class="n">installation</span><span class="p">[</span><span class="s">&#39;version&#39;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">home_dir</span><span class="p">,</span> <span class="n">bin_dir</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">((</span><span class="s">&#39;Directory does not exist: %s</span><span class="se">\n</span><span class="s">&#39;</span>
                          <span class="s">&#39;Check your GMT installation.&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">d</span><span class="p">)</span>

    <span class="n">gmtdefaults</span> <span class="o">=</span> <span class="n">pjoin</span><span class="p">(</span><span class="n">bin_dir</span><span class="p">,</span> <span class="s">&#39;gmtdefaults&#39;</span><span class="p">)</span>

    <span class="n">versionfound</span> <span class="o">=</span> <span class="n">get_gmt_version</span><span class="p">(</span><span class="n">gmtdefaults</span><span class="p">,</span> <span class="n">home_dir</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">versionfound</span> <span class="o">!=</span> <span class="n">version</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">((</span><span class="s">&#39;Expected GMT version %s but found version %s.</span><span class="se">\n</span><span class="s">&#39;</span>
                         <span class="s">&#39;(Looking at output of %s)&#39;</span><span class="p">)</span> <span class="o">%</span>
                        <span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="n">versionfound</span><span class="p">,</span> <span class="n">gmtdefaults</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">get_gmt_installation</span><span class="p">(</span><span class="n">version</span><span class="p">):</span>
    <span class="n">setup_gmt_installations</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">version</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_gmt_installations</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&#39;GMT version %s not installed, taking version %s instead&#39;</span>
                     <span class="o">%</span> <span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="n">newest_installed_gmt_version</span><span class="p">()))</span>
        <span class="n">version</span> <span class="o">=</span> <span class="s">&#39;newest&#39;</span>

    <span class="n">installation</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">_gmt_installations</span><span class="p">[</span><span class="n">version</span><span class="p">])</span>

    <span class="n">check_gmt_installation</span><span class="p">(</span><span class="n">installation</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">installation</span>


<div class="viewcode-block" id="gmtdefaults_as_text"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.gmtdefaults_as_text">[docs]</a><span class="k">def</span> <span class="nf">gmtdefaults_as_text</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="s">&#39;newest&#39;</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;Get the built-in gmtdefaults.&#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">version</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_gmt_installations</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&#39;GMT version %s not installed, taking version %s instead&#39;</span>
                     <span class="o">%</span> <span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="n">newest_installed_gmt_version</span><span class="p">()))</span>
        <span class="n">version</span> <span class="o">=</span> <span class="s">&#39;newest&#39;</span>

    <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="s">&#39;newest&#39;</span><span class="p">:</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">newest_installed_gmt_version</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">_gmt_defaults_by_version</span><span class="p">[</span><span class="n">version</span><span class="p">]</span></div>


<div class="viewcode-block" id="savegrd"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.savegrd">[docs]</a><span class="k">def</span> <span class="nf">savegrd</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">naming</span><span class="o">=</span><span class="s">&#39;xy&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Write COARDS compliant netcdf (grd) file.&#39;&#39;&#39;</span>

    <span class="kn">from</span> <span class="nn">scipy.io</span> <span class="k">import</span> <span class="n">netcdf</span>

    <span class="k">assert</span> <span class="n">y</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">z</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">nc</span> <span class="o">=</span> <span class="n">netcdf</span><span class="o">.</span><span class="n">netcdf_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">naming</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;xy&#39;</span><span class="p">,</span> <span class="s">&#39;lonlat&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">naming</span> <span class="o">==</span> <span class="s">&#39;xy&#39;</span><span class="p">:</span>
        <span class="n">kx</span><span class="p">,</span> <span class="n">ky</span> <span class="o">=</span> <span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="s">&#39;y&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">kx</span><span class="p">,</span> <span class="n">ky</span> <span class="o">=</span> <span class="s">&#39;lon&#39;</span><span class="p">,</span> <span class="s">&#39;lat&#39;</span>

    <span class="n">nc</span><span class="o">.</span><span class="n">node_offset</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
        <span class="n">nc</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>

    <span class="n">nc</span><span class="o">.</span><span class="n">Conventions</span> <span class="o">=</span> <span class="s">&#39;COARDS/CF-1.0&#39;</span>
    <span class="n">nc</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="n">kx</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>
    <span class="n">nc</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="n">ky</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span>

    <span class="n">xvar</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">kx</span><span class="p">,</span> <span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">kx</span><span class="p">,))</span>
    <span class="n">yvar</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">ky</span><span class="p">,</span> <span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">ky</span><span class="p">,))</span>
    <span class="k">if</span> <span class="n">naming</span> <span class="o">==</span> <span class="s">&#39;xy&#39;</span><span class="p">:</span>
        <span class="n">xvar</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="n">kx</span>
        <span class="n">yvar</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="n">ky</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xvar</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s">&#39;longitude&#39;</span>
        <span class="n">xvar</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s">&#39;degrees_east&#39;</span>
        <span class="n">yvar</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s">&#39;latitude&#39;</span>
        <span class="n">yvar</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s">&#39;degrees_north&#39;</span>

    <span class="n">zvar</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s">&#39;z&#39;</span><span class="p">,</span> <span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">ky</span><span class="p">,</span> <span class="n">kx</span><span class="p">))</span>

    <span class="n">xvar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">num</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">yvar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">num</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">zvar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">num</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="n">nc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<span class="k">def</span> <span class="nf">to_array</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">var</span><span class="p">[:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="s">&#39;scale_factor&#39;</span><span class="p">):</span>
        <span class="n">arr</span> <span class="o">*=</span> <span class="n">var</span><span class="o">.</span><span class="n">scale_factor</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="s">&#39;add_offset&#39;</span><span class="p">):</span>
        <span class="n">arr</span> <span class="o">+=</span> <span class="n">var</span><span class="o">.</span><span class="n">add_offset</span>

    <span class="k">return</span> <span class="n">arr</span>


<div class="viewcode-block" id="loadgrd"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.loadgrd">[docs]</a><span class="k">def</span> <span class="nf">loadgrd</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Read COARDS compliant netcdf (grd) file.&#39;&#39;&#39;</span>

    <span class="kn">from</span> <span class="nn">scipy.io</span> <span class="k">import</span> <span class="n">netcdf</span>

    <span class="n">nc</span> <span class="o">=</span> <span class="n">netcdf</span><span class="o">.</span><span class="n">netcdf_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">vkeys</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="n">kx</span> <span class="o">=</span> <span class="s">&#39;x&#39;</span>
    <span class="n">ky</span> <span class="o">=</span> <span class="s">&#39;y&#39;</span>
    <span class="k">if</span> <span class="s">&#39;lon&#39;</span> <span class="ow">in</span> <span class="n">vkeys</span><span class="p">:</span>
        <span class="n">kx</span> <span class="o">=</span> <span class="s">&#39;lon&#39;</span>
    <span class="k">if</span> <span class="s">&#39;lat&#39;</span> <span class="ow">in</span> <span class="n">vkeys</span><span class="p">:</span>
        <span class="n">ky</span> <span class="o">=</span> <span class="s">&#39;lat&#39;</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">to_array</span><span class="p">(</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">kx</span><span class="p">])</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">to_array</span><span class="p">(</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">ky</span><span class="p">])</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">to_array</span><span class="p">(</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">])</span>

    <span class="n">nc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span></div>


<span class="k">def</span> <span class="nf">centers_to_edges</span><span class="p">(</span><span class="n">asorted</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">asorted</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">asorted</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>


<span class="k">def</span> <span class="nf">nvals</span><span class="p">(</span><span class="n">asorted</span><span class="p">):</span>
    <span class="n">eps</span> <span class="o">=</span> <span class="p">(</span><span class="n">asorted</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">asorted</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">asorted</span><span class="o">.</span><span class="n">size</span>
    <span class="k">return</span> <span class="n">num</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">asorted</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">asorted</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">eps</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>


<span class="k">def</span> <span class="nf">guess_vals</span><span class="p">(</span><span class="n">asorted</span><span class="p">):</span>
    <span class="n">eps</span> <span class="o">=</span> <span class="p">(</span><span class="n">asorted</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">asorted</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">asorted</span><span class="o">.</span><span class="n">size</span>
    <span class="n">indis</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">asorted</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">asorted</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">eps</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">indis</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">num</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span> <span class="n">indis</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                             <span class="n">num</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">asorted</span><span class="o">.</span><span class="n">size</span><span class="p">])))</span>
    <span class="n">asum</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">asorted</span><span class="o">.</span><span class="n">size</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">asum</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">asorted</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">asum</span><span class="p">[</span><span class="n">indis</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span> <span class="o">-</span> <span class="n">asum</span><span class="p">[</span><span class="n">indis</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span> <span class="o">/</span> <span class="p">(</span><span class="n">indis</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="n">indis</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">blockmean</span><span class="p">(</span><span class="n">asorted</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="n">indis</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">asorted</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">asorted</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">indis</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">num</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span> <span class="n">indis</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                             <span class="n">num</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">asorted</span><span class="o">.</span><span class="n">size</span><span class="p">])))</span>
    <span class="n">bsum</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">size</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">bsum</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">asorted</span><span class="p">[</span><span class="n">indis</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span>
        <span class="p">(</span><span class="n">bsum</span><span class="p">[</span><span class="n">indis</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span> <span class="o">-</span> <span class="n">bsum</span><span class="p">[</span><span class="n">indis</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span> <span class="o">/</span> <span class="p">(</span><span class="n">indis</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="n">indis</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>


<span class="k">def</span> <span class="nf">griddata_regular</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">xvals</span><span class="p">,</span> <span class="n">yvals</span><span class="p">):</span>
    <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="n">xvals</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">yvals</span><span class="o">.</span><span class="n">size</span>
    <span class="n">xindi</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">centers_to_edges</span><span class="p">(</span><span class="n">xvals</span><span class="p">))</span>
    <span class="n">yindi</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">centers_to_edges</span><span class="p">(</span><span class="n">yvals</span><span class="p">))</span>

    <span class="n">zindi</span> <span class="o">=</span> <span class="n">yindi</span><span class="o">*</span><span class="n">nx</span><span class="o">+</span><span class="n">xindi</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">zindi</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">order</span><span class="p">]</span>
    <span class="n">zindi</span> <span class="o">=</span> <span class="n">zindi</span><span class="p">[</span><span class="n">order</span><span class="p">]</span>

    <span class="n">zindi</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">blockmean</span><span class="p">(</span><span class="n">zindi</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
    <span class="n">znew</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">nx</span><span class="o">*</span><span class="n">ny</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">num</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
    <span class="n">znew</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">znew</span><span class="p">[</span><span class="n">zindi</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span>
    <span class="k">return</span> <span class="n">znew</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">guess_field_size</span><span class="p">(</span><span class="n">x_sorted</span><span class="p">,</span> <span class="n">y_sorted</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
    <span class="n">critical_fraction</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">num</span><span class="o">.</span><span class="n">e</span> <span class="o">-</span> <span class="mf">0.014</span><span class="o">*</span><span class="mi">3</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">x_sorted</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="n">y_sorted</span>
    <span class="n">nxs</span><span class="p">,</span> <span class="n">nys</span> <span class="o">=</span> <span class="n">nvals</span><span class="p">(</span><span class="n">xs</span><span class="p">),</span> <span class="n">nvals</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;nonrandom&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">nxs</span><span class="p">,</span> <span class="n">nys</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">xs</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">nxs</span><span class="o">*</span><span class="n">nys</span><span class="p">:</span>
        <span class="c"># exact match</span>
        <span class="k">return</span> <span class="n">nxs</span><span class="p">,</span> <span class="n">nys</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">nxs</span> <span class="o">&gt;=</span> <span class="n">xs</span><span class="o">.</span><span class="n">size</span><span class="o">*</span><span class="n">critical_fraction</span> <span class="ow">and</span> <span class="n">nys</span> <span class="o">&gt;=</span> <span class="n">xs</span><span class="o">.</span><span class="n">size</span><span class="o">*</span><span class="n">critical_fraction</span><span class="p">:</span>
        <span class="c"># possibly randomly sampled</span>
        <span class="n">nxs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
        <span class="n">nys</span> <span class="o">=</span> <span class="n">nxs</span>
        <span class="k">return</span> <span class="n">nxs</span><span class="p">,</span> <span class="n">nys</span><span class="p">,</span> <span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">nxs</span><span class="p">,</span> <span class="n">nys</span><span class="p">,</span> <span class="mi">1</span>


<div class="viewcode-block" id="griddata_auto"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.griddata_auto">[docs]</a><span class="k">def</span> <span class="nf">griddata_auto</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Grid tabular XYZ data by binning.</span>

<span class="sd">    This function does some extra work to guess the size of the grid. This</span>
<span class="sd">    should work fine if the input values are already defined on an rectilinear</span>
<span class="sd">    grid, even if data points are missing or duplicated. This routine also</span>
<span class="sd">    tries to detect a random distribution of input data and in that case</span>
<span class="sd">    creates a grid of size sqrt(N) x sqrt(N).</span>

<span class="sd">    The points do not have to be given in any particular order. Grid nodes</span>
<span class="sd">    without data are assigned the NaN value. If multiple data points map to the</span>
<span class="sd">    same grid node, their average is assigned to the grid node. &#39;&#39;&#39;</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="p">[</span><span class="n">num</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="k">for</span> <span class="n">X</span> <span class="ow">in</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)]</span>
    <span class="k">assert</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">y</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">z</span><span class="o">.</span><span class="n">size</span>
    <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">num</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">badness</span> <span class="o">=</span> <span class="n">guess_field_size</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">badness</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">xf</span> <span class="o">=</span> <span class="n">guess_vals</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
        <span class="n">yf</span> <span class="o">=</span> <span class="n">guess_vals</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span>
        <span class="n">zf</span> <span class="o">=</span> <span class="n">griddata_regular</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">xf</span><span class="p">,</span> <span class="n">yf</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xf</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">nx</span><span class="p">)</span>
        <span class="n">yf</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ys</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ny</span><span class="p">)</span>
        <span class="n">zf</span> <span class="o">=</span> <span class="n">griddata_regular</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">xf</span><span class="p">,</span> <span class="n">yf</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">xf</span><span class="p">,</span> <span class="n">yf</span><span class="p">,</span> <span class="n">zf</span></div>


<span class="k">def</span> <span class="nf">tabledata</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">yf</span><span class="p">,</span> <span class="n">zf</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">yf</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">xf</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">zf</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">yf</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">yf</span><span class="p">,</span> <span class="n">xf</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">zf</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>


<span class="k">def</span> <span class="nf">double1d</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">a2</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
    <span class="n">a2</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="mf">2.</span>
    <span class="k">return</span> <span class="n">a2</span>


<span class="k">def</span> <span class="nf">double2d</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="n">f2</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">f</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">f2</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">f2</span><span class="p">[::</span><span class="mi">2</span><span class="p">,</span> <span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span>
    <span class="n">f2</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:])</span><span class="o">/</span><span class="mf">2.</span>
    <span class="n">f2</span><span class="p">[::</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">f</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="mf">2.</span>
    <span class="n">f2</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">f</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">diag</span> <span class="o">=</span> <span class="n">f2</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">diagA</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mf">2.</span>
    <span class="n">diagB</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">f</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mf">2.</span>
    <span class="n">f2</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">num</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">diag</span><span class="p">),</span> <span class="n">diagA</span><span class="p">,</span> <span class="n">diag</span><span class="p">)</span>
    <span class="n">f2</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">num</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">diag</span><span class="p">),</span> <span class="n">diagB</span><span class="p">,</span> <span class="n">diag</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">f2</span>


<span class="k">def</span> <span class="nf">doublegrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">double1d</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="n">double1d</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">z2</span> <span class="o">=</span> <span class="n">double2d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z2</span>


<div class="viewcode-block" id="Guru"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.Guru">[docs]</a><span class="k">class</span> <span class="nc">Guru</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Abstract base class providing template interpolation, accessible as</span>
<span class="sd">    attributes.</span>

<span class="sd">    Classes deriving from this one, have to implement a :py:meth:`get_params`</span>
<span class="sd">    method, which is called to get a dict to do ordinary</span>
<span class="sd">    ``&quot;%(key)x&quot;``-substitutions. The deriving class must also provide a dict</span>
<span class="sd">    with the templates.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">fill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">templates</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">strings</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="o">%</span> <span class="n">params</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">templates</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">strings</span>

    <span class="c"># hand through templates dict</span>
    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="p">[</span><span class="n">template_name</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_name</span><span class="p">,</span> <span class="n">template</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="p">[</span><span class="n">template_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">template</span>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_name</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">template_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">templates</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_name</span><span class="p">):</span>
        <span class="k">del</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="p">[</span><span class="n">template_name</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_simple_fill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_names</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">templates</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">template_names</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">templates</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_names</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">template_names</span> <span class="k">if</span> <span class="n">n</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">template_names</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simple_fill</span><span class="p">(</span><span class="n">template_names</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">f</span></div>


<div class="viewcode-block" id="nice_value"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.nice_value">[docs]</a><span class="k">def</span> <span class="nf">nice_value</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Round ``x`` to nice value.&#39;&#39;&#39;</span>

    <span class="n">exp</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">x</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">while</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">/=</span> <span class="mf">10.0</span>
        <span class="n">exp</span> <span class="o">*=</span> <span class="mf">10.0</span>
    <span class="k">while</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">*=</span> <span class="mf">10.0</span>
        <span class="n">exp</span> <span class="o">/=</span> <span class="mf">10.0</span>

    <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mf">0.75</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sign</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">exp</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mf">0.375</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sign</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">exp</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mf">0.225</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sign</span> <span class="o">*</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">exp</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mf">0.15</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sign</span> <span class="o">*</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">exp</span>

    <span class="k">return</span> <span class="n">sign</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">exp</span></div>


<div class="viewcode-block" id="AutoScaler"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.AutoScaler">[docs]</a><span class="k">class</span> <span class="nc">AutoScaler</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Tunable 1D autoscaling based on data range.</span>

<span class="sd">    Instances of this class may be used to determine nice minima, maxima and</span>
<span class="sd">    increments for ax annotations, as well as suitable common exponents for</span>
<span class="sd">    notation.</span>

<span class="sd">    The autoscaling process is guided by the following public attributes:</span>

<span class="sd">        .. py:attribute:: approx_ticks</span>

<span class="sd">            Approximate number of increment steps (tickmarks) to generate.</span>

<span class="sd">        .. py:attribute:: mode</span>

<span class="sd">            Mode of operation: one of ``&#39;auto&#39;``, ``&#39;min-max&#39;``, ``&#39;0-max&#39;``,</span>
<span class="sd">            ``&#39;min-0&#39;``, ``&#39;symmetric&#39;`` or ``&#39;off&#39;``.</span>

<span class="sd">            ================ ==================================================</span>
<span class="sd">            mode             description</span>
<span class="sd">            ================ ==================================================</span>
<span class="sd">            ``&#39;auto&#39;``:      Look at data range and choose one of the choices</span>
<span class="sd">                             below.</span>
<span class="sd">            ``&#39;min-max&#39;``:   Output range is selected to include data range.</span>
<span class="sd">            ``&#39;0-max&#39;``:     Output range shall start at zero and end at data</span>
<span class="sd">                             max.</span>
<span class="sd">            ``&#39;min-0&#39;``:     Output range shall start at data min and end at</span>
<span class="sd">                             zero.</span>
<span class="sd">            ``&#39;symmetric&#39;``: Output range shall by symmetric by zero.</span>
<span class="sd">            ``&#39;off&#39;``:       Similar to ``&#39;min-max&#39;``, but snap and space are</span>
<span class="sd">                             disabled, such that the output range always</span>
<span class="sd">                             exactly matches the data range.</span>
<span class="sd">            ================ ==================================================</span>

<span class="sd">        .. py:attribute:: exp</span>

<span class="sd">            If defined, override automatically determined exponent for notation</span>
<span class="sd">            by the given value.</span>

<span class="sd">        .. py:attribute:: snap</span>

<span class="sd">            If set to True, snap output range to multiples of increment. This</span>
<span class="sd">            parameter has no effect, if mode is set to ``&#39;off&#39;``.</span>

<span class="sd">        .. py:attribute:: inc</span>

<span class="sd">            If defined, override automatically determined tick increment by the</span>
<span class="sd">            given value.</span>

<span class="sd">        .. py:attribute:: space</span>

<span class="sd">            Add some padding to the range. The value given, is the fraction by</span>
<span class="sd">            which the output range is increased on each side. If mode is</span>
<span class="sd">            ``&#39;0-max&#39;`` or ``&#39;min-0&#39;``, the end at zero is kept fixed at zero.</span>
<span class="sd">            This parameter has no effect if mode is set to ``&#39;off&#39;``.</span>

<span class="sd">        .. py:attribute:: exp_factor</span>

<span class="sd">            Exponent of notation is chosen to be a multiple of this value.</span>

<span class="sd">        .. py:attribute:: no_exp_interval:</span>

<span class="sd">            Range of exponent, for which no exponential notation is allowed.</span>

<span class="sd">   &#39;&#39;&#39;</span>

<div class="viewcode-block" id="AutoScaler.__init__"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.AutoScaler.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">approx_ticks</span><span class="o">=</span><span class="mf">7.0</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s">&#39;auto&#39;</span><span class="p">,</span>
            <span class="n">exp</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
            <span class="n">snap</span><span class="o">=</span><span class="k">False</span><span class="p">,</span>
            <span class="n">inc</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
            <span class="n">space</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
            <span class="n">exp_factor</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">no_exp_interval</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)):</span>

        <span class="sd">&#39;&#39;&#39;Create new AutoScaler instance.</span>

<span class="sd">        The parameters are described in the AutoScaler documentation.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">approx_ticks</span> <span class="o">=</span> <span class="n">approx_ticks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exp</span> <span class="o">=</span> <span class="n">exp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snap</span> <span class="o">=</span> <span class="n">snap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inc</span> <span class="o">=</span> <span class="n">inc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">space</span> <span class="o">=</span> <span class="n">space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exp_factor</span> <span class="o">=</span> <span class="n">exp_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">no_exp_interval</span> <span class="o">=</span> <span class="n">no_exp_interval</span></div>

<div class="viewcode-block" id="AutoScaler.make_scale"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.AutoScaler.make_scale">[docs]</a>    <span class="k">def</span> <span class="nf">make_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_range</span><span class="p">,</span> <span class="n">override_mode</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Get nice minimum, maximum and increment for given data range.</span>

<span class="sd">        Returns ``(minimum, maximum, increment)`` or ``(maximum, minimum,</span>
<span class="sd">        -increment)``, depending on whether data_range is ``(data_min,</span>
<span class="sd">        data_max)`` or ``(data_max, data_min)``. If ``override_mode`` is</span>
<span class="sd">        defined, the mode attribute is temporarily overridden by the given</span>
<span class="sd">        value. &#39;&#39;&#39;</span>

        <span class="n">data_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">data_range</span><span class="p">)</span>
        <span class="n">data_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">data_range</span><span class="p">)</span>

        <span class="n">is_reverse</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">data_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;auto&#39;</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">guess_autoscale_mode</span><span class="p">(</span><span class="n">data_min</span><span class="p">,</span> <span class="n">data_max</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">override_mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">override_mode</span>

        <span class="n">mi</span><span class="p">,</span> <span class="n">ma</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s">&#39;off&#39;</span><span class="p">:</span>
            <span class="n">mi</span><span class="p">,</span> <span class="n">ma</span> <span class="o">=</span> <span class="n">data_min</span><span class="p">,</span> <span class="n">data_max</span>
        <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="s">&#39;0-max&#39;</span><span class="p">:</span>
            <span class="n">mi</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="n">data_max</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">ma</span> <span class="o">=</span> <span class="n">data_max</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ma</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="s">&#39;min-0&#39;</span><span class="p">:</span>
            <span class="n">ma</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="n">data_min</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">mi</span> <span class="o">=</span> <span class="n">data_min</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mi</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
        <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="s">&#39;min-max&#39;</span><span class="p">:</span>
            <span class="n">mi</span><span class="p">,</span> <span class="n">ma</span> <span class="o">=</span> <span class="n">data_min</span><span class="p">,</span> <span class="n">data_max</span>
        <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="s">&#39;symmetric&#39;</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">data_min</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">data_max</span><span class="p">))</span>
            <span class="n">mi</span> <span class="o">=</span> <span class="o">-</span><span class="n">m</span>
            <span class="n">ma</span> <span class="o">=</span> <span class="n">m</span>

        <span class="n">nmi</span> <span class="o">=</span> <span class="n">mi</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mi</span> <span class="o">!=</span> <span class="mf">0.</span> <span class="ow">or</span> <span class="n">a</span> <span class="o">==</span> <span class="s">&#39;min-max&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">!=</span> <span class="s">&#39;off&#39;</span><span class="p">:</span>
            <span class="n">nmi</span> <span class="o">=</span> <span class="n">mi</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">space</span><span class="o">*</span><span class="p">(</span><span class="n">ma</span><span class="o">-</span><span class="n">mi</span><span class="p">)</span>

        <span class="n">nma</span> <span class="o">=</span> <span class="n">ma</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ma</span> <span class="o">!=</span> <span class="mf">0.</span> <span class="ow">or</span> <span class="n">a</span> <span class="o">==</span> <span class="s">&#39;min-max&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">!=</span> <span class="s">&#39;off&#39;</span><span class="p">:</span>
            <span class="n">nma</span> <span class="o">=</span> <span class="n">ma</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">space</span><span class="o">*</span><span class="p">(</span><span class="n">ma</span><span class="o">-</span><span class="n">mi</span><span class="p">)</span>

        <span class="n">mi</span><span class="p">,</span> <span class="n">ma</span> <span class="o">=</span> <span class="n">nmi</span><span class="p">,</span> <span class="n">nma</span>

        <span class="k">if</span> <span class="n">mi</span> <span class="o">==</span> <span class="n">ma</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">!=</span> <span class="s">&#39;off&#39;</span><span class="p">:</span>
            <span class="n">mi</span> <span class="o">-=</span> <span class="mf">1.0</span>
            <span class="n">ma</span> <span class="o">+=</span> <span class="mf">1.0</span>

        <span class="c"># make nice tick increment</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
            <span class="n">inc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inc</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">approx_ticks</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
                <span class="n">inc</span> <span class="o">=</span> <span class="n">nice_value</span><span class="p">((</span><span class="n">ma</span><span class="o">-</span><span class="n">mi</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">approx_ticks</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">inc</span> <span class="o">=</span> <span class="n">nice_value</span><span class="p">((</span><span class="n">ma</span><span class="o">-</span><span class="n">mi</span><span class="p">)</span><span class="o">*</span><span class="mf">10.</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">inc</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">inc</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="c"># snap min and max to ticks if this is wanted</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">!=</span> <span class="s">&#39;off&#39;</span><span class="p">:</span>
            <span class="n">ma</span> <span class="o">=</span> <span class="n">inc</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">ma</span><span class="o">/</span><span class="n">inc</span><span class="p">)</span>
            <span class="n">mi</span> <span class="o">=</span> <span class="n">inc</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">mi</span><span class="o">/</span><span class="n">inc</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">is_reverse</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ma</span><span class="p">,</span> <span class="n">mi</span><span class="p">,</span> <span class="o">-</span><span class="n">inc</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">mi</span><span class="p">,</span> <span class="n">ma</span><span class="p">,</span> <span class="n">inc</span></div>

<div class="viewcode-block" id="AutoScaler.make_exp"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.AutoScaler.make_exp">[docs]</a>    <span class="k">def</span> <span class="nf">make_exp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get nice exponent for notation of ``x``.</span>

<span class="sd">        For ax annotations, give tick increment as ``x``.&#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">exp</span>

        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="mi">10</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">no_exp_interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">no_exp_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_factor</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_factor</span></div>

<div class="viewcode-block" id="AutoScaler.guess_autoscale_mode"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.AutoScaler.guess_autoscale_mode">[docs]</a>    <span class="k">def</span> <span class="nf">guess_autoscale_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_min</span><span class="p">,</span> <span class="n">data_max</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Guess mode of operation, based on data range.</span>

<span class="sd">        Used to map ``&#39;auto&#39;`` mode to ``&#39;0-max&#39;``, ``&#39;min-0&#39;``, ``&#39;min-max&#39;``</span>
<span class="sd">        or ``&#39;symmetric&#39;``.&#39;&#39;&#39;</span>

        <span class="n">a</span> <span class="o">=</span> <span class="s">&#39;min-max&#39;</span>
        <span class="k">if</span> <span class="n">data_min</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data_min</span> <span class="o">&lt;</span> <span class="n">data_max</span><span class="o">/</span><span class="mf">2.</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="s">&#39;0-max&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="s">&#39;min-max&#39;</span>
        <span class="k">if</span> <span class="n">data_max</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data_max</span> <span class="o">&gt;</span> <span class="n">data_min</span><span class="o">/</span><span class="mf">2.</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="s">&#39;min-0&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="s">&#39;min-max&#39;</span>
        <span class="k">if</span> <span class="n">data_min</span> <span class="o">&lt;</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">data_max</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">data_max</span><span class="p">)</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">data_min</span><span class="p">))</span> <span class="o">/</span>
                   <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">data_max</span><span class="p">)</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="n">data_min</span><span class="p">)))</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="s">&#39;symmetric&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="s">&#39;min-max&#39;</span>
        <span class="k">return</span> <span class="n">a</span></div></div>


<div class="viewcode-block" id="Ax"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.Ax">[docs]</a><span class="k">class</span> <span class="nc">Ax</span><span class="p">(</span><span class="n">AutoScaler</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Ax description with autoscaling capabilities.</span>

<span class="sd">    The ax is described by the :py:class:`AutoScaler` public attributes, plus</span>
<span class="sd">    the following additional attributes (with default values given in</span>
<span class="sd">    paranthesis):</span>

<span class="sd">      .. py:attribute:: label</span>

<span class="sd">          Ax label (without unit).</span>

<span class="sd">      .. py:attribute:: unit</span>

<span class="sd">          Physical unit of the data attached to this ax.</span>

<span class="sd">      .. py:attribute:: scaled_unit</span>

<span class="sd">           (see below)</span>

<span class="sd">      .. py:attribute:: scaled_unit_factor</span>

<span class="sd">          Scaled physical unit and factor between unit and scaled_unit so that</span>

<span class="sd">            unit = scaled_unit_factor x scaled_unit.</span>

<span class="sd">          (E.g. if unit is &#39;m&#39; and data is in the range of nanometers, you may</span>
<span class="sd">          want to set the scaled_unit to &#39;nm&#39; and the scaled_unit_factor to</span>
<span class="sd">          1e9.)</span>

<span class="sd">      .. py:attribute:: limits</span>

<span class="sd">          If defined, fix range of ax to limits=(min,max).</span>

<span class="sd">      .. py:attribute:: masking</span>

<span class="sd">          If true and if there is a limit on the ax, while calculating ranges,</span>
<span class="sd">          the data points are masked such that data points outside of this axes</span>
<span class="sd">          limits are not used to determine the range of another dependant ax.</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">scaled_unit_factor</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span>
                 <span class="n">scaled_unit</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">masking</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">AutoScaler</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">unit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scaled_unit_factor</span> <span class="o">=</span> <span class="n">scaled_unit_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scaled_unit</span> <span class="o">=</span> <span class="n">scaled_unit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">limits</span> <span class="o">=</span> <span class="n">limits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">masking</span> <span class="o">=</span> <span class="n">masking</span>

<div class="viewcode-block" id="Ax.label_str"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.Ax.label_str">[docs]</a>    <span class="k">def</span> <span class="nf">label_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">unit</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get label string including the unit and multiplier.&#39;&#39;&#39;</span>

        <span class="n">slabel</span><span class="p">,</span> <span class="n">sunit</span><span class="p">,</span> <span class="n">sexp</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">:</span>
            <span class="n">slabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span>

        <span class="k">if</span> <span class="n">unit</span> <span class="ow">or</span> <span class="n">exp</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">exp</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sexp</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">327 10@+%i@+&#39;</span> <span class="o">%</span> <span class="n">exp</span>
                <span class="n">sunit</span> <span class="o">=</span> <span class="s">&#39;[ %s %s ]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sexp</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sunit</span> <span class="o">=</span> <span class="s">&#39;[ %s ]&#39;</span> <span class="o">%</span> <span class="n">unit</span>

        <span class="n">p</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">slabel</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sunit</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sunit</span><span class="p">)</span>

        <span class="k">return</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></div>

<div class="viewcode-block" id="Ax.make_params"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.Ax.make_params">[docs]</a>    <span class="k">def</span> <span class="nf">make_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_range</span><span class="p">,</span> <span class="n">ax_projection</span><span class="o">=</span><span class="k">False</span><span class="p">,</span> <span class="n">override_mode</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
                    <span class="n">override_scaled_unit_factor</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Get minimum, maximum, increment and label string for ax display.&#39;</span>

<span class="sd">        Returns minimum, maximum, increment and label string including unit and</span>
<span class="sd">        multiplier for given data range.</span>

<span class="sd">        If ``ax_projection`` is True, values suitable to be displayed on the ax</span>
<span class="sd">        are returned, e.g. min, max and inc are returned in scaled units.</span>
<span class="sd">        Otherwise the values are returned in the original units, without any</span>
<span class="sd">        scaling applied. &#39;&#39;&#39;</span>

        <span class="n">sf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaled_unit_factor</span>

        <span class="k">if</span> <span class="n">override_scaled_unit_factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
            <span class="n">sf</span> <span class="o">=</span> <span class="n">override_scaled_unit_factor</span>

        <span class="n">dr_scaled</span> <span class="o">=</span> <span class="p">[</span><span class="n">sf</span><span class="o">*</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data_range</span><span class="p">]</span>

        <span class="n">mi</span><span class="p">,</span> <span class="n">ma</span><span class="p">,</span> <span class="n">inc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_scale</span><span class="p">(</span><span class="n">dr_scaled</span><span class="p">,</span> <span class="n">override_mode</span><span class="o">=</span><span class="n">override_mode</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
            <span class="n">inc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inc</span><span class="o">*</span><span class="n">sf</span>

        <span class="k">if</span> <span class="n">ax_projection</span><span class="p">:</span>
            <span class="n">exp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_exp</span><span class="p">(</span><span class="n">inc</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sf</span> <span class="o">==</span> <span class="mf">1.</span> <span class="ow">and</span> <span class="n">override_scaled_unit_factor</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
                <span class="n">unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaled_unit</span>
            <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_str</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">mi</span><span class="o">/</span><span class="mi">10</span><span class="o">**</span><span class="n">exp</span><span class="p">,</span> <span class="n">ma</span><span class="o">/</span><span class="mi">10</span><span class="o">**</span><span class="n">exp</span><span class="p">,</span> <span class="n">inc</span><span class="o">/</span><span class="mi">10</span><span class="o">**</span><span class="n">exp</span><span class="p">,</span> <span class="n">label</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_str</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">mi</span><span class="o">/</span><span class="n">sf</span><span class="p">,</span> <span class="n">ma</span><span class="o">/</span><span class="n">sf</span><span class="p">,</span> <span class="n">inc</span><span class="o">/</span><span class="n">sf</span><span class="p">,</span> <span class="n">label</span></div></div>


<div class="viewcode-block" id="ScaleGuru"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.ScaleGuru">[docs]</a><span class="k">class</span> <span class="nc">ScaleGuru</span><span class="p">(</span><span class="n">Guru</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;2D/3D autoscaling and ax annotation facility.</span>

<span class="sd">    Instances of this class provide automatic determination of plot ranges,</span>
<span class="sd">    tick increments and scaled annotations, as well as label/unit handling. It</span>
<span class="sd">    can in particular be used to automatically generate the -R and -B option</span>
<span class="sd">    arguments, which are required for most GMT commands.</span>

<span class="sd">    It extends the functionality of the :py:class:`Ax` and</span>
<span class="sd">    :py:class:`AutoScaler` classes at the level, where it can not be handled</span>
<span class="sd">    anymore by looking at a single dimension of the dataset&#39;s data, e.g.:</span>

<span class="sd">    * The ability to impose a fixed aspect ratio between two axes.</span>

<span class="sd">    * Recalculation of data range on non-limited axes, when there are</span>
<span class="sd">      limits imposed on other axes.</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_tuples</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
                 <span class="n">percent_interval</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">percent_interval</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="k">import</span> <span class="n">scoreatpercentile</span> <span class="k">as</span> <span class="n">scap</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">templates</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">R</span><span class="o">=</span><span class="s">&#39;-R%(xmin)g/%(xmax)g/%(ymin)g/%(ymax)g&#39;</span><span class="p">,</span>
            <span class="n">B</span><span class="o">=</span><span class="s">&#39;-B%(xinc)g:%(xlabel)s:/%(yinc)g:%(ylabel)s:WSen&#39;</span><span class="p">,</span>
            <span class="n">T</span><span class="o">=</span><span class="s">&#39;-T%(zmin)g/%(zmax)g/%(zinc)g&#39;</span><span class="p">)</span>

        <span class="n">maxdim</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">data_tuples</span><span class="p">:</span>
            <span class="n">maxdim</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxdim</span><span class="p">,</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span> <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">data_tuples</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
                <span class="n">maxdim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
            <span class="n">data_tuples</span> <span class="o">=</span> <span class="p">[([],)</span> <span class="o">*</span> <span class="n">maxdim</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">Ax</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maxdim</span><span class="p">)]</span>

        <span class="c"># sophisticated data-range calculation</span>
        <span class="n">data_ranges</span> <span class="o">=</span> <span class="p">[</span><span class="k">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">maxdim</span>
        <span class="k">for</span> <span class="n">dt_</span> <span class="ow">in</span> <span class="n">data_tuples</span><span class="p">:</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">dt_</span><span class="p">)</span>
            <span class="n">in_range</span> <span class="o">=</span> <span class="k">True</span>
            <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">ax</span><span class="o">.</span><span class="n">limits</span> <span class="ow">and</span> <span class="n">ax</span><span class="o">.</span><span class="n">masking</span><span class="p">:</span>
                    <span class="n">ax_limits</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">limits</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">ax_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
                        <span class="n">ax_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">num</span><span class="o">.</span><span class="n">inf</span>
                    <span class="k">if</span> <span class="n">ax_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
                        <span class="n">ax_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">inf</span>
                    <span class="n">in_range</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span>
                        <span class="n">in_range</span><span class="p">,</span>
                        <span class="n">num</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">ax_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">ax_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">maxdim</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">ax</span><span class="o">.</span><span class="n">limits</span> <span class="ow">or</span> <span class="k">None</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">limits</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">in_range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">True</span><span class="p">:</span>
                            <span class="n">xmasked</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">in_range</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">num</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">percent_interval</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
                                <span class="n">range_this</span> <span class="o">=</span> <span class="p">(</span>
                                    <span class="n">num</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">xmasked</span><span class="p">),</span>
                                    <span class="n">num</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">xmasked</span><span class="p">))</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">xmasked_finite</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span>
                                    <span class="n">num</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">xmasked</span><span class="p">),</span> <span class="n">xmasked</span><span class="p">)</span>
                                <span class="n">range_this</span> <span class="o">=</span> <span class="p">(</span>
                                    <span class="n">scap</span><span class="p">(</span><span class="n">xmasked_finite</span><span class="p">,</span>
                                         <span class="p">(</span><span class="mf">100.</span><span class="o">-</span><span class="n">percent_interval</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="p">),</span>
                                    <span class="n">scap</span><span class="p">(</span><span class="n">xmasked_finite</span><span class="p">,</span>
                                         <span class="mf">100.</span><span class="o">-</span><span class="p">(</span><span class="mf">100.</span><span class="o">-</span><span class="n">percent_interval</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="p">))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">percent_interval</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
                                <span class="n">range_this</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">num</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">xmasked_finite</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span>
                                    <span class="n">num</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">xmasked</span><span class="p">),</span> <span class="n">xmasked</span><span class="p">)</span>
                                <span class="n">range_this</span> <span class="o">=</span> <span class="p">(</span>
                                    <span class="n">scap</span><span class="p">(</span><span class="n">xmasked_finite</span><span class="p">,</span>
                                         <span class="p">(</span><span class="mf">100.</span><span class="o">-</span><span class="n">percent_interval</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="p">),</span>
                                    <span class="n">scap</span><span class="p">(</span><span class="n">xmasked_finite</span><span class="p">,</span>
                                         <span class="mf">100.</span><span class="o">-</span><span class="p">(</span><span class="mf">100.</span><span class="o">-</span><span class="n">percent_interval</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">range_this</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">ax</span><span class="o">.</span><span class="n">limits</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">ax</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
                            <span class="n">range_this</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">max</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                           <span class="n">range_this</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

                        <span class="k">if</span> <span class="n">ax</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
                            <span class="n">range_this</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                             <span class="n">range_this</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">ax</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">range_this</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">limits</span>

                <span class="k">if</span> <span class="n">data_ranges</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="k">None</span> <span class="ow">and</span> <span class="n">range_this</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">range_this</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">data_ranges</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">range_this</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mi</span><span class="p">,</span> <span class="n">ma</span> <span class="o">=</span> <span class="n">range_this</span>
                    <span class="k">if</span> <span class="n">data_ranges</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
                        <span class="n">mi</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">data_ranges</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">mi</span><span class="p">)</span>
                        <span class="n">ma</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">data_ranges</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">ma</span><span class="p">)</span>

                    <span class="n">data_ranges</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">mi</span><span class="p">,</span> <span class="n">ma</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_ranges</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">data_ranges</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="k">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span>
                    <span class="n">num</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">data_ranges</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="ow">and</span> <span class="n">num</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">data_ranges</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])):</span>

                <span class="n">data_ranges</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_ranges</span> <span class="o">=</span> <span class="n">data_ranges</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aspect</span> <span class="o">=</span> <span class="n">aspect</span>

<div class="viewcode-block" id="ScaleGuru.get_params"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.ScaleGuru.get_params">[docs]</a>    <span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax_projection</span><span class="o">=</span><span class="k">False</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Get dict with output parameters.</span>

<span class="sd">        For each data dimension, ax minimum, maximum, increment and a label</span>
<span class="sd">        string (including unit and exponential factor) are determined. E.g. in</span>
<span class="sd">        for the first dimension the output dict will contain the keys</span>
<span class="sd">        ``&#39;xmin&#39;``, ``&#39;xmax&#39;``, ``&#39;xinc&#39;``, and ``&#39;xlabel&#39;``.</span>

<span class="sd">        Normally, values corresponding to the scaling of the raw data are</span>
<span class="sd">        produced, but if ``ax_projection`` is ``True``, values which are</span>
<span class="sd">        suitable to be printed on the axes are returned. This means that in the</span>
<span class="sd">        latter case, the :py:attr:`Ax.scaled_unit` and</span>
<span class="sd">        :py:attr:`Ax.scaled_unit_factor` attributes as set on the axes are</span>
<span class="sd">        respected and that a common 10^x factor is factored out and put to the</span>
<span class="sd">        label string. &#39;&#39;&#39;</span>

        <span class="n">xmi</span><span class="p">,</span> <span class="n">xma</span><span class="p">,</span> <span class="n">xinc</span><span class="p">,</span> <span class="n">xlabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">make_params</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ax_projection</span><span class="p">)</span>
        <span class="n">ymi</span><span class="p">,</span> <span class="n">yma</span><span class="p">,</span> <span class="n">yinc</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">make_params</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ax_projection</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">zmi</span><span class="p">,</span> <span class="n">zma</span><span class="p">,</span> <span class="n">zinc</span><span class="p">,</span> <span class="n">zlabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">make_params</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_ranges</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ax_projection</span><span class="p">)</span>

        <span class="c"># enforce certain aspect, if needed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aspect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
            <span class="n">xwid</span> <span class="o">=</span> <span class="n">xma</span><span class="o">-</span><span class="n">xmi</span>
            <span class="n">ywid</span> <span class="o">=</span> <span class="n">yma</span><span class="o">-</span><span class="n">ymi</span>
            <span class="k">if</span> <span class="n">ywid</span> <span class="o">&lt;</span> <span class="n">xwid</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">aspect</span><span class="p">:</span>
                <span class="n">ymi</span> <span class="o">-=</span> <span class="p">(</span><span class="n">xwid</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">aspect</span> <span class="o">-</span> <span class="n">ywid</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>
                <span class="n">yma</span> <span class="o">+=</span> <span class="p">(</span><span class="n">xwid</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">aspect</span> <span class="o">-</span> <span class="n">ywid</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>
                <span class="n">ymi</span><span class="p">,</span> <span class="n">yma</span><span class="p">,</span> <span class="n">yinc</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">make_params</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">ymi</span><span class="p">,</span> <span class="n">yma</span><span class="p">),</span> <span class="n">ax_projection</span><span class="p">,</span> <span class="n">override_mode</span><span class="o">=</span><span class="s">&#39;off&#39;</span><span class="p">,</span>
                    <span class="n">override_scaled_unit_factor</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">xwid</span> <span class="o">&lt;</span> <span class="n">ywid</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">aspect</span><span class="p">:</span>
                <span class="n">xmi</span> <span class="o">-=</span> <span class="p">(</span><span class="n">ywid</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">aspect</span> <span class="o">-</span> <span class="n">xwid</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>
                <span class="n">xma</span> <span class="o">+=</span> <span class="p">(</span><span class="n">ywid</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">aspect</span> <span class="o">-</span> <span class="n">xwid</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>
                <span class="n">xmi</span><span class="p">,</span> <span class="n">xma</span><span class="p">,</span> <span class="n">xinc</span><span class="p">,</span> <span class="n">xlabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">make_params</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">xmi</span><span class="p">,</span> <span class="n">xma</span><span class="p">),</span> <span class="n">ax_projection</span><span class="p">,</span> <span class="n">override_mode</span><span class="o">=</span><span class="s">&#39;off&#39;</span><span class="p">,</span>
                    <span class="n">override_scaled_unit_factor</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">xmi</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">xma</span><span class="p">,</span> <span class="n">xinc</span><span class="o">=</span><span class="n">xinc</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span>
                      <span class="n">ymin</span><span class="o">=</span><span class="n">ymi</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">yma</span><span class="p">,</span> <span class="n">yinc</span><span class="o">=</span><span class="n">yinc</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">zmin</span><span class="o">=</span><span class="n">zmi</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">zma</span><span class="p">,</span> <span class="n">zinc</span><span class="o">=</span><span class="n">zinc</span><span class="p">,</span> <span class="n">zlabel</span><span class="o">=</span><span class="n">zlabel</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">params</span></div></div>


<div class="viewcode-block" id="GumSpring"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.GumSpring">[docs]</a><span class="k">class</span> <span class="nc">GumSpring</span><span class="p">:</span>

    <span class="sd">&#39;&#39;&#39;Sizing policy implementing a minimal size, plus a desire to grow.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minimal</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">grow</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minimal</span> <span class="o">=</span> <span class="n">minimal</span>
        <span class="k">if</span> <span class="n">grow</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">minimal</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grow</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grow</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grow</span> <span class="o">=</span> <span class="n">grow</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="k">def</span> <span class="nf">get_minimal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minimal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">minimal</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>

    <span class="k">def</span> <span class="nf">get_grow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow</span>

    <span class="k">def</span> <span class="nf">set_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span></div>


<span class="k">def</span> <span class="nf">distribute</span><span class="p">(</span><span class="n">sizes</span><span class="p">,</span> <span class="n">grows</span><span class="p">,</span> <span class="n">space</span><span class="p">):</span>
    <span class="n">sizes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sizes</span><span class="p">)</span>
    <span class="n">gsum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">grows</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gsum</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sizes</span><span class="p">)):</span>
            <span class="n">sizes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">space</span><span class="o">*</span><span class="n">grows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">gsum</span>
    <span class="k">return</span> <span class="n">sizes</span>


<div class="viewcode-block" id="Widget"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.Widget">[docs]</a><span class="k">class</span> <span class="nc">Widget</span><span class="p">(</span><span class="n">Guru</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;Base class of the gmtpy layout system.</span>

<span class="sd">    The Widget class provides the basic functionality for the nesting and</span>
<span class="sd">    placing of elements on the output page, and maintains the sizing policies</span>
<span class="sd">    of each element. Each of the layouts defined in gmtpy is itself a Widget.</span>

<span class="sd">    Sizing of the widget is controlled by :py:meth:`get_min_size` and</span>
<span class="sd">    :py:meth:`get_grow` which should be overloaded in derived classes. The</span>
<span class="sd">    basic behaviour of a Widget instance is to have a vertical and a horizontal</span>
<span class="sd">    minimum size which default to zero, as well as a vertical and a horizontal</span>
<span class="sd">    desire to grow, represented by floats, which default to 1.0. Additionally</span>
<span class="sd">    an aspect ratio constraint may be imposed on the Widget.</span>

<span class="sd">    After layouting, the widget provides its width, height, x-offset and</span>
<span class="sd">    y-offset in various ways. Via the Guru interface (see :py:class:`Guru`</span>
<span class="sd">    class), templates for the -X, -Y and -J option arguments used by GMT</span>
<span class="sd">    arguments are provided.  The defaults are suitable for plotting of linear</span>
<span class="sd">    (-JX) plots. Other projections can be selected by giving an appropriate &#39;J&#39;</span>
<span class="sd">    template, or by manual construction of the -J option, e.g. by utilizing the</span>
<span class="sd">    :py:meth:`width` and :py:meth:`height` methods. The :py:meth:`bbox` method</span>
<span class="sd">    can be used to create a PostScript bounding box from the widgets border,</span>
<span class="sd">    e.g. for use in the :py:meth:`save` method of :py:class:`GMT` instances.</span>

<span class="sd">    The convention is, that all sizes are given in PostScript points.</span>
<span class="sd">    Conversion factors are provided as constants :py:const:`inch` and</span>
<span class="sd">    :py:const:`cm` in the gmtpy module. &#39;&#39;&#39;</span>

<div class="viewcode-block" id="Widget.__init__"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.Widget.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">horizontal</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">vertical</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Create new widget.&#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">templates</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">X</span><span class="o">=</span><span class="s">&#39;-Xa%(xoffset)gp&#39;</span><span class="p">,</span>
            <span class="n">Y</span><span class="o">=</span><span class="s">&#39;-Ya%(yoffset)gp&#39;</span><span class="p">,</span>
            <span class="n">J</span><span class="o">=</span><span class="s">&#39;-JX%(width)gp/%(height)gp&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">horizontal</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">horizontal</span> <span class="o">=</span> <span class="n">GumSpring</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">horizontal</span> <span class="o">=</span> <span class="n">horizontal</span>

        <span class="k">if</span> <span class="n">vertical</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertical</span> <span class="o">=</span> <span class="n">GumSpring</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertical</span> <span class="o">=</span> <span class="n">vertical</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">aspect</span> <span class="o">=</span> <span class="k">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dirty</span> <span class="o">=</span> <span class="k">True</span></div>

<div class="viewcode-block" id="Widget.set_parent"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.Widget.set_parent">[docs]</a>    <span class="k">def</span> <span class="nf">set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Set the parent widget.</span>

<span class="sd">        This method should not be called directly. The :py:meth:`set_widget`</span>
<span class="sd">        methods are responsible for calling this. &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dirtyfy</span><span class="p">()</span></div>

<div class="viewcode-block" id="Widget.get_parent"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.Widget.get_parent">[docs]</a>    <span class="k">def</span> <span class="nf">get_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Get the widgets parent widget.&#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span></div>

<div class="viewcode-block" id="Widget.get_root"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.Widget.get_root">[docs]</a>    <span class="k">def</span> <span class="nf">get_root</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Get the root widget in the layout hierarchy.&#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parent</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Widget.set_horizontal"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.Widget.set_horizontal">[docs]</a>    <span class="k">def</span> <span class="nf">set_horizontal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minimal</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">grow</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Set the horizontal sizing policy of the Widget.</span>


<span class="sd">        :param minimal: new minimal width of the widget</span>
<span class="sd">        :param grow:    new horizontal grow disire of the widget</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">horizontal</span> <span class="o">=</span> <span class="n">GumSpring</span><span class="p">(</span><span class="n">minimal</span><span class="p">,</span> <span class="n">grow</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dirtyfy</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">get_horizontal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizontal</span><span class="o">.</span><span class="n">get_minimal</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizontal</span><span class="o">.</span><span class="n">get_grow</span><span class="p">()</span>

<div class="viewcode-block" id="Widget.set_vertical"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.Widget.set_vertical">[docs]</a>    <span class="k">def</span> <span class="nf">set_vertical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minimal</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">grow</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Set the horizontal sizing policy of the Widget.</span>

<span class="sd">        :param minimal: new minimal height of the widget</span>
<span class="sd">        :param grow:    new vertical grow disire of the widget</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vertical</span> <span class="o">=</span> <span class="n">GumSpring</span><span class="p">(</span><span class="n">minimal</span><span class="p">,</span> <span class="n">grow</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dirtyfy</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">get_vertical</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertical</span><span class="o">.</span><span class="n">get_minimal</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertical</span><span class="o">.</span><span class="n">get_grow</span><span class="p">()</span>

<div class="viewcode-block" id="Widget.set_aspect"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.Widget.set_aspect">[docs]</a>    <span class="k">def</span> <span class="nf">set_aspect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Set aspect constraint on the widget.</span>

<span class="sd">        The aspect is given as height divided by width.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">aspect</span> <span class="o">=</span> <span class="n">aspect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dirtyfy</span><span class="p">()</span></div>

<div class="viewcode-block" id="Widget.set_policy"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.Widget.set_policy">[docs]</a>    <span class="k">def</span> <span class="nf">set_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minimal</span><span class="o">=</span><span class="p">(</span><span class="k">None</span><span class="p">,</span> <span class="k">None</span><span class="p">),</span> <span class="n">grow</span><span class="o">=</span><span class="p">(</span><span class="k">None</span><span class="p">,</span> <span class="k">None</span><span class="p">),</span> <span class="n">aspect</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Shortcut to set sizing and aspect constraints in a single method</span>
<span class="sd">        call.&#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_horizontal</span><span class="p">(</span><span class="n">minimal</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">grow</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_vertical</span><span class="p">(</span><span class="n">minimal</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">grow</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="n">aspect</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">get_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mh</span><span class="p">,</span> <span class="n">gh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_horizontal</span><span class="p">()</span>
        <span class="n">mv</span><span class="p">,</span> <span class="n">gv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_vertical</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">mh</span><span class="p">,</span> <span class="n">mv</span><span class="p">),</span> <span class="p">(</span><span class="n">gh</span><span class="p">,</span> <span class="n">gv</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">aspect</span>

<div class="viewcode-block" id="Widget.legalize"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.Widget.legalize">[docs]</a>    <span class="k">def</span> <span class="nf">legalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Get legal size for widget.</span>

<span class="sd">        Returns: (new_size, new_offset)</span>

<span class="sd">        Given a box as ``size`` and ``offset``, return ``new_size`` and</span>
<span class="sd">        ``new_offset``, such that the widget&#39;s sizing and aspect constraints</span>
<span class="sd">        are fullfilled. The returned box is centered on the given input box.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">sh</span><span class="p">,</span> <span class="n">sv</span> <span class="o">=</span> <span class="n">size</span>
        <span class="n">oh</span><span class="p">,</span> <span class="n">ov</span> <span class="o">=</span> <span class="n">offset</span>
        <span class="n">shs</span><span class="p">,</span> <span class="n">svs</span> <span class="o">=</span> <span class="n">Widget</span><span class="o">.</span><span class="n">get_min_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">ghs</span><span class="p">,</span> <span class="n">gvs</span> <span class="o">=</span> <span class="n">Widget</span><span class="o">.</span><span class="n">get_grow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ghs</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">oh</span> <span class="o">+=</span> <span class="p">(</span><span class="n">sh</span><span class="o">-</span><span class="n">shs</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
            <span class="n">sh</span> <span class="o">=</span> <span class="n">shs</span>

        <span class="k">if</span> <span class="n">gvs</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">ov</span> <span class="o">+=</span> <span class="p">(</span><span class="n">sv</span><span class="o">-</span><span class="n">svs</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
            <span class="n">sv</span> <span class="o">=</span> <span class="n">svs</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aspect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sh</span> <span class="o">&gt;</span> <span class="n">sv</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">aspect</span><span class="p">:</span>
                <span class="n">oh</span> <span class="o">+=</span> <span class="p">(</span><span class="n">sh</span><span class="o">-</span><span class="n">sv</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">aspect</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
                <span class="n">sh</span> <span class="o">=</span> <span class="n">sv</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">aspect</span>
            <span class="k">if</span> <span class="n">sv</span> <span class="o">&gt;</span> <span class="n">sh</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">aspect</span><span class="p">:</span>
                <span class="n">ov</span> <span class="o">+=</span> <span class="p">(</span><span class="n">sv</span><span class="o">-</span><span class="n">sh</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">aspect</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
                <span class="n">sv</span> <span class="o">=</span> <span class="n">sh</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">aspect</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">sh</span><span class="p">,</span> <span class="n">sv</span><span class="p">),</span> <span class="p">(</span><span class="n">oh</span><span class="p">,</span> <span class="n">ov</span><span class="p">)</span></div>

<div class="viewcode-block" id="Widget.get_min_size"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.Widget.get_min_size">[docs]</a>    <span class="k">def</span> <span class="nf">get_min_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Get minimum size of widget.</span>

<span class="sd">        Used by the layout managers. Should be overloaded in derived classes.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">mh</span><span class="p">,</span> <span class="n">mv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizontal</span><span class="o">.</span><span class="n">get_minimal</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertical</span><span class="o">.</span><span class="n">get_minimal</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aspect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mv</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">mh</span><span class="p">,</span> <span class="n">mh</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">aspect</span>
            <span class="k">elif</span> <span class="n">mh</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">mv</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">aspect</span><span class="p">,</span> <span class="n">mv</span>
        <span class="k">return</span> <span class="n">mh</span><span class="p">,</span> <span class="n">mv</span></div>

<div class="viewcode-block" id="Widget.get_grow"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.Widget.get_grow">[docs]</a>    <span class="k">def</span> <span class="nf">get_grow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Get widget&#39;s desire to grow.</span>

<span class="sd">        Used by the layout managers. Should be overloaded in derived classes.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizontal</span><span class="o">.</span><span class="n">get_grow</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertical</span><span class="o">.</span><span class="n">get_grow</span><span class="p">()</span></div>

<div class="viewcode-block" id="Widget.set_size"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.Widget.set_size">[docs]</a>    <span class="k">def</span> <span class="nf">set_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Set the widget&#39;s current size.</span>

<span class="sd">        Should not be called directly. It is the layout manager&#39;s</span>
<span class="sd">        responsibility to call this. &#39;&#39;&#39;</span>

        <span class="p">(</span><span class="n">sh</span><span class="p">,</span> <span class="n">sv</span><span class="p">),</span> <span class="n">inner_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">legalize</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">inner_offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">horizontal</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vertical</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">sv</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dirty</span> <span class="o">=</span> <span class="k">False</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">indent</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span><span class="n">ind</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">splitlines</span><span class="p">())</span>
        <span class="n">size</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_size</span><span class="p">()</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;%s (%g x %g) (%g, %g)</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">,)</span> <span class="o">+</span> <span class="n">size</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span>
        <span class="n">children</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_children</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">children</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;  &#39;</span> <span class="o">+</span> <span class="n">indent</span><span class="p">(</span><span class="s">&#39;  &#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">children</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">policies_debug_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">indent</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span><span class="n">ind</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">splitlines</span><span class="p">())</span>
        <span class="n">mins</span><span class="p">,</span> <span class="n">grows</span><span class="p">,</span> <span class="n">aspect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_policy</span><span class="p">()</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;%s: minimum=(%s, %s), grow=(%s, %s), aspect=%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">,)</span> <span class="o">+</span> <span class="n">mins</span><span class="o">+</span><span class="n">grows</span><span class="o">+</span><span class="p">(</span><span class="n">aspect</span><span class="p">,))</span>

        <span class="n">children</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_children</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">children</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;  &#39;</span> <span class="o">+</span> <span class="n">indent</span><span class="p">(</span>
                <span class="s">&#39;  &#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">policies_debug_str</span><span class="p">())</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">children</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">s</span>

<div class="viewcode-block" id="Widget.get_corners"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.Widget.get_corners">[docs]</a>    <span class="k">def</span> <span class="nf">get_corners</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">descend</span><span class="o">=</span><span class="k">False</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Get coordinates of the corners of the widget.</span>

<span class="sd">        Returns list with coordinate tuples.</span>

<span class="sd">        If ``descend`` is True, the returned list will contain corner</span>
<span class="sd">        coordinates of all sub-widgets.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">do_layout</span><span class="p">()</span>
        <span class="p">(</span><span class="n">sh</span><span class="p">,</span> <span class="n">sv</span><span class="p">),</span> <span class="p">(</span><span class="n">oh</span><span class="p">,</span> <span class="n">ov</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_size</span><span class="p">()</span>
        <span class="n">corners</span> <span class="o">=</span> <span class="p">[(</span><span class="n">oh</span><span class="p">,</span> <span class="n">ov</span><span class="p">),</span> <span class="p">(</span><span class="n">oh</span><span class="o">+</span><span class="n">sh</span><span class="p">,</span> <span class="n">ov</span><span class="p">),</span> <span class="p">(</span><span class="n">oh</span><span class="o">+</span><span class="n">sh</span><span class="p">,</span> <span class="n">ov</span><span class="o">+</span><span class="n">sv</span><span class="p">),</span> <span class="p">(</span><span class="n">oh</span><span class="p">,</span> <span class="n">ov</span><span class="o">+</span><span class="n">sv</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">descend</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_children</span><span class="p">():</span>
                <span class="n">corners</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">get_corners</span><span class="p">(</span><span class="n">descend</span><span class="o">=</span><span class="k">True</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">corners</span></div>

<div class="viewcode-block" id="Widget.get_sizes"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.Widget.get_sizes">[docs]</a>    <span class="k">def</span> <span class="nf">get_sizes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Get sizes of this widget and all it&#39;s children.</span>

<span class="sd">        Returns a list with size tuples.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_layout</span><span class="p">()</span>
        <span class="n">sizes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_size</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_children</span><span class="p">():</span>
            <span class="n">sizes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">get_sizes</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">sizes</span></div>

<div class="viewcode-block" id="Widget.do_layout"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.Widget.do_layout">[docs]</a>    <span class="k">def</span> <span class="nf">do_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Triggers layouting of the widget hierarchy, if needed.&#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">do_layout</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirty</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">sh</span><span class="p">,</span> <span class="n">sv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_min_size</span><span class="p">()</span>
        <span class="n">gh</span><span class="p">,</span> <span class="n">gv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_grow</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">sh</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">gh</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">sh</span> <span class="o">=</span> <span class="mf">15.</span><span class="o">*</span><span class="n">cm</span>
        <span class="k">if</span> <span class="n">sv</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">gv</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">sv</span> <span class="o">=</span> <span class="mf">15.</span><span class="o">*</span><span class="n">cm</span><span class="o">*</span><span class="n">gv</span><span class="o">/</span><span class="n">gh</span> <span class="o">*</span> <span class="mf">1.</span><span class="o">/</span><span class="n">golden_ratio</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_size</span><span class="p">((</span><span class="n">sh</span><span class="p">,</span> <span class="n">sv</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">))</span></div>

<div class="viewcode-block" id="Widget.get_children"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.Widget.get_children">[docs]</a>    <span class="k">def</span> <span class="nf">get_children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Get sub-widgets contained in this widget.</span>

<span class="sd">        Returns a list of widgets.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="Widget.get_size"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.Widget.get_size">[docs]</a>    <span class="k">def</span> <span class="nf">get_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Get current size and position of the widget.</span>

<span class="sd">        Triggers layouting and returns</span>
<span class="sd">        ``((width, height), (xoffset, yoffset))``</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">do_layout</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">horizontal</span><span class="o">.</span><span class="n">get_value</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vertical</span><span class="o">.</span><span class="n">get_value</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span></div>

<div class="viewcode-block" id="Widget.get_params"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.Widget.get_params">[docs]</a>    <span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Get current size and position of the widget.</span>

<span class="sd">        Triggers layouting and returns dict with keys ``&#39;xoffset&#39;``,</span>
<span class="sd">        ``&#39;yoffset&#39;``, ``&#39;width&#39;`` and ``&#39;height&#39;``. &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">do_layout</span><span class="p">()</span>
        <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="n">xo</span><span class="p">,</span> <span class="n">yo</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_size</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">xoffset</span><span class="o">=</span><span class="n">xo</span><span class="p">,</span> <span class="n">yoffset</span><span class="o">=</span><span class="n">yo</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">w</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">h</span><span class="p">,</span>
                    <span class="n">width_m</span><span class="o">=</span><span class="n">w</span><span class="o">/</span><span class="n">_units</span><span class="p">[</span><span class="s">&#39;m&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="Widget.width"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.Widget.width">[docs]</a>    <span class="k">def</span> <span class="nf">width</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Get current width of the widget.</span>

<span class="sd">        Triggers layouting and returns width.&#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">do_layout</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizontal</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span></div>

<div class="viewcode-block" id="Widget.height"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.Widget.height">[docs]</a>    <span class="k">def</span> <span class="nf">height</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Get current height of the widget.</span>

<span class="sd">        Triggers layouting and return height.&#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">do_layout</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertical</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span></div>

<div class="viewcode-block" id="Widget.bbox"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.Widget.bbox">[docs]</a>    <span class="k">def</span> <span class="nf">bbox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Get PostScript bounding box for this widget.</span>

<span class="sd">        Triggers layouting and returns values suitable to create PS bounding</span>
<span class="sd">        box, representing the widgets current size and position.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">do_layout</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">())</span></div>

<div class="viewcode-block" id="Widget.dirtyfy"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.Widget.dirtyfy">[docs]</a>    <span class="k">def</span> <span class="nf">dirtyfy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Set dirty flag on top level widget in the hierarchy.</span>

<span class="sd">        Called by various methods, to indicate, that the widget hierarchy needs</span>
<span class="sd">        new layouting.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">dirtyfy</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dirty</span> <span class="o">=</span> <span class="k">True</span></div></div>


<div class="viewcode-block" id="CenterLayout"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.CenterLayout">[docs]</a><span class="k">class</span> <span class="nc">CenterLayout</span><span class="p">(</span><span class="n">Widget</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;A layout manager which centers its single child widget.</span>

<span class="sd">    The child widget may be oversized.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">horizontal</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">vertical</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
        <span class="n">Widget</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">horizontal</span><span class="p">,</span> <span class="n">vertical</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">Widget</span><span class="p">(</span><span class="n">horizontal</span><span class="o">=</span><span class="n">GumSpring</span><span class="p">(</span><span class="n">grow</span><span class="o">=</span><span class="mf">1.</span><span class="p">),</span>
                              <span class="n">vertical</span><span class="o">=</span><span class="n">GumSpring</span><span class="p">(</span><span class="n">grow</span><span class="o">=</span><span class="mf">1.</span><span class="p">),</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_min_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">shs</span><span class="p">,</span> <span class="n">svs</span> <span class="o">=</span> <span class="n">Widget</span><span class="o">.</span><span class="n">get_min_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">sh</span><span class="p">,</span> <span class="n">sv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">get_min_size</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">shs</span><span class="p">,</span> <span class="n">sh</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">svs</span><span class="p">,</span> <span class="n">sv</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_grow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ghs</span><span class="p">,</span> <span class="n">gvs</span> <span class="o">=</span> <span class="n">Widget</span><span class="o">.</span><span class="n">get_grow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">gh</span><span class="p">,</span> <span class="n">gv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">get_grow</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">gh</span><span class="o">*</span><span class="n">ghs</span><span class="p">,</span> <span class="n">gv</span><span class="o">*</span><span class="n">gvs</span>

    <span class="k">def</span> <span class="nf">set_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
        <span class="p">(</span><span class="n">sh</span><span class="p">,</span> <span class="n">sv</span><span class="p">),</span> <span class="p">(</span><span class="n">oh</span><span class="p">,</span> <span class="n">ov</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">legalize</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>

        <span class="n">shc</span><span class="p">,</span> <span class="n">svc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">get_min_size</span><span class="p">()</span>
        <span class="n">ghc</span><span class="p">,</span> <span class="n">gvc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">get_grow</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ghc</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="n">shc</span> <span class="o">=</span> <span class="n">sh</span>
        <span class="k">if</span> <span class="n">gvc</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="n">svc</span> <span class="o">=</span> <span class="n">sv</span>
        <span class="n">ohc</span> <span class="o">=</span> <span class="n">oh</span><span class="o">+</span><span class="p">(</span><span class="n">sh</span><span class="o">-</span><span class="n">shc</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
        <span class="n">ovc</span> <span class="o">=</span> <span class="n">ov</span><span class="o">+</span><span class="p">(</span><span class="n">sv</span><span class="o">-</span><span class="n">svc</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">set_size</span><span class="p">((</span><span class="n">shc</span><span class="p">,</span> <span class="n">svc</span><span class="p">),</span> <span class="p">(</span><span class="n">ohc</span><span class="p">,</span> <span class="n">ovc</span><span class="p">))</span>
        <span class="n">Widget</span><span class="o">.</span><span class="n">set_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="n">sh</span><span class="p">,</span> <span class="n">sv</span><span class="p">),</span> <span class="p">(</span><span class="n">oh</span><span class="p">,</span> <span class="n">ov</span><span class="p">))</span>

<div class="viewcode-block" id="CenterLayout.set_widget"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.CenterLayout.set_widget">[docs]</a>    <span class="k">def</span> <span class="nf">set_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Set the child widget, which shall be centered.&#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">widget</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
            <span class="n">widget</span> <span class="o">=</span> <span class="n">Widget</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">widget</span>

        <span class="n">widget</span><span class="o">.</span><span class="n">set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">get_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span>

    <span class="k">def</span> <span class="nf">get_children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">]</span></div>


<div class="viewcode-block" id="FrameLayout"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.FrameLayout">[docs]</a><span class="k">class</span> <span class="nc">FrameLayout</span><span class="p">(</span><span class="n">Widget</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;A layout manager containing a center widget sorrounded by four margin</span>
<span class="sd">    widgets.</span>

<span class="sd">    ::</span>

<span class="sd">            +---------------------------+</span>
<span class="sd">            |             top           |</span>
<span class="sd">            +---------------------------+</span>
<span class="sd">            |      |            |       |</span>
<span class="sd">            | left |   center   | right |</span>
<span class="sd">            |      |            |       |</span>
<span class="sd">            +---------------------------+</span>
<span class="sd">            |           bottom          |</span>
<span class="sd">            +---------------------------+</span>

<span class="sd">    This layout manager does a little bit of extra effort to maintain the</span>
<span class="sd">    aspect constraint of the center widget, if this is set. It does so, by</span>
<span class="sd">    allowing for a bit more flexibility in the sizing of the margins. Two</span>
<span class="sd">    shortcut methods are provided to set the margin sizes in one shot:</span>
<span class="sd">    :py:meth:`set_fixed_margins` and :py:meth:`set_min_margins`. The first sets</span>
<span class="sd">    the margins to fixed sizes, while the second gives them a minimal size and</span>
<span class="sd">    a (neglectably) small desire to grow. Using the latter may be useful when</span>
<span class="sd">    setting an aspect constraint on the center widget, because this way the</span>
<span class="sd">    maximum size of the center widget may be controlled without creating empty</span>
<span class="sd">    spaces between the widgets.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">horizontal</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">vertical</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
        <span class="n">Widget</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">horizontal</span><span class="p">,</span> <span class="n">vertical</span><span class="p">)</span>
        <span class="n">mw</span> <span class="o">=</span> <span class="mf">3.</span><span class="o">*</span><span class="n">cm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">Widget</span><span class="p">(</span>
            <span class="n">horizontal</span><span class="o">=</span><span class="n">GumSpring</span><span class="p">(</span><span class="n">grow</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">minimal</span><span class="o">=</span><span class="n">mw</span><span class="p">),</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">Widget</span><span class="p">(</span>
            <span class="n">horizontal</span><span class="o">=</span><span class="n">GumSpring</span><span class="p">(</span><span class="n">grow</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">minimal</span><span class="o">=</span><span class="n">mw</span><span class="p">),</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="n">Widget</span><span class="p">(</span>
            <span class="n">vertical</span><span class="o">=</span><span class="n">GumSpring</span><span class="p">(</span><span class="n">grow</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">minimal</span><span class="o">=</span><span class="n">mw</span><span class="o">/</span><span class="n">golden_ratio</span><span class="p">),</span>
            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">Widget</span><span class="p">(</span>
            <span class="n">vertical</span><span class="o">=</span><span class="n">GumSpring</span><span class="p">(</span><span class="n">grow</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">minimal</span><span class="o">=</span><span class="n">mw</span><span class="o">/</span><span class="n">golden_ratio</span><span class="p">),</span>
            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">Widget</span><span class="p">(</span>
            <span class="n">horizontal</span><span class="o">=</span><span class="n">GumSpring</span><span class="p">(</span><span class="n">grow</span><span class="o">=</span><span class="mf">0.7</span><span class="p">),</span> <span class="n">vertical</span><span class="o">=</span><span class="n">GumSpring</span><span class="p">(</span><span class="n">grow</span><span class="o">=</span><span class="mf">0.7</span><span class="p">),</span>
            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="FrameLayout.set_fixed_margins"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.FrameLayout.set_fixed_margins">[docs]</a>    <span class="k">def</span> <span class="nf">set_fixed_margins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Give margins fixed size constraints.&#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">set_horizontal</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">set_horizontal</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">set_vertical</span><span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bottom</span><span class="o">.</span><span class="n">set_vertical</span><span class="p">(</span><span class="n">bottom</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="FrameLayout.set_min_margins"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.FrameLayout.set_min_margins">[docs]</a>    <span class="k">def</span> <span class="nf">set_min_margins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">grow</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Give margins a minimal size and the possibility to grow.</span>

<span class="sd">        The desire to grow is set to a very small number.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">set_horizontal</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">grow</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">set_horizontal</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">grow</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">set_vertical</span><span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="n">grow</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bottom</span><span class="o">.</span><span class="n">set_vertical</span><span class="p">(</span><span class="n">bottom</span><span class="p">,</span> <span class="n">grow</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">get_min_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">shs</span><span class="p">,</span> <span class="n">svs</span> <span class="o">=</span> <span class="n">Widget</span><span class="o">.</span><span class="n">get_min_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">sl</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">st</span><span class="p">,</span> <span class="n">sb</span><span class="p">,</span> <span class="n">sc</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">get_min_size</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">)]</span>
        <span class="n">gl</span><span class="p">,</span> <span class="n">gr</span><span class="p">,</span> <span class="n">gt</span><span class="p">,</span> <span class="n">gb</span><span class="p">,</span> <span class="n">gc</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">get_grow</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">)]</span>

        <span class="n">shsum</span> <span class="o">=</span> <span class="n">sl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">sr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">sc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">svsum</span> <span class="o">=</span> <span class="n">st</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">sb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">sc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c"># prevent widgets from collapsing</span>
        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="p">((</span><span class="n">sl</span><span class="p">,</span> <span class="n">gl</span><span class="p">),</span> <span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">gr</span><span class="p">),</span> <span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="n">gc</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">shsum</span> <span class="o">+=</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">cm</span>

        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="p">((</span><span class="n">st</span><span class="p">,</span> <span class="n">gt</span><span class="p">),</span> <span class="p">(</span><span class="n">sb</span><span class="p">,</span> <span class="n">gb</span><span class="p">),</span> <span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="n">gc</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">svsum</span> <span class="o">+=</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">cm</span>

        <span class="n">sh</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">shs</span><span class="p">,</span> <span class="n">shsum</span><span class="p">)</span>
        <span class="n">sv</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">svs</span><span class="p">,</span> <span class="n">svsum</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">sh</span><span class="p">,</span> <span class="n">sv</span>

    <span class="k">def</span> <span class="nf">get_grow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ghs</span><span class="p">,</span> <span class="n">gvs</span> <span class="o">=</span> <span class="n">Widget</span><span class="o">.</span><span class="n">get_grow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">gh</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">get_grow</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">get_grow</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">get_grow</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">ghs</span>
        <span class="n">gv</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">get_grow</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">bottom</span><span class="o">.</span><span class="n">get_grow</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">get_grow</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">gvs</span>
        <span class="k">return</span> <span class="n">gh</span><span class="p">,</span> <span class="n">gv</span>

    <span class="k">def</span> <span class="nf">set_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
        <span class="p">(</span><span class="n">sh</span><span class="p">,</span> <span class="n">sv</span><span class="p">),</span> <span class="p">(</span><span class="n">oh</span><span class="p">,</span> <span class="n">ov</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">legalize</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>

        <span class="n">sl</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">st</span><span class="p">,</span> <span class="n">sb</span><span class="p">,</span> <span class="n">sc</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">get_min_size</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">)]</span>
        <span class="n">gl</span><span class="p">,</span> <span class="n">gr</span><span class="p">,</span> <span class="n">gt</span><span class="p">,</span> <span class="n">gb</span><span class="p">,</span> <span class="n">gc</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">get_grow</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">)]</span>

        <span class="n">ah</span> <span class="o">=</span> <span class="n">sh</span> <span class="o">-</span> <span class="p">(</span><span class="n">sl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">sr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">sc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">av</span> <span class="o">=</span> <span class="n">sv</span> <span class="o">-</span> <span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">sb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">sc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">ah</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Container not wide enough for contents &quot;</span>
                            <span class="s">&quot;(FrameLayout, available: %g cm, needed: %g cm)&quot;</span>
                            <span class="o">%</span> <span class="p">(</span><span class="n">sh</span><span class="o">/</span><span class="n">cm</span><span class="p">,</span> <span class="p">(</span><span class="n">sl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">sr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">sc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">cm</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">av</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Container not high enough for contents &quot;</span>
                            <span class="s">&quot;(FrameLayout, available: %g cm, needed: %g cm)&quot;</span>
                            <span class="o">%</span> <span class="p">(</span><span class="n">sv</span><span class="o">/</span><span class="n">cm</span><span class="p">,</span> <span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">sb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">sc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">cm</span><span class="p">))</span>

        <span class="n">slh</span><span class="p">,</span> <span class="n">srh</span><span class="p">,</span> <span class="n">sch</span> <span class="o">=</span> <span class="n">distribute</span><span class="p">((</span><span class="n">sl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sc</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                   <span class="p">(</span><span class="n">gl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gc</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">ah</span><span class="p">)</span>
        <span class="n">stv</span><span class="p">,</span> <span class="n">sbv</span><span class="p">,</span> <span class="n">scv</span> <span class="o">=</span> <span class="n">distribute</span><span class="p">((</span><span class="n">st</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sb</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sc</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                                   <span class="p">(</span><span class="n">gt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">gb</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">gc</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">av</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">aspect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
            <span class="n">ahm</span> <span class="o">=</span> <span class="n">sh</span> <span class="o">-</span> <span class="p">(</span><span class="n">sl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">sr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">scv</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">aspect</span><span class="p">)</span>
            <span class="n">avm</span> <span class="o">=</span> <span class="n">sv</span> <span class="o">-</span> <span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">sb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">sch</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">aspect</span><span class="p">)</span>
            <span class="k">if</span> <span class="mf">0.0</span> <span class="o">&lt;</span> <span class="n">ahm</span> <span class="o">&lt;</span> <span class="n">ah</span><span class="p">:</span>
                <span class="n">slh</span><span class="p">,</span> <span class="n">srh</span><span class="p">,</span> <span class="n">sch</span> <span class="o">=</span> <span class="n">distribute</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">sl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">scv</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">aspect</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">gl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">ahm</span><span class="p">)</span>

            <span class="k">elif</span> <span class="mf">0.0</span> <span class="o">&lt;</span> <span class="n">avm</span> <span class="o">&lt;</span> <span class="n">av</span><span class="p">:</span>
                <span class="n">stv</span><span class="p">,</span> <span class="n">sbv</span><span class="p">,</span> <span class="n">scv</span> <span class="o">=</span> <span class="n">distribute</span><span class="p">((</span><span class="n">st</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sb</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                            <span class="n">sch</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">aspect</span><span class="p">),</span>
                                           <span class="p">(</span><span class="n">gt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">gb</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">avm</span><span class="p">)</span>

        <span class="n">ah</span> <span class="o">=</span> <span class="n">sh</span> <span class="o">-</span> <span class="p">(</span><span class="n">slh</span><span class="o">+</span><span class="n">srh</span><span class="o">+</span><span class="n">sch</span><span class="p">)</span>
        <span class="n">av</span> <span class="o">=</span> <span class="n">sv</span> <span class="o">-</span> <span class="p">(</span><span class="n">stv</span><span class="o">+</span><span class="n">sbv</span><span class="o">+</span><span class="n">scv</span><span class="p">)</span>

        <span class="n">oh</span> <span class="o">+=</span> <span class="n">ah</span><span class="o">/</span><span class="mf">2.</span>
        <span class="n">ov</span> <span class="o">+=</span> <span class="n">av</span><span class="o">/</span><span class="mf">2.</span>
        <span class="n">sh</span> <span class="o">-=</span> <span class="n">ah</span>
        <span class="n">sv</span> <span class="o">-=</span> <span class="n">av</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">set_size</span><span class="p">((</span><span class="n">slh</span><span class="p">,</span> <span class="n">scv</span><span class="p">),</span> <span class="p">(</span><span class="n">oh</span><span class="p">,</span> <span class="n">ov</span><span class="o">+</span><span class="n">sbv</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">set_size</span><span class="p">((</span><span class="n">srh</span><span class="p">,</span> <span class="n">scv</span><span class="p">),</span> <span class="p">(</span><span class="n">oh</span><span class="o">+</span><span class="n">slh</span><span class="o">+</span><span class="n">sch</span><span class="p">,</span> <span class="n">ov</span><span class="o">+</span><span class="n">sbv</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">set_size</span><span class="p">((</span><span class="n">sh</span><span class="p">,</span> <span class="n">stv</span><span class="p">),</span> <span class="p">(</span><span class="n">oh</span><span class="p">,</span> <span class="n">ov</span><span class="o">+</span><span class="n">sbv</span><span class="o">+</span><span class="n">scv</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bottom</span><span class="o">.</span><span class="n">set_size</span><span class="p">((</span><span class="n">sh</span><span class="p">,</span> <span class="n">sbv</span><span class="p">),</span> <span class="p">(</span><span class="n">oh</span><span class="p">,</span> <span class="n">ov</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">set_size</span><span class="p">((</span><span class="n">sch</span><span class="p">,</span> <span class="n">scv</span><span class="p">),</span> <span class="p">(</span><span class="n">oh</span><span class="o">+</span><span class="n">slh</span><span class="p">,</span> <span class="n">ov</span><span class="o">+</span><span class="n">sbv</span><span class="p">))</span>
        <span class="n">Widget</span><span class="o">.</span><span class="n">set_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="n">sh</span><span class="p">,</span> <span class="n">sv</span><span class="p">),</span> <span class="p">(</span><span class="n">oh</span><span class="p">,</span> <span class="n">ov</span><span class="p">))</span>

<div class="viewcode-block" id="FrameLayout.set_widget"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.FrameLayout.set_widget">[docs]</a>    <span class="k">def</span> <span class="nf">set_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s">&#39;center&#39;</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Set one of the sub-widgets.</span>

<span class="sd">        ``which`` should be one of ``&#39;left&#39;``, ``&#39;right&#39;``, ``&#39;top&#39;``,</span>
<span class="sd">        ``&#39;bottom&#39;`` or ``&#39;center&#39;``. &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">widget</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
            <span class="n">widget</span> <span class="o">=</span> <span class="n">Widget</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">which</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;left&#39;</span><span class="p">,</span> <span class="s">&#39;right&#39;</span><span class="p">,</span> <span class="s">&#39;top&#39;</span><span class="p">,</span> <span class="s">&#39;bottom&#39;</span><span class="p">,</span> <span class="s">&#39;center&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">which</span><span class="p">]</span> <span class="o">=</span> <span class="n">widget</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;No such sub-widget: %s&#39;</span> <span class="o">%</span> <span class="n">which</span><span class="p">)</span>

        <span class="n">widget</span><span class="o">.</span><span class="n">set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="FrameLayout.get_widget"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.FrameLayout.get_widget">[docs]</a>    <span class="k">def</span> <span class="nf">get_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s">&#39;center&#39;</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Get one of the sub-widgets.</span>

<span class="sd">        ``which`` should be one of ``&#39;left&#39;``, ``&#39;right&#39;``, ``&#39;top&#39;``,</span>
<span class="sd">        ``&#39;bottom&#39;`` or ``&#39;center&#39;``. &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">which</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;left&#39;</span><span class="p">,</span> <span class="s">&#39;right&#39;</span><span class="p">,</span> <span class="s">&#39;top&#39;</span><span class="p">,</span> <span class="s">&#39;bottom&#39;</span><span class="p">,</span> <span class="s">&#39;center&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">which</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;No such sub-widget: %s&#39;</span> <span class="o">%</span> <span class="n">which</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">get_children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">]</span></div>


<div class="viewcode-block" id="GridLayout"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.GridLayout">[docs]</a><span class="k">class</span> <span class="nc">GridLayout</span><span class="p">(</span><span class="n">Widget</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;A layout manager which arranges its sub-widgets in a grid.</span>

<span class="sd">    The grid spacing is flexible and based on the sizing policies of the</span>
<span class="sd">    contained sub-widgets. If an equidistant grid is needed, the sizing</span>
<span class="sd">    policies of the sub-widgets have to be set equally.</span>

<span class="sd">    The height of each row and the width of each column is derived from the</span>
<span class="sd">    sizing policy of the largest sub-widget in the row or column in question.</span>
<span class="sd">    The algorithm is not very sophisticated, so conflicting sizing policies</span>
<span class="sd">    might not be resolved optimally.</span>
<span class="sd">    &#39;&#39;&#39;</span>

<div class="viewcode-block" id="GridLayout.__init__"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.GridLayout.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">horizontal</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">vertical</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Create new grid layout with ``nx`` columns and ``ny`` rows.&#39;&#39;&#39;</span>

        <span class="n">Widget</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">horizontal</span><span class="p">,</span> <span class="n">vertical</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ny</span><span class="p">):</span>
            <span class="n">row</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nx</span><span class="p">):</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">Widget</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">sub_min_sizes_as_array</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">esh</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[[</span><span class="n">w</span><span class="o">.</span><span class="n">get_min_size</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">num</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="n">esv</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[[</span><span class="n">w</span><span class="o">.</span><span class="n">get_min_size</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">num</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">esh</span><span class="p">,</span> <span class="n">esv</span>

    <span class="k">def</span> <span class="nf">sub_grows_as_array</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">egh</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[[</span><span class="n">w</span><span class="o">.</span><span class="n">get_grow</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">num</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="n">egv</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[[</span><span class="n">w</span><span class="o">.</span><span class="n">get_grow</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">num</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">egh</span><span class="p">,</span> <span class="n">egv</span>

    <span class="k">def</span> <span class="nf">get_min_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sh</span><span class="p">,</span> <span class="n">sv</span> <span class="o">=</span> <span class="n">Widget</span><span class="o">.</span><span class="n">get_min_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">esh</span><span class="p">,</span> <span class="n">esv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_min_sizes_as_array</span><span class="p">()</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sh</span><span class="p">,</span> <span class="n">num</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">esh</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span>
        <span class="n">sv</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sv</span><span class="p">,</span> <span class="n">num</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">esv</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">sh</span><span class="p">,</span> <span class="n">sv</span>

    <span class="k">def</span> <span class="nf">get_grow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ghs</span><span class="p">,</span> <span class="n">gvs</span> <span class="o">=</span> <span class="n">Widget</span><span class="o">.</span><span class="n">get_grow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">egh</span><span class="p">,</span> <span class="n">egv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_grows_as_array</span><span class="p">()</span>
        <span class="n">gh</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">egh</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">*</span><span class="n">ghs</span>
        <span class="n">gv</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">egv</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">gvs</span>
        <span class="k">return</span> <span class="n">gh</span><span class="p">,</span> <span class="n">gv</span>

    <span class="k">def</span> <span class="nf">set_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
        <span class="p">(</span><span class="n">sh</span><span class="p">,</span> <span class="n">sv</span><span class="p">),</span> <span class="p">(</span><span class="n">oh</span><span class="p">,</span> <span class="n">ov</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">legalize</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        <span class="n">esh</span><span class="p">,</span> <span class="n">esv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_min_sizes_as_array</span><span class="p">()</span>
        <span class="n">egh</span><span class="p">,</span> <span class="n">egv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_grows_as_array</span><span class="p">()</span>

        <span class="c"># available additional space</span>
        <span class="n">ah</span> <span class="o">=</span> <span class="n">sh</span> <span class="o">-</span> <span class="n">num</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">esh</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">av</span> <span class="o">=</span> <span class="n">sv</span> <span class="o">-</span> <span class="n">num</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">esv</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ah</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Container not wide enough for contents &quot;</span>
                            <span class="s">&quot;(GridLayout, available: %g cm, needed: %g cm)&quot;</span>
                            <span class="o">%</span> <span class="p">(</span><span class="n">sh</span><span class="o">/</span><span class="n">cm</span><span class="p">,</span> <span class="p">(</span><span class="n">num</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">esh</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span><span class="o">/</span><span class="n">cm</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">av</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Container not high enough for contents &quot;</span>
                            <span class="s">&quot;(GridLayout, available: %g cm, needed: %g cm)&quot;</span>
                            <span class="o">%</span> <span class="p">(</span><span class="n">sv</span><span class="o">/</span><span class="n">cm</span><span class="p">,</span> <span class="p">(</span><span class="n">num</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">esv</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span><span class="o">/</span><span class="n">cm</span><span class="p">))</span>

        <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="n">esh</span><span class="o">.</span><span class="n">shape</span>

        <span class="c"># distribute additional space on rows and columns</span>
        <span class="c"># according to grow weights and minimal sizes</span>
        <span class="n">gsh</span> <span class="o">=</span> <span class="n">egh</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)[:,</span> <span class="n">num</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">ny</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">nesh</span> <span class="o">=</span> <span class="n">esh</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">nesh</span> <span class="o">+=</span> <span class="n">num</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">gsh</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">ah</span><span class="o">*</span><span class="n">egh</span><span class="o">/</span><span class="n">gsh</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">nsh</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">nesh</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">esh</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

        <span class="n">gsv</span> <span class="o">=</span> <span class="n">egv</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="n">num</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">nesv</span> <span class="o">=</span> <span class="n">esv</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">nesv</span> <span class="o">+=</span> <span class="n">num</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">gsv</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">av</span><span class="o">*</span><span class="n">egv</span><span class="o">/</span><span class="n">gsv</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">nsv</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">nesv</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">esv</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

        <span class="n">ah</span> <span class="o">=</span> <span class="n">sh</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">nsh</span><span class="p">)</span>
        <span class="n">av</span> <span class="o">=</span> <span class="n">sv</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">nsv</span><span class="p">)</span>

        <span class="n">oh</span> <span class="o">+=</span> <span class="n">ah</span><span class="o">/</span><span class="mf">2.</span>
        <span class="n">ov</span> <span class="o">+=</span> <span class="n">av</span><span class="o">/</span><span class="mf">2.</span>
        <span class="n">sh</span> <span class="o">-=</span> <span class="n">ah</span>
        <span class="n">sv</span> <span class="o">-=</span> <span class="n">av</span>

        <span class="c"># resize child widgets</span>
        <span class="n">neov</span> <span class="o">=</span> <span class="n">ov</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">nsv</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="n">nesv</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">nsv</span><span class="p">):</span>
            <span class="n">neov</span> <span class="o">-=</span> <span class="n">nesv</span>
            <span class="n">neoh</span> <span class="o">=</span> <span class="n">oh</span>
            <span class="k">for</span> <span class="n">w</span><span class="p">,</span> <span class="n">nesh</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">nsh</span><span class="p">):</span>
                <span class="n">w</span><span class="o">.</span><span class="n">set_size</span><span class="p">((</span><span class="n">nesh</span><span class="p">,</span> <span class="n">nesv</span><span class="p">),</span> <span class="p">(</span><span class="n">neoh</span><span class="p">,</span> <span class="n">neov</span><span class="p">))</span>
                <span class="n">neoh</span> <span class="o">+=</span> <span class="n">nesh</span>

        <span class="n">Widget</span><span class="o">.</span><span class="n">set_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="n">sh</span><span class="p">,</span> <span class="n">sv</span><span class="p">),</span> <span class="p">(</span><span class="n">oh</span><span class="p">,</span> <span class="n">ov</span><span class="p">))</span>

<div class="viewcode-block" id="GridLayout.set_widget"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.GridLayout.set_widget">[docs]</a>    <span class="k">def</span> <span class="nf">set_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ix</span><span class="p">,</span> <span class="n">iy</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Set one of the sub-widgets.</span>

<span class="sd">        Sets the sub-widget in column ``ix`` and row ``iy``. The indices are</span>
<span class="sd">        counted from zero. &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">widget</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
            <span class="n">widget</span> <span class="o">=</span> <span class="n">Widget</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="n">iy</span><span class="p">][</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">widget</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="GridLayout.get_widget"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.GridLayout.get_widget">[docs]</a>    <span class="k">def</span> <span class="nf">get_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ix</span><span class="p">,</span> <span class="n">iy</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Get one of the sub-widgets.</span>

<span class="sd">        Gets the sub-widget from column ``ix`` and row ``iy``. The indices are</span>
<span class="sd">        counted from zero.&#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="n">iy</span><span class="p">][</span><span class="n">ix</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">get_children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
            <span class="n">children</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">children</span></div>


<span class="k">def</span> <span class="nf">aspect_for_projection</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">gmt</span> <span class="o">=</span> <span class="n">GMT</span><span class="p">()</span>
    <span class="n">gmt</span><span class="o">.</span><span class="n">psbasemap</span><span class="p">(</span><span class="s">&#39;-G0&#39;</span><span class="p">,</span> <span class="n">finish</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">gmt</span><span class="o">.</span><span class="n">bbox</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="n">l</span><span class="p">)</span>


<div class="viewcode-block" id="TableLiner"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.TableLiner">[docs]</a><span class="k">class</span> <span class="nc">TableLiner</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Utility class to turn tables into lines.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_columns</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">in_rows</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_columns</span> <span class="o">=</span> <span class="n">in_columns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_rows</span> <span class="o">=</span> <span class="n">in_rows</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">izip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">in_columns</span><span class="p">):</span>
                <span class="k">yield</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">row</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_rows</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_rows</span><span class="p">:</span>
                <span class="k">yield</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">row</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span></div>


<div class="viewcode-block" id="LineStreamChopper"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.LineStreamChopper">[docs]</a><span class="k">class</span> <span class="nc">LineStreamChopper</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;File-like object to buffer data.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">liner</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chopsize</span> <span class="o">=</span> <span class="k">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">liner</span> <span class="o">=</span> <span class="n">liner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chop_iterator</span> <span class="o">=</span> <span class="k">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closed</span> <span class="o">=</span> <span class="k">False</span>

    <span class="k">def</span> <span class="nf">_chopiter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">buf</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">liner</span><span class="p">:</span>
            <span class="n">buf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="n">buflen</span> <span class="o">=</span> <span class="n">buf</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chopsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span> <span class="ow">and</span> <span class="n">buflen</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chopsize</span><span class="p">:</span>
                <span class="n">buf</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">while</span> <span class="n">buf</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">buflen</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">chopsize</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">buf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chopsize</span><span class="p">)</span>

                <span class="n">newbuf</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
                <span class="n">newbuf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">buf</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                <span class="n">buf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="n">buf</span> <span class="o">=</span> <span class="n">newbuf</span>

        <span class="k">yield</span><span class="p">(</span><span class="n">buf</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
        <span class="n">buf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Cannot read from closed LineStreamChopper.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chop_iterator</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chopsize</span> <span class="o">=</span> <span class="n">size</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chop_iterator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chopiter</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">chopsize</span> <span class="o">=</span> <span class="n">size</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chop_iterator</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chopsize</span> <span class="o">=</span> <span class="k">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chop_iterator</span> <span class="o">=</span> <span class="k">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closed</span> <span class="o">=</span> <span class="k">True</span>

    <span class="k">def</span> <span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="GMT"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.GMT">[docs]</a><span class="k">class</span> <span class="nc">GMT</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;A thin wrapper to GMT command execution.</span>

<span class="sd">    A dict ``config`` may be given to override some of the default GMT</span>
<span class="sd">    parameters. The ``version`` argument may be used to select a specific GMT</span>
<span class="sd">    version, which should be used with this GMT instance. The selected</span>
<span class="sd">    version of GMT has to be installed on the system, must be supported by</span>
<span class="sd">    gmtpy and gmtpy must know where to find it.</span>

<span class="sd">    Each instance of this class is used for the task of producing one PS or PDF</span>
<span class="sd">    output file.</span>

<span class="sd">    Output of a series of GMT commands is accumulated in memory and can then be</span>
<span class="sd">    saved as PS or PDF file using the :py:meth:`save` method.</span>

<span class="sd">    GMT commands are accessed as method calls to instances of this class. See</span>
<span class="sd">    the :py:meth:`__getattr__` method for details on how the method&#39;s</span>
<span class="sd">    arguments are translated into options and arguments for the GMT command.</span>

<span class="sd">    Associated with each instance of this class, a temporary directory is</span>
<span class="sd">    created, where temporary files may be created, and which is automatically</span>
<span class="sd">    deleted, when the object is destroyed. The :py:meth:`tempfilename` method</span>
<span class="sd">    may be used to get a random filename in the instance&#39;s temporary directory.</span>

<span class="sd">    Any .gmtdefaults files are ignored. The GMT class uses a fixed</span>
<span class="sd">    set of defaults, which may be altered via an argument to the constructor.</span>
<span class="sd">    If possible, GMT is run in &#39;isolation mode&#39;, which was introduced with GMT</span>
<span class="sd">    version 4.2.2, by setting `GMT_TMPDIR` to the instance&#39;s  temporary</span>
<span class="sd">    directory.  With earlier versions of GMT, problems may arise with parallel</span>
<span class="sd">    execution of more than one GMT instance.</span>

<span class="sd">    Each instance of the GMT class may pick a specific version of GMT which</span>
<span class="sd">    shall be used, so that, if multiple versions of GMT are installed on the</span>
<span class="sd">    system, different versions of GMT can be used simultaneously such that</span>
<span class="sd">    backward compatibility of the scripts can be maintained.</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">kontinue</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s">&#39;newest&#39;</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">installation</span> <span class="o">=</span> <span class="n">get_gmt_installation</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gmt_config</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">installation</span><span class="p">[</span><span class="s">&#39;defaults&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">config</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gmt_config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tempdir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;gmtpy-&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gmt_config_filename</span> <span class="o">=</span> <span class="n">pjoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tempdir</span><span class="p">,</span> <span class="s">&#39;gmtdefaults&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gen_gmt_config_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gmt_config_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gmt_config</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kontinue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_unfinished</span><span class="p">(</span><span class="n">kontinue</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">needstart</span> <span class="o">=</span> <span class="k">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">needstart</span> <span class="o">=</span> <span class="k">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">finished</span> <span class="o">=</span> <span class="k">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">environ</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;GMTHOME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">installation</span><span class="p">[</span><span class="s">&#39;home&#39;</span><span class="p">]</span>
        <span class="c"># GMT isolation mode: works only properly with GMT version &gt;= 4.2.2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;GMT_TMPDIR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tempdir</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="k">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">command_log</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keep_temp_dir</span> <span class="o">=</span> <span class="k">False</span>

    <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gmt_config</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">to_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">string</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="n">unit</span> <span class="o">=</span> <span class="n">string</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">unit</span> <span class="ow">in</span> <span class="n">_units</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">string</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">_units</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">default_unit</span> <span class="o">=</span> <span class="n">gmt</span><span class="o">.</span><span class="n">gmt_config</span><span class="p">[</span><span class="s">&#39;MEASURE_UNIT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="o">/</span><span class="n">_units</span><span class="p">[</span><span class="n">default_unit</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">gen_gmt_config_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_filename</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;%s = %s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">shutil</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep_temp_dir</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tempdir</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_gmtcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="o">*</span><span class="n">addargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Execute arbitrary GMT command.</span>

<span class="sd">        See docstring in __getattr__ for details.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">in_stream</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;in_stream&#39;</span><span class="p">,</span> <span class="k">None</span><span class="p">)</span>
        <span class="n">in_filename</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;in_filename&#39;</span><span class="p">,</span> <span class="k">None</span><span class="p">)</span>
        <span class="n">in_string</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;in_string&#39;</span><span class="p">,</span> <span class="k">None</span><span class="p">)</span>
        <span class="n">in_columns</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;in_columns&#39;</span><span class="p">,</span> <span class="k">None</span><span class="p">)</span>
        <span class="n">in_rows</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;in_rows&#39;</span><span class="p">,</span> <span class="k">None</span><span class="p">)</span>
        <span class="n">out_stream</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;out_stream&#39;</span><span class="p">,</span> <span class="k">None</span><span class="p">)</span>
        <span class="n">out_filename</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;out_filename&#39;</span><span class="p">,</span> <span class="k">None</span><span class="p">)</span>
        <span class="n">out_discard</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;out_discard&#39;</span><span class="p">,</span> <span class="k">None</span><span class="p">)</span>
        <span class="n">finish</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;finish&#39;</span><span class="p">,</span> <span class="k">False</span><span class="p">)</span>
        <span class="n">suppressdefaults</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;suppress_defaults&#39;</span><span class="p">,</span> <span class="k">False</span><span class="p">)</span>
        <span class="n">config_override</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;config&#39;</span><span class="p">,</span> <span class="k">None</span><span class="p">)</span>

        <span class="k">assert</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="p">)</span>

        <span class="c"># check for mutual exclusiveness on input and output possibilities</span>
        <span class="k">assert</span><span class="p">(</span><span class="mi">1</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span>
            <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="n">in_stream</span><span class="p">,</span> <span class="n">in_filename</span><span class="p">,</span> <span class="n">in_string</span><span class="p">,</span> <span class="n">in_columns</span><span class="p">,</span> <span class="n">in_rows</span><span class="p">]</span>
             <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">]))</span>
        <span class="k">assert</span><span class="p">(</span><span class="mi">1</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">out_stream</span><span class="p">,</span> <span class="n">out_filename</span><span class="p">,</span> <span class="n">out_discard</span><span class="p">]</span>
                         <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">]))</span>

        <span class="n">gmt_config_filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gmt_config_filename</span>
        <span class="k">if</span> <span class="n">config_override</span><span class="p">:</span>
            <span class="n">gmt_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gmt_config</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">gmt_config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">config_override</span><span class="p">)</span>
            <span class="n">gmt_config_override_filename</span> <span class="o">=</span> <span class="n">pjoin</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tempdir</span><span class="p">,</span> <span class="s">&#39;gmtdefaults_override&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gen_gmt_config_file</span><span class="p">(</span><span class="n">gmt_config_override_filename</span><span class="p">,</span> <span class="n">gmt_config</span><span class="p">)</span>
            <span class="n">gmt_config_filename</span> <span class="o">=</span> <span class="n">gmt_config_override_filename</span>

        <span class="n">options</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">out_discard</span><span class="p">:</span>
            <span class="n">out_filename</span> <span class="o">=</span> <span class="s">&#39;/dev/null&#39;</span>

        <span class="n">out_mustclose</span> <span class="o">=</span> <span class="k">False</span>
        <span class="k">if</span> <span class="n">out_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
            <span class="n">out_mustclose</span> <span class="o">=</span> <span class="k">True</span>
            <span class="n">out_stream</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">in_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
            <span class="n">in_stream</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">in_filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">in_string</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
            <span class="n">in_stream</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span><span class="n">in_string</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">in_columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span> <span class="ow">or</span> <span class="n">in_rows</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
            <span class="n">in_stream</span> <span class="o">=</span> <span class="n">LineStreamChopper</span><span class="p">(</span><span class="n">TableLiner</span><span class="p">(</span><span class="n">in_columns</span><span class="o">=</span><span class="n">in_columns</span><span class="p">,</span>
                                                     <span class="n">in_rows</span><span class="o">=</span><span class="n">in_rows</span><span class="p">))</span>

        <span class="c"># convert option arguments to strings</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Found illegal keyword argument &quot;%s&quot; &#39;</span>
                                <span class="s">&#39;while preparing options for command &quot;%s&quot;&#39;</span>
                                <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">command</span><span class="p">))</span>

            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
                    <span class="n">options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;-%s&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                <span class="n">options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;-%s&#39;</span> <span class="o">%</span> <span class="n">k</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;-%s%s&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span>

        <span class="c"># if not redirecting to an external sink, handle -K -O</span>
        <span class="k">if</span> <span class="n">out_stream</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">finish</span><span class="p">:</span>
                <span class="n">options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;-K&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">finished</span> <span class="o">=</span> <span class="k">True</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">needstart</span><span class="p">:</span>
                <span class="n">options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;-O&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">needstart</span> <span class="o">=</span> <span class="k">False</span>

            <span class="n">out_stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span>

        <span class="c"># run the command</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">pjoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">installation</span><span class="p">[</span><span class="s">&#39;bin&#39;</span><span class="p">],</span> <span class="n">command</span><span class="p">)]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;No such file: %s&#39;</span> <span class="o">%</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">args</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
        <span class="n">args</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">addargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">suppressdefaults</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;+&#39;</span><span class="o">+</span><span class="n">gmt_config_filename</span><span class="p">)</span>

        <span class="n">bs</span> <span class="o">=</span> <span class="mi">2048</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                             <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">bufsize</span><span class="o">=</span><span class="n">bs</span><span class="p">,</span>
                             <span class="n">env</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>
        <span class="k">while</span> <span class="k">True</span><span class="p">:</span>
            <span class="n">cr</span><span class="p">,</span> <span class="n">cw</span><span class="p">,</span> <span class="n">cx</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">stdout</span><span class="p">],</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">stdin</span><span class="p">],</span> <span class="p">[])</span>
            <span class="k">if</span> <span class="n">cr</span><span class="p">:</span>
                <span class="n">out_stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">bs</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">cw</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">in_stream</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">in_stream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">bs</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cr</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">cw</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="n">p</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">while</span> <span class="k">True</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">bs</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">out_stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">retcode</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">in_stream</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
            <span class="n">in_stream</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">out_mustclose</span><span class="p">:</span>
            <span class="n">out_stream</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">retcode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">keep_temp_dir</span> <span class="o">=</span> <span class="k">True</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Command %s returned an error. &#39;</span>
                            <span class="s">&#39;While executing command:</span><span class="se">\n</span><span class="s">%s&#39;</span>
                            <span class="o">%</span> <span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">escape_shell_args</span><span class="p">(</span><span class="n">args</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">command_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

<div class="viewcode-block" id="GMT.__getattr__"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.GMT.__getattr__">[docs]</a>    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Maps to call self._gmtcommand(command, \*addargs, \*\*kwargs).</span>

<span class="sd">        Execute arbitrary GMT command.</span>

<span class="sd">        Run a GMT command and by default append its postscript output to the</span>
<span class="sd">        output file maintained by the GMT instance on which this method is</span>
<span class="sd">        called.</span>

<span class="sd">        Except for a few keyword arguments listed below, any ``kwargs`` and</span>
<span class="sd">        ``addargs`` are converted into command line options and arguments and</span>
<span class="sd">        passed to the GMT command. Numbers in keyword arguments are converted</span>
<span class="sd">        into strings. E.g. ``S=10`` is translated into ``&#39;-S10&#39;``. Tuples of</span>
<span class="sd">        numbers or strings are converted into strings where the elements of the</span>
<span class="sd">        tuples are separated by slashes &#39;/&#39;. E.g. ``R=(10, 10, 20, 20)`` is</span>
<span class="sd">        translated into ``&#39;-R10/10/20/20&#39;``. Options with a boolean argument</span>
<span class="sd">        are only appended to the GMT command, if their values are True.</span>

<span class="sd">        If no output redirection is in effect, the -K and -O options are</span>
<span class="sd">        handled by gmtpy and thus should not be specified. Use</span>
<span class="sd">        ``out_discard=True`` if you don&#39;t want -K or -O beeing added, but are</span>
<span class="sd">        not interested in the output.</span>

<span class="sd">        The standard input of the GMT process is fed by data selected with one</span>
<span class="sd">        of the following ``in_*`` keyword arguments:</span>

<span class="sd">        =============== =======================================================</span>
<span class="sd">        ``in_stream``   Data is read from an open file like object.</span>
<span class="sd">        ``in_filename`` Data is read from the given file.</span>
<span class="sd">        ``in_string``   String content is dumped to the process.</span>
<span class="sd">        ``in_columns``  A 2D nested iterable whose elements can be accessed as</span>
<span class="sd">                        ``in_columns[icolumn][irow]`` is converted into an</span>
<span class="sd">                        ascii</span>
<span class="sd">                        table, which is fed to the process.</span>
<span class="sd">        ``in_rows``     A 2D nested iterable whos elements can be accessed as</span>
<span class="sd">                        ``in_rows[irow][icolumn]`` is converted into an ascii</span>
<span class="sd">                        table, which is fed to the process.</span>
<span class="sd">        =============== =======================================================</span>

<span class="sd">        The standard output of the GMT process may be redirected by one of the</span>
<span class="sd">        following options:</span>

<span class="sd">        ================= =====================================================</span>
<span class="sd">        ``out_stream``    Output is fed to an open file like object.</span>
<span class="sd">        ``out_filename``  Output is dumped to the given file.</span>
<span class="sd">        ``out_discard``   If True, output is dumped to :file:`/dev/null`.</span>
<span class="sd">        ================= =====================================================</span>

<span class="sd">        Additional keyword arguments:</span>

<span class="sd">        ===================== =================================================</span>
<span class="sd">        ``config``            Dict with GMT defaults which override the</span>
<span class="sd">                              currently active set of defaults exclusively</span>
<span class="sd">                              during this call.</span>
<span class="sd">        ``finish``            If True, the postscript file, which is maintained</span>
<span class="sd">                              by the GMT instance is finished, and no further</span>
<span class="sd">                              plotting is allowed.</span>
<span class="sd">        ``suppress_defaults`` Suppress appending of the ``&#39;+gmtdefaults&#39;``</span>
<span class="sd">                              option to the command.</span>
<span class="sd">        ===================== =================================================</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gmtcommand</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span></div>

<div class="viewcode-block" id="GMT.tempfilename"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.GMT.tempfilename">[docs]</a>    <span class="k">def</span> <span class="nf">tempfilename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get filename for temporary file in the private temp directory.</span>

<span class="sd">           If no ``name`` argument is given, a random name is picked. If</span>
<span class="sd">           ``name`` is given, returns a path ending in that ``name``.&#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="s">&#39;abcdefghijklmnopqrstuvwxyz&#39;</span><span class="p">)</span>
                 <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>

        <span class="n">fn</span> <span class="o">=</span> <span class="n">pjoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tempdir</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fn</span></div>

<div class="viewcode-block" id="GMT.tempfile"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.GMT.tempfile">[docs]</a>    <span class="k">def</span> <span class="nf">tempfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create and open a file in the private temp directory.&#39;&#39;&#39;</span>

        <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tempfilename</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">,</span> <span class="n">fn</span></div>

    <span class="k">def</span> <span class="nf">save_unfinished</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
        <span class="n">out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">load_unfinished</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finished</span> <span class="o">=</span> <span class="k">False</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">inp</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="n">inp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ident</span><span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tempfilename</span><span class="p">(</span><span class="s">&#39;breakpoint-%s&#39;</span> <span class="o">%</span> <span class="n">ident</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_unfinished</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ident</span><span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tempfilename</span><span class="p">(</span><span class="s">&#39;breakpoint-%s&#39;</span> <span class="o">%</span> <span class="n">ident</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_unfinished</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<div class="viewcode-block" id="GMT.save"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.GMT.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">raster_dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
             <span class="n">raster_antialias</span><span class="o">=</span><span class="k">True</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Finish and save figure as PDF, PS or PPM file.</span>

<span class="sd">           If filename ends with ``&#39;.pdf&#39;`` a PDF file is created by piping the</span>
<span class="sd">           GMT output through :program:`epstopdf`.</span>

<span class="sd">           If filename ends with ``&#39;.ppm&#39;`` a PPM file is created by running</span>
<span class="sd">           :program:`epstopdf` and :program:`pdftoppm`. ``raster_dpi``</span>
<span class="sd">           specifies the resolution, which is passed to :program:`pdftoppm`.</span>

<span class="sd">           The bounding box is set according to the values given in</span>
<span class="sd">           ``bbox``.&#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">psxy</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="n">finish</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bbox</span><span class="p">:</span>
            <span class="n">oldbb</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;%%BoundingBox:((\s+\d+){4})&#39;</span><span class="p">)</span>
            <span class="n">newbb</span> <span class="o">=</span> <span class="s">&#39;%%%%BoundingBox: %s&#39;</span> <span class="o">%</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">bbox</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
            <span class="n">tempfn</span> <span class="o">=</span> <span class="n">pjoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tempdir</span><span class="p">,</span> <span class="s">&#39;incomplete&#39;</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">tempfn</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>

        <span class="k">if</span> <span class="n">bbox</span><span class="p">:</span>
            <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">oldbb</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">newbb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
            <span class="n">out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.ppm&#39;</span><span class="p">):</span>
            <span class="n">pdffilename</span> <span class="o">=</span> <span class="n">pjoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tempdir</span><span class="p">,</span> <span class="s">&#39;incomplete.pdf&#39;</span><span class="p">)</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="s">&#39;gmtpy-epstopdf&#39;</span><span class="p">,</span> <span class="s">&#39;--res=300&#39;</span><span class="p">,</span>
                             <span class="s">&#39;--outfile=&#39;</span> <span class="o">+</span> <span class="n">pdffilename</span><span class="p">,</span> <span class="n">tempfn</span><span class="p">])</span>
            <span class="n">interbasefn</span> <span class="o">=</span> <span class="n">pjoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tempdir</span><span class="p">,</span> <span class="s">&#39;incomplete&#39;</span><span class="p">)</span>
            <span class="n">aa</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;-aa&#39;</span><span class="p">,</span> <span class="s">&#39;no&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">raster_antialias</span><span class="p">:</span>
                <span class="n">aa</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;-aa&#39;</span><span class="p">,</span> <span class="s">&#39;yes&#39;</span><span class="p">]</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="s">&#39;pdftoppm&#39;</span><span class="p">,</span> <span class="s">&#39;-r&#39;</span><span class="p">,</span> <span class="s">&#39;%i&#39;</span> <span class="o">%</span> <span class="n">raster_dpi</span><span class="p">]</span> <span class="o">+</span> <span class="n">aa</span> <span class="o">+</span>
                            <span class="p">[</span><span class="n">pdffilename</span><span class="p">,</span> <span class="n">interbasefn</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">interfn</span> <span class="ow">in</span> <span class="p">[</span><span class="n">interbasefn</span><span class="o">+</span><span class="s">&#39;-1.ppm&#39;</span><span class="p">,</span> <span class="n">interbasefn</span><span class="o">+</span><span class="s">&#39;-000001.ppm&#39;</span><span class="p">]:</span>
                <span class="c"># depends on version of pdftoppm</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">interfn</span><span class="p">):</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">interfn</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                    <span class="k">break</span>

        <span class="k">elif</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.pdf&#39;</span><span class="p">):</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="s">&#39;gmtpy-epstopdf&#39;</span><span class="p">,</span> <span class="s">&#39;--res=300&#39;</span><span class="p">,</span>
                             <span class="s">&#39;--outfile=&#39;</span> <span class="o">+</span> <span class="n">filename</span><span class="p">,</span> <span class="n">tempfn</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">tempfn</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">bbox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">find_bb</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;%%BoundingBox:((\s+\d+){4})&#39;</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">find_bb</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
            <span class="n">bb</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
            <span class="k">return</span> <span class="n">bb</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Cannot find bbox&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="GMT.get_command_log"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.GMT.get_command_log">[docs]</a>    <span class="k">def</span> <span class="nf">get_command_log</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get the command log.&#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">command_log</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">com</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">command_log</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">com</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">  &quot;</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">  &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">com</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span>
        <span class="k">return</span> <span class="n">s</span>

<div class="viewcode-block" id="GMT.page_size_points"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.GMT.page_size_points">[docs]</a>    <span class="k">def</span> <span class="nf">page_size_points</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Try to get paper size of output postscript file in points.&#39;&#39;&#39;</span>

        <span class="n">pm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gmt_config</span><span class="p">[</span><span class="s">&#39;PAPER_MEDIA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">pm</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;+&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">pm</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">):</span>
            <span class="n">pm</span> <span class="o">=</span> <span class="n">pm</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">orient</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gmt_config</span><span class="p">[</span><span class="s">&#39;PAGE_ORIENTATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">pm</span> <span class="ow">in</span> <span class="n">all_paper_sizes</span><span class="p">():</span>

            <span class="k">if</span> <span class="n">orient</span> <span class="o">==</span> <span class="s">&#39;portrait&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">get_paper_size</span><span class="p">(</span><span class="n">pm</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">get_paper_size</span><span class="p">(</span><span class="n">pm</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">get_paper_size</span><span class="p">(</span><span class="n">pm</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&#39;custom_([0-9.]+)([cimp]?)x([0-9.]+)([cimp]?)&#39;</span><span class="p">,</span> <span class="n">pm</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
            <span class="n">w</span><span class="p">,</span> <span class="n">uw</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">uh</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
            <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">w</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">uw</span><span class="p">:</span>
                <span class="n">w</span> <span class="o">*=</span> <span class="n">_units</span><span class="p">[</span><span class="n">uw</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">uh</span><span class="p">:</span>
                <span class="n">h</span> <span class="o">*=</span> <span class="n">_units</span><span class="p">[</span><span class="n">uh</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">orient</span> <span class="o">==</span> <span class="s">&#39;portrait&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span>

        <span class="k">return</span> <span class="k">None</span><span class="p">,</span> <span class="k">None</span></div>

<div class="viewcode-block" id="GMT.default_layout"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.GMT.default_layout">[docs]</a>    <span class="k">def</span> <span class="nf">default_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">with_palette</span><span class="o">=</span><span class="k">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get a default layout for the output page.</span>

<span class="sd">        One of three different layouts is choosen, depending on the</span>
<span class="sd">        `PAPER_MEDIA` setting in the GMT configuration dict.</span>

<span class="sd">        If `PAPER_MEDIA` ends with a ``&#39;+&#39;`` (EPS output is selected), a</span>
<span class="sd">        :py:class:`FrameLayout` is centered on the page, whose size is</span>
<span class="sd">        controlled by its center widget&#39;s size plus the margins of the</span>
<span class="sd">        :py:class:`FrameLayout`.</span>

<span class="sd">        If `PAPER_MEDIA` indicates, that a custom page size is wanted by</span>
<span class="sd">        starting with ``&#39;Custom_&#39;``, a :py:class:`FrameLayout` is used to fill</span>
<span class="sd">        the complete page. The center widget&#39;s size is then controlled by the</span>
<span class="sd">        page&#39;s size minus the margins of the :py:class:`FrameLayout`.</span>

<span class="sd">        In any other case, two FrameLayouts are nested, such that the outer</span>
<span class="sd">        layout attaches a 1 cm (printer) margin around the complete page, and</span>
<span class="sd">        the inner FrameLayout&#39;s center widget takes up as much space as</span>
<span class="sd">        possible under the constraint, that an aspect ratio of 1/golden_ratio</span>
<span class="sd">        is preserved.</span>

<span class="sd">        In any case, a reference to the innermost :py:class:`FrameLayout`</span>
<span class="sd">        instance is returned. The top-level layout can be accessed by calling</span>
<span class="sd">        :py:meth:`Widget.get_parent` on the returned layout. &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
            <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">page_size_points</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="k">None</span> <span class="ow">or</span> <span class="n">h</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Can&#39;t determine page size for layout&quot;</span><span class="p">)</span>

            <span class="n">pm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gmt_config</span><span class="p">[</span><span class="s">&#39;PAPER_MEDIA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">with_palette</span><span class="p">:</span>
                <span class="n">palette_layout</span> <span class="o">=</span> <span class="n">GridLayout</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">spacer</span> <span class="o">=</span> <span class="n">palette_layout</span><span class="o">.</span><span class="n">get_widget</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">palette_widget</span> <span class="o">=</span> <span class="n">palette_layout</span><span class="o">.</span><span class="n">get_widget</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">spacer</span><span class="o">.</span><span class="n">set_horizontal</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">cm</span><span class="p">)</span>
                <span class="n">palette_widget</span><span class="o">.</span><span class="n">set_horizontal</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">cm</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">pm</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;+&#39;</span><span class="p">):</span>
                <span class="n">outer</span> <span class="o">=</span> <span class="n">CenterLayout</span><span class="p">()</span>
                <span class="n">outer</span><span class="o">.</span><span class="n">set_policy</span><span class="p">((</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">))</span>
                <span class="n">inner</span> <span class="o">=</span> <span class="n">FrameLayout</span><span class="p">()</span>
                <span class="n">outer</span><span class="o">.</span><span class="n">set_widget</span><span class="p">(</span><span class="n">inner</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">with_palette</span><span class="p">:</span>
                    <span class="n">inner</span><span class="o">.</span><span class="n">set_widget</span><span class="p">(</span><span class="s">&#39;center&#39;</span><span class="p">,</span> <span class="n">palette_layout</span><span class="p">)</span>
                    <span class="n">widget</span> <span class="o">=</span> <span class="n">palette_layout</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">widget</span> <span class="o">=</span> <span class="n">inner</span><span class="o">.</span><span class="n">get_widget</span><span class="p">(</span><span class="s">&#39;center&#39;</span><span class="p">)</span>
                <span class="n">widget</span><span class="o">.</span><span class="n">set_policy</span><span class="p">((</span><span class="n">w</span><span class="o">/</span><span class="n">golden_ratio</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span>
                                  <span class="n">aspect</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="n">golden_ratio</span><span class="p">)</span>
                <span class="n">mw</span> <span class="o">=</span> <span class="mf">3.0</span><span class="o">*</span><span class="n">cm</span>
                <span class="n">inner</span><span class="o">.</span><span class="n">set_fixed_margins</span><span class="p">(</span>
                    <span class="n">mw</span><span class="p">,</span> <span class="n">mw</span><span class="p">,</span> <span class="n">mw</span><span class="o">/</span><span class="n">golden_ratio</span><span class="p">,</span> <span class="n">mw</span><span class="o">/</span><span class="n">golden_ratio</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">inner</span>

            <span class="k">elif</span> <span class="n">pm</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;custom_&#39;</span><span class="p">):</span>
                <span class="n">layout</span> <span class="o">=</span> <span class="n">FrameLayout</span><span class="p">()</span>
                <span class="n">layout</span><span class="o">.</span><span class="n">set_policy</span><span class="p">((</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">))</span>
                <span class="n">mw</span> <span class="o">=</span> <span class="mf">3.0</span><span class="o">*</span><span class="n">cm</span>
                <span class="n">layout</span><span class="o">.</span><span class="n">set_min_margins</span><span class="p">(</span>
                    <span class="n">mw</span><span class="p">,</span> <span class="n">mw</span><span class="p">,</span> <span class="n">mw</span><span class="o">/</span><span class="n">golden_ratio</span><span class="p">,</span> <span class="n">mw</span><span class="o">/</span><span class="n">golden_ratio</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">with_palette</span><span class="p">:</span>
                    <span class="n">layout</span><span class="o">.</span><span class="n">set_widget</span><span class="p">(</span><span class="s">&#39;center&#39;</span><span class="p">,</span> <span class="n">palette_layout</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">layout</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">outer</span> <span class="o">=</span> <span class="n">FrameLayout</span><span class="p">()</span>
                <span class="n">outer</span><span class="o">.</span><span class="n">set_policy</span><span class="p">((</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">))</span>
                <span class="n">outer</span><span class="o">.</span><span class="n">set_fixed_margins</span><span class="p">(</span><span class="mf">1.</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="mf">1.</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="mf">1.</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="mf">1.</span><span class="o">*</span><span class="n">cm</span><span class="p">)</span>

                <span class="n">inner</span> <span class="o">=</span> <span class="n">FrameLayout</span><span class="p">()</span>
                <span class="n">outer</span><span class="o">.</span><span class="n">set_widget</span><span class="p">(</span><span class="s">&#39;center&#39;</span><span class="p">,</span> <span class="n">inner</span><span class="p">)</span>
                <span class="n">mw</span> <span class="o">=</span> <span class="mf">3.0</span><span class="o">*</span><span class="n">cm</span>
                <span class="n">inner</span><span class="o">.</span><span class="n">set_min_margins</span><span class="p">(</span><span class="n">mw</span><span class="p">,</span> <span class="n">mw</span><span class="p">,</span> <span class="n">mw</span><span class="o">/</span><span class="n">golden_ratio</span><span class="p">,</span> <span class="n">mw</span><span class="o">/</span><span class="n">golden_ratio</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">with_palette</span><span class="p">:</span>
                    <span class="n">inner</span><span class="o">.</span><span class="n">set_widget</span><span class="p">(</span><span class="s">&#39;center&#39;</span><span class="p">,</span> <span class="n">palette_layout</span><span class="p">)</span>
                    <span class="n">widget</span> <span class="o">=</span> <span class="n">palette_layout</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">widget</span> <span class="o">=</span> <span class="n">inner</span><span class="o">.</span><span class="n">get_widget</span><span class="p">(</span><span class="s">&#39;center&#39;</span><span class="p">)</span>

                <span class="n">widget</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">golden_ratio</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">inner</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span></div>

<div class="viewcode-block" id="GMT.draw_layout"><a class="viewcode-back" href="../../reference_gmtpy.html#pyrocko.gmtpy.GMT.draw_layout">[docs]</a>    <span class="k">def</span> <span class="nf">draw_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layout</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Use psxy to draw layout; for debugging&#39;&#39;&#39;</span>

        <span class="c"># corners = layout.get_corners(descend=True)</span>
        <span class="n">rects</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">layout</span><span class="o">.</span><span class="n">get_sizes</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">num</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="n">rects_wid</span> <span class="o">=</span> <span class="n">rects</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">rects_hei</span> <span class="o">=</span> <span class="n">rects</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">rects_center_x</span> <span class="o">=</span> <span class="n">rects</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">rects_wid</span><span class="o">*</span><span class="mf">0.5</span>
        <span class="n">rects_center_y</span> <span class="o">=</span> <span class="n">rects</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">rects_hei</span><span class="o">*</span><span class="mf">0.5</span>
        <span class="n">nrects</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rects</span><span class="p">)</span>
        <span class="n">prects</span> <span class="o">=</span> <span class="p">(</span><span class="n">rects_center_x</span><span class="p">,</span> <span class="n">rects_center_y</span><span class="p">,</span> <span class="n">num</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nrects</span><span class="p">),</span>
                  <span class="n">num</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nrects</span><span class="p">),</span> <span class="n">rects_hei</span><span class="p">,</span> <span class="n">rects_wid</span><span class="p">)</span>

        <span class="c"># points = num.array(corners, dtype=num.float)</span>

        <span class="n">cptfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tempfilename</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">makecpt</span><span class="p">(</span>
            <span class="n">C</span><span class="o">=</span><span class="s">&#39;ocean&#39;</span><span class="p">,</span>
            <span class="n">T</span><span class="o">=</span><span class="s">&#39;%g/%g/%g&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="o">-</span><span class="n">nrects</span><span class="p">,</span> <span class="n">nrects</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">Z</span><span class="o">=</span><span class="k">True</span><span class="p">,</span>
            <span class="n">out_filename</span><span class="o">=</span><span class="n">cptfile</span><span class="p">,</span> <span class="n">suppress_defaults</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>

        <span class="n">bb</span> <span class="o">=</span> <span class="n">layout</span><span class="o">.</span><span class="n">bbox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psxy</span><span class="p">(</span>
            <span class="n">in_columns</span><span class="o">=</span><span class="n">prects</span><span class="p">,</span>
            <span class="n">C</span><span class="o">=</span><span class="n">cptfile</span><span class="p">,</span>
            <span class="n">W</span><span class="o">=</span><span class="s">&#39;1p&#39;</span><span class="p">,</span>
            <span class="n">S</span><span class="o">=</span><span class="s">&#39;J&#39;</span><span class="p">,</span>
            <span class="n">R</span><span class="o">=</span><span class="p">(</span><span class="n">bb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bb</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">bb</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bb</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
            <span class="o">*</span><span class="n">layout</span><span class="o">.</span><span class="n">XYJ</span><span class="p">())</span></div></div>


<span class="k">def</span> <span class="nf">simpleconf_to_ax</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">axname</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">axname</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">axname</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;label&#39;</span><span class="p">,</span> <span class="s">&#39;unit&#39;</span><span class="p">,</span> <span class="s">&#39;scaled_unit&#39;</span><span class="p">,</span> <span class="s">&#39;scaled_unit_factor&#39;</span><span class="p">,</span>
                  <span class="s">&#39;space&#39;</span><span class="p">,</span> <span class="s">&#39;mode&#39;</span><span class="p">,</span> <span class="s">&#39;approx_ticks&#39;</span><span class="p">,</span> <span class="s">&#39;limits&#39;</span><span class="p">,</span> <span class="s">&#39;masking&#39;</span><span class="p">,</span> <span class="s">&#39;inc&#39;</span><span class="p">,</span>
                  <span class="s">&#39;snap&#39;</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">x</span><span class="o">+</span><span class="n">k</span> <span class="ow">in</span> <span class="n">conf</span><span class="p">:</span>
                <span class="n">c</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="n">k</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">Ax</span><span class="p">(</span><span class="o">**</span><span class="n">c</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DensityPlotDef</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">cpt</span><span class="o">=</span><span class="s">&#39;ocean&#39;</span><span class="p">,</span> <span class="n">tension</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">640</span><span class="p">,</span> <span class="mi">480</span><span class="p">),</span>
                 <span class="n">contour</span><span class="o">=</span><span class="k">False</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;surface&#39;</span><span class="p">,</span> <span class="n">zscaler</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpt</span> <span class="o">=</span> <span class="n">cpt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tension</span> <span class="o">=</span> <span class="n">tension</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contour</span> <span class="o">=</span> <span class="n">contour</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zscaler</span> <span class="o">=</span> <span class="n">zscaler</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extra</span> <span class="o">=</span> <span class="n">extra</span>


<span class="k">class</span> <span class="nc">TextDef</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="s">&#39;MC&#39;</span><span class="p">,</span> <span class="n">fontno</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">justify</span> <span class="o">=</span> <span class="n">justify</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fontno</span> <span class="o">=</span> <span class="n">fontno</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span>


<span class="k">class</span> <span class="nc">Simple</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gmtconfig</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="o">**</span><span class="n">simple_config</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">simple_config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gmtconfig</span> <span class="o">=</span> <span class="n">gmtconfig</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">density_plot_defs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_defs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_x</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symbols_x</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_y</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symbols_y</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">default_config</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mf">15.</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
                          <span class="n">height</span><span class="o">=</span><span class="mf">15.</span><span class="o">*</span><span class="n">cm</span> <span class="o">/</span> <span class="n">golden_ratio</span><span class="p">,</span>
                          <span class="n">margins</span><span class="o">=</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="mf">2.</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="mf">2.</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="mf">2.</span><span class="o">*</span><span class="n">cm</span><span class="p">),</span>
                          <span class="n">with_palette</span><span class="o">=</span><span class="k">False</span><span class="p">,</span>
                          <span class="n">palette_offset</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
                          <span class="n">palette_width</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
                          <span class="n">palette_height</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
                          <span class="n">zlabeloffset</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
                          <span class="n">draw_layout</span><span class="o">=</span><span class="k">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setup_defaults</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">setup_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">set_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">density_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">dpd</span> <span class="o">=</span> <span class="n">DensityPlotDef</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">density_plot_defs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dpd</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">dpd</span> <span class="o">=</span> <span class="n">TextDef</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_defs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dpd</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symbols_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symbols_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setup_base</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conf</span><span class="p">):</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;width&#39;</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;height&#39;</span><span class="p">)</span>
        <span class="n">margins</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;margins&#39;</span><span class="p">)</span>

        <span class="n">gmtconfig</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;PAPER_MEDIA&#39;</span><span class="p">:</span> <span class="s">&#39;Custom_%ix%i&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gmtconfig</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
            <span class="n">gmtconfig</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gmtconfig</span><span class="p">)</span>
        <span class="n">gmt</span> <span class="o">=</span> <span class="n">GMT</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">gmtconfig</span><span class="p">)</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">gmt</span><span class="o">.</span><span class="n">default_layout</span><span class="p">(</span><span class="n">with_palette</span><span class="o">=</span><span class="n">conf</span><span class="p">[</span><span class="s">&#39;with_palette&#39;</span><span class="p">])</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">set_min_margins</span><span class="p">(</span><span class="o">*</span><span class="n">margins</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">conf</span><span class="p">[</span><span class="s">&#39;with_palette&#39;</span><span class="p">]:</span>
            <span class="n">widget</span> <span class="o">=</span> <span class="n">layout</span><span class="o">.</span><span class="n">get_widget</span><span class="p">()</span><span class="o">.</span><span class="n">get_widget</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">spacer</span> <span class="o">=</span> <span class="n">layout</span><span class="o">.</span><span class="n">get_widget</span><span class="p">()</span><span class="o">.</span><span class="n">get_widget</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">spacer</span><span class="o">.</span><span class="n">set_horizontal</span><span class="p">(</span><span class="n">conf</span><span class="p">[</span><span class="s">&#39;palette_offset&#39;</span><span class="p">])</span>
            <span class="n">palette_widget</span> <span class="o">=</span> <span class="n">layout</span><span class="o">.</span><span class="n">get_widget</span><span class="p">()</span><span class="o">.</span><span class="n">get_widget</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">conf</span><span class="p">[</span><span class="s">&#39;palette_width&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
                <span class="n">palette_widget</span><span class="o">.</span><span class="n">set_horizontal</span><span class="p">(</span><span class="n">conf</span><span class="p">[</span><span class="s">&#39;palette_width&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">conf</span><span class="p">[</span><span class="s">&#39;palette_height&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
                <span class="n">palette_widget</span><span class="o">.</span><span class="n">set_vertical</span><span class="p">(</span><span class="n">conf</span><span class="p">[</span><span class="s">&#39;palette_height&#39;</span><span class="p">])</span>
                <span class="n">widget</span><span class="o">.</span><span class="n">set_vertical</span><span class="p">(</span><span class="n">h</span><span class="o">-</span><span class="n">margins</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">margins</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="mf">0.03</span><span class="o">*</span><span class="n">cm</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">gmt</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">palette_widget</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">widget</span> <span class="o">=</span> <span class="n">layout</span><span class="o">.</span><span class="n">get_widget</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">gmt</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="k">None</span>

    <span class="k">def</span> <span class="nf">setup_projection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">scaler</span><span class="p">,</span> <span class="n">conf</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">setup_scaling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conf</span><span class="p">):</span>
        <span class="n">ndims</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">density_plot_defs</span><span class="p">:</span>
            <span class="n">ndims</span> <span class="o">=</span> <span class="mi">3</span>

        <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">simpleconf_to_ax</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="s">&#39;xyz&#39;</span><span class="p">[:</span><span class="n">ndims</span><span class="p">]]</span>

        <span class="n">data_all</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">data_all</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">dsd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">density_plot_defs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dsd</span><span class="o">.</span><span class="n">zscaler</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
                <span class="n">data_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dsd</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dsd</span><span class="o">.</span><span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">data_chopped</span> <span class="o">=</span> <span class="p">[</span><span class="n">ds</span><span class="p">[:</span><span class="n">ndims</span><span class="p">]</span> <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">data_all</span><span class="p">]</span>

        <span class="n">scaler</span> <span class="o">=</span> <span class="n">ScaleGuru</span><span class="p">(</span><span class="n">data_chopped</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">[:</span><span class="n">ndims</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setup_scaling_plus</span><span class="p">(</span><span class="n">scaler</span><span class="p">,</span> <span class="n">axes</span><span class="p">[:</span><span class="n">ndims</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">scaler</span>

    <span class="k">def</span> <span class="nf">setup_scaling_plus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scaler</span><span class="p">,</span> <span class="n">axes</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">setup_scaling_extra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scaler</span><span class="p">,</span> <span class="n">conf</span><span class="p">):</span>

        <span class="n">scaler_x</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scaler</span><span class="p">)</span>
        <span class="n">scaler_x</span><span class="o">.</span><span class="n">data_ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
        <span class="n">scaler_x</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s">&#39;off&#39;</span>

        <span class="n">scaler_y</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scaler</span><span class="p">)</span>
        <span class="n">scaler_y</span><span class="o">.</span><span class="n">data_ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
        <span class="n">scaler_y</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s">&#39;off&#39;</span>

        <span class="k">return</span> <span class="n">scaler_x</span><span class="p">,</span> <span class="n">scaler_y</span>

    <span class="k">def</span> <span class="nf">draw_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gmt</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">scaler</span><span class="p">):</span>

        <span class="n">R</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">R</span><span class="p">()</span>
        <span class="c"># par = scaler.get_params()</span>
        <span class="n">rxyj</span> <span class="o">=</span> <span class="n">R</span> <span class="o">+</span> <span class="n">widget</span><span class="o">.</span><span class="n">XYJ</span><span class="p">()</span>
        <span class="n">innerticks</span> <span class="o">=</span> <span class="k">False</span>
        <span class="k">for</span> <span class="n">dpd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">density_plot_defs</span><span class="p">:</span>

            <span class="n">fn_cpt</span> <span class="o">=</span> <span class="n">gmt</span><span class="o">.</span><span class="n">tempfilename</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">dpd</span><span class="o">.</span><span class="n">zscaler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">dpd</span><span class="o">.</span><span class="n">zscaler</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">scaler</span>

            <span class="n">gmt</span><span class="o">.</span><span class="n">makecpt</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="n">dpd</span><span class="o">.</span><span class="n">cpt</span><span class="p">,</span> <span class="n">out_filename</span><span class="o">=</span><span class="n">fn_cpt</span><span class="p">,</span> <span class="o">*</span><span class="n">s</span><span class="o">.</span><span class="n">T</span><span class="p">())</span>

            <span class="n">fn_grid</span> <span class="o">=</span> <span class="n">gmt</span><span class="o">.</span><span class="n">tempfilename</span><span class="p">()</span>

            <span class="n">fn_mean</span> <span class="o">=</span> <span class="n">gmt</span><span class="o">.</span><span class="n">tempfilename</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">dpd</span><span class="o">.</span><span class="n">method</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;surface&#39;</span><span class="p">,</span> <span class="s">&#39;triangulate&#39;</span><span class="p">):</span>
                <span class="n">gmt</span><span class="o">.</span><span class="n">blockmean</span><span class="p">(</span><span class="n">in_columns</span><span class="o">=</span><span class="n">dpd</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="s">&#39;%i+/%i+&#39;</span> <span class="o">%</span> <span class="n">dpd</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
                              <span class="n">out_filename</span><span class="o">=</span><span class="n">fn_mean</span><span class="p">,</span>  <span class="o">*</span><span class="n">R</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">dpd</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;surface&#39;</span><span class="p">:</span>
                    <span class="n">gmt</span><span class="o">.</span><span class="n">surface</span><span class="p">(</span>
                        <span class="n">in_filename</span><span class="o">=</span><span class="n">fn_mean</span><span class="p">,</span>
                        <span class="n">T</span><span class="o">=</span><span class="n">dpd</span><span class="o">.</span><span class="n">tension</span><span class="p">,</span>
                        <span class="n">G</span><span class="o">=</span><span class="n">fn_grid</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="s">&#39;%i+/%i+&#39;</span> <span class="o">%</span> <span class="n">dpd</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
                        <span class="n">out_discard</span><span class="o">=</span><span class="k">True</span><span class="p">,</span>
                        <span class="o">*</span><span class="n">R</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">dpd</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;triangulate&#39;</span><span class="p">:</span>
                    <span class="n">gmt</span><span class="o">.</span><span class="n">triangulate</span><span class="p">(</span>
                        <span class="n">in_filename</span><span class="o">=</span><span class="n">fn_mean</span><span class="p">,</span>
                        <span class="n">G</span><span class="o">=</span><span class="n">fn_grid</span><span class="p">,</span>
                        <span class="n">I</span><span class="o">=</span><span class="s">&#39;%i+/%i+&#39;</span> <span class="o">%</span> <span class="n">dpd</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
                        <span class="n">out_discard</span><span class="o">=</span><span class="k">True</span><span class="p">,</span>
                        <span class="o">*</span><span class="n">R</span><span class="p">)</span>

                <span class="n">gmt</span><span class="o">.</span><span class="n">grdimage</span><span class="p">(</span><span class="n">fn_grid</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">fn_cpt</span><span class="p">,</span> <span class="n">E</span><span class="o">=</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="s">&#39;l&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">rxyj</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">dpd</span><span class="o">.</span><span class="n">contour</span><span class="p">:</span>
                    <span class="n">gmt</span><span class="o">.</span><span class="n">grdcontour</span><span class="p">(</span><span class="n">fn_grid</span><span class="p">,</span>  <span class="n">C</span><span class="o">=</span><span class="n">fn_cpt</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="s">&#39;0.5p,black&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">rxyj</span><span class="p">)</span>
                    <span class="n">innerticks</span> <span class="o">=</span> <span class="s">&#39;0.5p,black&#39;</span>

                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fn_grid</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fn_mean</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">dpd</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;fillcontour&#39;</span><span class="p">:</span>
                <span class="n">extra</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="n">fn_cpt</span><span class="p">)</span>
                <span class="n">extra</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dpd</span><span class="o">.</span><span class="n">extra</span><span class="p">)</span>
                <span class="n">gmt</span><span class="o">.</span><span class="n">pscontour</span><span class="p">(</span><span class="n">in_columns</span><span class="o">=</span><span class="n">dpd</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="o">*</span><span class="n">rxyj</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">dpd</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;contour&#39;</span><span class="p">:</span>
                <span class="n">extra</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="s">&#39;0.5p,black&#39;</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">fn_cpt</span><span class="p">)</span>
                <span class="n">extra</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dpd</span><span class="o">.</span><span class="n">extra</span><span class="p">)</span>
                <span class="n">gmt</span><span class="o">.</span><span class="n">pscontour</span><span class="p">(</span><span class="n">in_columns</span><span class="o">=</span><span class="n">dpd</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">rxyj</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fn_cpt</span><span class="p">,</span> <span class="n">innerticks</span>

    <span class="k">def</span> <span class="nf">draw_basemap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gmt</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">scaler</span><span class="p">):</span>
        <span class="n">gmt</span><span class="o">.</span><span class="n">psbasemap</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">JXY</span><span class="p">()</span> <span class="o">+</span> <span class="n">scaler</span><span class="o">.</span><span class="n">RB</span><span class="p">(</span><span class="n">ax_projection</span><span class="o">=</span><span class="k">True</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gmt</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">scaler</span><span class="p">):</span>
        <span class="n">rxyj</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">R</span><span class="p">()</span> <span class="o">+</span> <span class="n">widget</span><span class="o">.</span><span class="n">JXY</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">dat</span><span class="p">,</span> <span class="n">sym</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">):</span>
            <span class="n">gmt</span><span class="o">.</span><span class="n">psxy</span><span class="p">(</span><span class="n">in_columns</span><span class="o">=</span><span class="n">dat</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">sym</span><span class="o">.</span><span class="n">split</span><span class="p">()</span><span class="o">+</span><span class="n">rxyj</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">post_draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gmt</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">scaler</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">pre_draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gmt</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">scaler</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">draw_extra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gmt</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">scaler_x</span><span class="p">,</span> <span class="n">scaler_y</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">dat</span><span class="p">,</span> <span class="n">sym</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols_x</span><span class="p">):</span>
            <span class="n">gmt</span><span class="o">.</span><span class="n">psxy</span><span class="p">(</span><span class="n">in_columns</span><span class="o">=</span><span class="n">dat</span><span class="p">,</span>
                     <span class="o">*</span><span class="p">(</span><span class="n">sym</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="o">+</span> <span class="n">scaler_x</span><span class="o">.</span><span class="n">R</span><span class="p">()</span> <span class="o">+</span> <span class="n">widget</span><span class="o">.</span><span class="n">JXY</span><span class="p">()))</span>

        <span class="k">for</span> <span class="n">dat</span><span class="p">,</span> <span class="n">sym</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols_y</span><span class="p">):</span>
            <span class="n">gmt</span><span class="o">.</span><span class="n">psxy</span><span class="p">(</span><span class="n">in_columns</span><span class="o">=</span><span class="n">dat</span><span class="p">,</span>
                     <span class="o">*</span><span class="p">(</span><span class="n">sym</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="o">+</span> <span class="n">scaler_y</span><span class="o">.</span><span class="n">R</span><span class="p">()</span> <span class="o">+</span> <span class="n">widget</span><span class="o">.</span><span class="n">JXY</span><span class="p">()))</span>

    <span class="k">def</span> <span class="nf">draw_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gmt</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">scaler</span><span class="p">):</span>

        <span class="n">rxyj</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">R</span><span class="p">()</span> <span class="o">+</span> <span class="n">widget</span><span class="o">.</span><span class="n">JXY</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">td</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_defs</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">size</span>
            <span class="n">angle</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">fontno</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">fontno</span>
            <span class="n">justify</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">justify</span>
            <span class="n">gmt</span><span class="o">.</span><span class="n">pstext</span><span class="p">(</span><span class="n">in_rows</span><span class="o">=</span><span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">fontno</span><span class="p">,</span> <span class="n">justify</span><span class="p">,</span> <span class="n">text</span><span class="p">)],</span>
                       <span class="n">D</span><span class="o">=</span><span class="s">&#39;%gp/%gp&#39;</span> <span class="o">%</span> <span class="n">td</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span>  <span class="o">*</span><span class="n">rxyj</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">raster_dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">):</span>

        <span class="n">conf</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_config</span><span class="p">)</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>

        <span class="n">gmt</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">palette_widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_base</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
        <span class="n">scaler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_scaling</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
        <span class="n">scaler_x</span><span class="p">,</span> <span class="n">scaler_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_scaling_extra</span><span class="p">(</span><span class="n">scaler</span><span class="p">,</span> <span class="n">conf</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setup_projection</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">scaler</span><span class="p">,</span> <span class="n">conf</span><span class="p">)</span>
        <span class="n">aspect</span> <span class="o">=</span> <span class="n">aspect_for_projection</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">J</span><span class="p">()</span> <span class="o">+</span> <span class="n">scaler</span><span class="o">.</span><span class="n">R</span><span class="p">()))</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="n">aspect</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">conf</span><span class="p">[</span><span class="s">&#39;draw_layout&#39;</span><span class="p">]:</span>
            <span class="n">gmt</span><span class="o">.</span><span class="n">draw_layout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>
        <span class="n">cptfile</span> <span class="o">=</span> <span class="k">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">density_plot_defs</span><span class="p">:</span>
            <span class="n">cptfile</span><span class="p">,</span> <span class="n">innerticks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_density</span><span class="p">(</span><span class="n">gmt</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">scaler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pre_draw</span><span class="p">(</span><span class="n">gmt</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">scaler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">gmt</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">scaler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_draw</span><span class="p">(</span><span class="n">gmt</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">scaler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_extra</span><span class="p">(</span><span class="n">gmt</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">scaler_x</span><span class="p">,</span> <span class="n">scaler_y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_text</span><span class="p">(</span><span class="n">gmt</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">scaler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_basemap</span><span class="p">(</span><span class="n">gmt</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">scaler</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">palette_widget</span> <span class="ow">and</span> <span class="n">cptfile</span><span class="p">:</span>
            <span class="n">nice_palette</span><span class="p">(</span><span class="n">gmt</span><span class="p">,</span> <span class="n">palette_widget</span><span class="p">,</span> <span class="n">scaler</span><span class="p">,</span> <span class="n">cptfile</span><span class="p">,</span>
                         <span class="n">innerticks</span><span class="o">=</span><span class="n">innerticks</span><span class="p">,</span>
                         <span class="n">zlabeloffset</span><span class="o">=</span><span class="n">conf</span><span class="p">[</span><span class="s">&#39;zlabeloffset&#39;</span><span class="p">])</span>

        <span class="n">gmt</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">raster_dpi</span><span class="o">=</span><span class="n">raster_dpi</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">LinLinPlot</span><span class="p">(</span><span class="n">Simple</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">LogLinPlot</span><span class="p">(</span><span class="n">Simple</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setup_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">xmode</span><span class="o">=</span><span class="s">&#39;min-max&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setup_projection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">scaler</span><span class="p">,</span> <span class="n">conf</span><span class="p">):</span>
        <span class="n">widget</span><span class="p">[</span><span class="s">&#39;J&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;-JX%(width)gpl/%(height)gp&#39;</span>
        <span class="n">scaler</span><span class="p">[</span><span class="s">&#39;B&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;-B2:%(xlabel)s:/%(yinc)g:%(ylabel)s:WSen&#39;</span>


<span class="k">class</span> <span class="nc">LinLogPlot</span><span class="p">(</span><span class="n">Simple</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setup_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">ymode</span><span class="o">=</span><span class="s">&#39;min-max&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setup_projection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">scaler</span><span class="p">,</span> <span class="n">conf</span><span class="p">):</span>
        <span class="n">widget</span><span class="p">[</span><span class="s">&#39;J&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;-JX%(width)gp/%(height)gpl&#39;</span>
        <span class="n">scaler</span><span class="p">[</span><span class="s">&#39;B&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;-B%(xinc)g:%(xlabel)s:/2:%(ylabel)s:WSen&#39;</span>


<span class="k">class</span> <span class="nc">LogLogPlot</span><span class="p">(</span><span class="n">Simple</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setup_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;min-max&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setup_projection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">scaler</span><span class="p">,</span> <span class="n">conf</span><span class="p">):</span>
        <span class="n">widget</span><span class="p">[</span><span class="s">&#39;J&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;-JX%(width)gpl/%(height)gpl&#39;</span>
        <span class="n">scaler</span><span class="p">[</span><span class="s">&#39;B&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;-B2:%(xlabel)s:/2:%(ylabel)s:WSen&#39;</span>


<span class="k">class</span> <span class="nc">AziDistPlot</span><span class="p">(</span><span class="n">Simple</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setup_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span>
            <span class="n">height</span><span class="o">=</span><span class="mf">15.</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mf">15.</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
            <span class="n">xmode</span><span class="o">=</span><span class="s">&#39;off&#39;</span><span class="p">,</span>
            <span class="n">xlimits</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">360.</span><span class="p">),</span>
            <span class="n">xinc</span><span class="o">=</span><span class="mf">45.</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setup_projection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">scaler</span><span class="p">,</span> <span class="n">conf</span><span class="p">):</span>
        <span class="n">widget</span><span class="p">[</span><span class="s">&#39;J&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;-JPa%(width)gp&#39;</span>

    <span class="k">def</span> <span class="nf">setup_scaling_plus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scaler</span><span class="p">,</span> <span class="n">axes</span><span class="p">):</span>
        <span class="n">scaler</span><span class="p">[</span><span class="s">&#39;B&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;-B%(xinc)g:%(xlabel)s:/%(yinc)g:%(ylabel)s:N&#39;</span>


<span class="k">class</span> <span class="nc">MPlot</span><span class="p">(</span><span class="n">Simple</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setup_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">xmode</span><span class="o">=</span><span class="s">&#39;min-max&#39;</span><span class="p">,</span> <span class="n">ymode</span><span class="o">=</span><span class="s">&#39;min-max&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setup_projection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">scaler</span><span class="p">,</span> <span class="n">conf</span><span class="p">):</span>
        <span class="n">par</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span>
        <span class="n">lon0</span> <span class="o">=</span> <span class="p">(</span><span class="n">par</span><span class="p">[</span><span class="s">&#39;xmin&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">par</span><span class="p">[</span><span class="s">&#39;xmax&#39;</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>
        <span class="n">lat0</span> <span class="o">=</span> <span class="p">(</span><span class="n">par</span><span class="p">[</span><span class="s">&#39;ymin&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">par</span><span class="p">[</span><span class="s">&#39;ymax&#39;</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>
        <span class="n">sll</span> <span class="o">=</span> <span class="s">&#39;%g/%g&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lon0</span><span class="p">,</span> <span class="n">lat0</span><span class="p">)</span>
        <span class="n">widget</span><span class="p">[</span><span class="s">&#39;J&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;-JM&#39;</span> <span class="o">+</span> <span class="n">sll</span> <span class="o">+</span> <span class="s">&#39;/%(width)gp&#39;</span>
        <span class="n">scaler</span><span class="p">[</span><span class="s">&#39;B&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="s">&#39;-B%(xinc)gg%(xinc)g:%(xlabel)s:/%(yinc)gg%(yinc)g:%(ylabel)s:WSen&#39;</span>


<span class="k">def</span> <span class="nf">nice_palette</span><span class="p">(</span><span class="n">gmt</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">scaleguru</span><span class="p">,</span> <span class="n">cptfile</span><span class="p">,</span> <span class="n">zlabeloffset</span><span class="o">=</span><span class="mf">0.8</span><span class="o">*</span><span class="n">inch</span><span class="p">,</span>
                 <span class="n">innerticks</span><span class="o">=</span><span class="k">True</span><span class="p">):</span>

    <span class="n">par</span> <span class="o">=</span> <span class="n">scaleguru</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span>
    <span class="n">par_ax</span> <span class="o">=</span> <span class="n">scaleguru</span><span class="o">.</span><span class="n">get_params</span><span class="p">(</span><span class="n">ax_projection</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>
    <span class="n">nz_palette</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">height</span><span class="p">()</span><span class="o">/</span><span class="n">inch</span> <span class="o">*</span> <span class="mi">300</span><span class="p">)</span>
    <span class="n">px</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz_palette</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">px</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">pz</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">par</span><span class="p">[</span><span class="s">&#39;zmin&#39;</span><span class="p">],</span> <span class="n">par</span><span class="p">[</span><span class="s">&#39;zmax&#39;</span><span class="p">],</span> <span class="n">nz_palette</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">pdz</span> <span class="o">=</span> <span class="n">pz</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">pz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">palgrdfile</span> <span class="o">=</span> <span class="n">gmt</span><span class="o">.</span><span class="n">tempfilename</span><span class="p">()</span>
    <span class="n">pal_r</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">par</span><span class="p">[</span><span class="s">&#39;zmin&#39;</span><span class="p">],</span> <span class="n">par</span><span class="p">[</span><span class="s">&#39;zmax&#39;</span><span class="p">])</span>
    <span class="n">pal_ax_r</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">par_ax</span><span class="p">[</span><span class="s">&#39;zmin&#39;</span><span class="p">],</span> <span class="n">par_ax</span><span class="p">[</span><span class="s">&#39;zmax&#39;</span><span class="p">])</span>
    <span class="n">gmt</span><span class="o">.</span><span class="n">xyz2grd</span><span class="p">(</span>
        <span class="n">G</span><span class="o">=</span><span class="n">palgrdfile</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="n">pal_r</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">pdz</span><span class="p">),</span> <span class="n">in_columns</span><span class="o">=</span><span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="n">pz</span><span class="p">,</span> <span class="n">pz</span><span class="p">),</span>
        <span class="n">out_discard</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>

    <span class="n">gmt</span><span class="o">.</span><span class="n">grdimage</span><span class="p">(</span><span class="n">palgrdfile</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="n">pal_r</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">cptfile</span><span class="p">,</span> <span class="o">*</span><span class="n">widget</span><span class="o">.</span><span class="n">JXY</span><span class="p">())</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">innerticks</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">tickpen</span> <span class="o">=</span> <span class="n">innerticks</span>
        <span class="n">gmt</span><span class="o">.</span><span class="n">grdcontour</span><span class="p">(</span><span class="n">palgrdfile</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="n">tickpen</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="n">pal_r</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">cptfile</span><span class="p">,</span>
                       <span class="o">*</span><span class="n">widget</span><span class="o">.</span><span class="n">JXY</span><span class="p">())</span>

    <span class="n">negpalwid</span> <span class="o">=</span> <span class="s">&#39;%gp&#39;</span> <span class="o">%</span> <span class="o">-</span><span class="n">widget</span><span class="o">.</span><span class="n">width</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">innerticks</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">innerticks</span><span class="p">:</span>
        <span class="n">ticklen</span> <span class="o">=</span> <span class="n">negpalwid</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ticklen</span> <span class="o">=</span> <span class="s">&#39;0p&#39;</span>
    <span class="n">gmt</span><span class="o">.</span><span class="n">psbasemap</span><span class="p">(</span>
        <span class="n">R</span><span class="o">=</span><span class="n">pal_ax_r</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="s">&#39;4::/%(zinc)g::nsw&#39;</span> <span class="o">%</span> <span class="n">par_ax</span><span class="p">,</span>
        <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;TICK_LENGTH&#39;</span><span class="p">:</span> <span class="n">ticklen</span><span class="p">},</span>
        <span class="o">*</span><span class="n">widget</span><span class="o">.</span><span class="n">JXY</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">innerticks</span><span class="p">:</span>
        <span class="n">gmt</span><span class="o">.</span><span class="n">psbasemap</span><span class="p">(</span>
            <span class="n">R</span><span class="o">=</span><span class="n">pal_ax_r</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="s">&#39;4::/%(zinc)g::E&#39;</span> <span class="o">%</span> <span class="n">par_ax</span><span class="p">,</span>
            <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;TICK_LENGTH&#39;</span><span class="p">:</span> <span class="s">&#39;0p&#39;</span><span class="p">},</span>
            <span class="o">*</span><span class="n">widget</span><span class="o">.</span><span class="n">JXY</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">gmt</span><span class="o">.</span><span class="n">psbasemap</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">pal_ax_r</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="s">&#39;4::/%(zinc)g::E&#39;</span> <span class="o">%</span> <span class="n">par_ax</span><span class="p">,</span> <span class="o">*</span><span class="n">widget</span><span class="o">.</span><span class="n">JXY</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">par_ax</span><span class="p">[</span><span class="s">&#39;zlabel&#39;</span><span class="p">]:</span>
        <span class="n">label_font</span> <span class="o">=</span> <span class="n">gmt</span><span class="o">.</span><span class="n">gmt_config</span><span class="p">[</span><span class="s">&#39;LABEL_FONT&#39;</span><span class="p">]</span>
        <span class="n">label_font_size</span> <span class="o">=</span> <span class="n">gmt</span><span class="o">.</span><span class="n">to_points</span><span class="p">(</span><span class="n">gmt</span><span class="o">.</span><span class="n">gmt_config</span><span class="p">[</span><span class="s">&#39;LABEL_FONT_SIZE&#39;</span><span class="p">])</span>
        <span class="n">label_offset</span> <span class="o">=</span> <span class="n">zlabeloffset</span>
        <span class="n">gmt</span><span class="o">.</span><span class="n">pstext</span><span class="p">(</span>
            <span class="n">R</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">D</span><span class="o">=</span><span class="s">&quot;%gp/0p&quot;</span> <span class="o">%</span> <span class="n">label_offset</span><span class="p">,</span>
            <span class="n">N</span><span class="o">=</span><span class="k">True</span><span class="p">,</span>
            <span class="n">in_rows</span><span class="o">=</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">label_font_size</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="n">label_font</span><span class="p">,</span> <span class="s">&#39;CB&#39;</span><span class="p">,</span>
                     <span class="n">par_ax</span><span class="p">[</span><span class="s">&#39;zlabel&#39;</span><span class="p">])],</span>
            <span class="o">*</span><span class="n">widget</span><span class="o">.</span><span class="n">JXY</span><span class="p">())</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="n">examples_dir</span> <span class="o">=</span> <span class="s">&#39;gmtpy_module_examples&#39;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">examples_dir</span><span class="p">):</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">examples_dir</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">examples_dir</span><span class="p">)</span>

    <span class="c"># Example 1</span>

    <span class="n">gmt</span> <span class="o">=</span> <span class="n">GMT</span><span class="p">()</span>
    <span class="n">gmt</span><span class="o">.</span><span class="n">pscoast</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="s">&#39;E32/30/170/8i&#39;</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="s">&#39;10g10&#39;</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
                <span class="n">S</span><span class="o">=</span><span class="p">(</span><span class="mi">114</span><span class="p">,</span> <span class="mi">159</span><span class="p">,</span> <span class="mi">207</span><span class="p">),</span> <span class="n">G</span><span class="o">=</span><span class="p">(</span><span class="mi">233</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">110</span><span class="p">),</span> <span class="n">W</span><span class="o">=</span><span class="s">&#39;thinnest&#39;</span><span class="p">)</span>
    <span class="n">gmt</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">pjoin</span><span class="p">(</span><span class="n">examples_dir</span><span class="p">,</span> <span class="s">&#39;example1.pdf&#39;</span><span class="p">))</span>
    <span class="n">gmt</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">pjoin</span><span class="p">(</span><span class="n">examples_dir</span><span class="p">,</span> <span class="s">&#39;example1.ps&#39;</span><span class="p">))</span>

    <span class="c"># Example 2</span>

    <span class="n">gmt</span> <span class="o">=</span> <span class="n">GMT</span><span class="p">(</span>
        <span class="n">config</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">PAPER_MEDIA</span><span class="o">=</span><span class="s">&#39;Custom_%ix%i&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">7</span><span class="o">*</span><span class="n">inch</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="mi">7</span><span class="o">*</span><span class="n">inch</span><span class="p">))))</span>

    <span class="n">gmt</span><span class="o">.</span><span class="n">pscoast</span><span class="p">(</span>
        <span class="n">R</span><span class="o">=</span><span class="s">&#39;g&#39;</span><span class="p">,</span>
        <span class="n">J</span><span class="o">=</span><span class="s">&#39;E%g/%g/%g/%gi&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">160.</span><span class="p">,</span> <span class="mf">6.</span><span class="p">),</span>
        <span class="n">B</span><span class="o">=</span><span class="s">&#39;0g0&#39;</span><span class="p">,</span>
        <span class="n">D</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">,</span>
        <span class="n">A</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
        <span class="n">S</span><span class="o">=</span><span class="p">(</span><span class="mi">114</span><span class="p">,</span> <span class="mi">159</span><span class="p">,</span> <span class="mi">207</span><span class="p">),</span>
        <span class="n">G</span><span class="o">=</span><span class="p">(</span><span class="mi">233</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">110</span><span class="p">),</span>
        <span class="n">W</span><span class="o">=</span><span class="s">&#39;thinnest&#39;</span><span class="p">,</span>
        <span class="n">X</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">,</span>
        <span class="n">Y</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">)</span>

    <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">strike</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mf">360.</span>
        <span class="n">dip</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mf">90.</span>
        <span class="n">rake</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mf">360.</span><span class="o">-</span><span class="mf">180.</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mf">180.</span><span class="o">-</span><span class="mf">90.</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mf">360.</span><span class="o">-</span><span class="mf">180.</span>
        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">strike</span><span class="p">,</span> <span class="n">dip</span><span class="p">,</span> <span class="n">rake</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>
                     <span class="s">&#39;%.3g, %.3g, %.3g&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">strike</span><span class="p">,</span> <span class="n">dip</span><span class="p">,</span> <span class="n">rake</span><span class="p">)])</span>
    <span class="n">gmt</span><span class="o">.</span><span class="n">psmeca</span><span class="p">(</span>
        <span class="n">R</span><span class="o">=</span><span class="k">True</span><span class="p">,</span>
        <span class="n">J</span><span class="o">=</span><span class="k">True</span><span class="p">,</span>
        <span class="n">S</span><span class="o">=</span><span class="s">&#39;a0.5&#39;</span><span class="p">,</span>
        <span class="n">in_rows</span><span class="o">=</span><span class="n">rows</span><span class="p">)</span>

    <span class="n">gmt</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">pjoin</span><span class="p">(</span><span class="n">examples_dir</span><span class="p">,</span> <span class="s">&#39;example2.ps&#39;</span><span class="p">))</span>
    <span class="n">gmt</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">pjoin</span><span class="p">(</span><span class="n">examples_dir</span><span class="p">,</span> <span class="s">&#39;example2.pdf&#39;</span><span class="p">))</span>

    <span class="c"># Example 3</span>

    <span class="n">conf</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;PAGE_COLOR&#39;</span><span class="p">:</span> <span class="s">&#39;0/0/0&#39;</span><span class="p">,</span> <span class="s">&#39;BASEMAP_FRAME_RGB&#39;</span><span class="p">:</span> <span class="s">&#39;255/255/255&#39;</span><span class="p">}</span>
    <span class="n">gmt</span> <span class="o">=</span> <span class="n">GMT</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">conf</span><span class="p">)</span>
    <span class="n">widget</span> <span class="o">=</span> <span class="n">gmt</span><span class="o">.</span><span class="n">default_layout</span><span class="p">()</span><span class="o">.</span><span class="n">get_widget</span><span class="p">()</span>
    <span class="n">gmt</span><span class="o">.</span><span class="n">psbasemap</span><span class="p">(</span>
        <span class="n">R</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
        <span class="n">J</span><span class="o">=</span><span class="s">&#39;X%gi/%gi&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
        <span class="n">B</span><span class="o">=</span><span class="s">&#39;1:Time [s]:/1:Amplitude [m]:WSen&#39;</span><span class="p">,</span>
        <span class="n">G</span><span class="o">=</span><span class="s">&#39;100/100/100&#39;</span><span class="p">)</span>

    <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">11</span><span class="p">):</span>
        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="mf">5.</span><span class="p">,</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mf">10.</span><span class="o">-</span><span class="mf">5.</span><span class="p">))</span>

    <span class="n">gmt</span><span class="o">.</span><span class="n">psxy</span><span class="p">(</span><span class="n">in_rows</span><span class="o">=</span><span class="n">rows</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>
    <span class="n">gmt</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">pjoin</span><span class="p">(</span><span class="n">examples_dir</span><span class="p">,</span> <span class="s">&#39;example3.pdf&#39;</span><span class="p">))</span>

    <span class="c"># Example 4</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">9</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">num</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">9</span>

    <span class="n">xax</span> <span class="o">=</span> <span class="n">Ax</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;Time&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">)</span>
    <span class="n">yax</span> <span class="o">=</span> <span class="n">Ax</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;Amplitude&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">scaled_unit</span><span class="o">=</span><span class="s">&#39;nm&#39;</span><span class="p">,</span>
             <span class="n">scaled_unit_factor</span><span class="o">=</span><span class="mi">1</span><span class="n">e9</span><span class="p">,</span> <span class="n">approx_ticks</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>

    <span class="n">guru</span> <span class="o">=</span> <span class="n">ScaleGuru</span><span class="p">([(</span><span class="n">x</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y2</span><span class="p">)],</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="n">xax</span><span class="p">,</span> <span class="n">yax</span><span class="p">))</span>
    <span class="n">gmt</span> <span class="o">=</span> <span class="n">GMT</span><span class="p">(</span>
        <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;PAPER_MEDIA&#39;</span><span class="p">:</span> <span class="s">&#39;Custom_%ix%i&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">inch</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">inch</span><span class="p">))})</span>
    <span class="n">layout</span> <span class="o">=</span> <span class="n">gmt</span><span class="o">.</span><span class="n">default_layout</span><span class="p">()</span>
    <span class="n">widget</span> <span class="o">=</span> <span class="n">layout</span><span class="o">.</span><span class="n">get_widget</span><span class="p">()</span>

    <span class="n">gmt</span><span class="o">.</span><span class="n">draw_layout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>

    <span class="n">gmt</span><span class="o">.</span><span class="n">psbasemap</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">JXY</span><span class="p">()</span> <span class="o">+</span> <span class="n">guru</span><span class="o">.</span><span class="n">RB</span><span class="p">(</span><span class="n">ax_projection</span><span class="o">=</span><span class="k">True</span><span class="p">)))</span>
    <span class="n">gmt</span><span class="o">.</span><span class="n">psxy</span><span class="p">(</span><span class="n">in_columns</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="o">*</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">JXY</span><span class="p">()</span> <span class="o">+</span> <span class="n">guru</span><span class="o">.</span><span class="n">R</span><span class="p">()))</span>
    <span class="n">gmt</span><span class="o">.</span><span class="n">psxy</span><span class="p">(</span><span class="n">in_columns</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="o">*</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">JXY</span><span class="p">()</span> <span class="o">+</span> <span class="n">guru</span><span class="o">.</span><span class="n">R</span><span class="p">()))</span>
    <span class="n">gmt</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">pjoin</span><span class="p">(</span><span class="n">examples_dir</span><span class="p">,</span> <span class="s">&#39;example4.pdf&#39;</span><span class="p">),</span> <span class="n">bbox</span><span class="o">=</span><span class="n">layout</span><span class="o">.</span><span class="n">bbox</span><span class="p">())</span>
    <span class="n">gmt</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">pjoin</span><span class="p">(</span><span class="n">examples_dir</span><span class="p">,</span> <span class="s">&#39;example4.ps&#39;</span><span class="p">),</span> <span class="n">bbox</span><span class="o">=</span><span class="n">layout</span><span class="o">.</span><span class="n">bbox</span><span class="p">())</span>

    <span class="c"># Example 5</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mi">1</span><span class="n">e9</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="n">axx</span> <span class="o">=</span> <span class="n">Ax</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;Time&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">)</span>
    <span class="n">ayy</span> <span class="o">=</span> <span class="n">Ax</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;Amplitude&#39;</span><span class="p">,</span> <span class="n">scaled_unit</span><span class="o">=</span><span class="s">&#39;cm&#39;</span><span class="p">,</span> <span class="n">scaled_unit_factor</span><span class="o">=</span><span class="mf">100.</span><span class="p">,</span>
             <span class="n">space</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">approx_ticks</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">guru</span> <span class="o">=</span> <span class="n">ScaleGuru</span><span class="p">([(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)],</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="n">axx</span><span class="p">,</span> <span class="n">ayy</span><span class="p">))</span>

    <span class="n">gmt</span> <span class="o">=</span> <span class="n">GMT</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">conf</span><span class="p">)</span>
    <span class="n">layout</span> <span class="o">=</span> <span class="n">gmt</span><span class="o">.</span><span class="n">default_layout</span><span class="p">()</span>
    <span class="n">widget</span> <span class="o">=</span> <span class="n">layout</span><span class="o">.</span><span class="n">get_widget</span><span class="p">()</span>
    <span class="n">gmt</span><span class="o">.</span><span class="n">psbasemap</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">JXY</span><span class="p">()</span> <span class="o">+</span> <span class="n">guru</span><span class="o">.</span><span class="n">RB</span><span class="p">(</span><span class="n">ax_projection</span><span class="o">=</span><span class="k">True</span><span class="p">)))</span>
    <span class="n">gmt</span><span class="o">.</span><span class="n">psxy</span><span class="p">(</span><span class="n">in_columns</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="o">*</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">JXY</span><span class="p">()</span> <span class="o">+</span> <span class="n">guru</span><span class="o">.</span><span class="n">R</span><span class="p">()))</span>
    <span class="n">gmt</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">pjoin</span><span class="p">(</span><span class="n">examples_dir</span><span class="p">,</span> <span class="s">&#39;example5.pdf&#39;</span><span class="p">),</span> <span class="n">bbox</span><span class="o">=</span><span class="n">layout</span><span class="o">.</span><span class="n">bbox</span><span class="p">())</span>

    <span class="c"># Example 6</span>

    <span class="n">gmt</span> <span class="o">=</span> <span class="n">GMT</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;PAPER_MEDIA&#39;</span><span class="p">:</span> <span class="s">&#39;a3&#39;</span><span class="p">})</span>
    <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">GridLayout</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span>

    <span class="n">layout</span> <span class="o">=</span> <span class="n">gmt</span><span class="o">.</span><span class="n">default_layout</span><span class="p">()</span>
    <span class="n">layout</span><span class="o">.</span><span class="n">set_widget</span><span class="p">(</span><span class="s">&#39;center&#39;</span><span class="p">,</span> <span class="n">grid</span><span class="p">)</span>

    <span class="n">widgets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ny</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nx</span><span class="p">):</span>
            <span class="n">inner</span> <span class="o">=</span> <span class="n">FrameLayout</span><span class="p">()</span>
            <span class="n">inner</span><span class="o">.</span><span class="n">set_fixed_margins</span><span class="p">(</span><span class="mf">1.</span><span class="o">*</span><span class="n">cm</span><span class="o">*</span><span class="n">golden_ratio</span><span class="p">,</span> <span class="mf">1.</span><span class="o">*</span><span class="n">cm</span><span class="o">*</span><span class="n">golden_ratio</span><span class="p">,</span>
                                    <span class="mf">1.</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="mf">1.</span><span class="o">*</span><span class="n">cm</span><span class="p">)</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">set_widget</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">iy</span><span class="p">,</span> <span class="n">inner</span><span class="p">)</span>
            <span class="n">inner</span><span class="o">.</span><span class="n">set_vertical</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">iy</span><span class="o">+</span><span class="mf">1.</span><span class="p">))</span>
            <span class="n">widgets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inner</span><span class="o">.</span><span class="n">get_widget</span><span class="p">(</span><span class="s">&#39;center&#39;</span><span class="p">))</span>

    <span class="n">gmt</span><span class="o">.</span><span class="n">draw_layout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">widget</span> <span class="ow">in</span> <span class="n">widgets</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">xax</span> <span class="o">=</span> <span class="n">Ax</span><span class="p">(</span><span class="n">approx_ticks</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">snap</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>
        <span class="n">yax</span> <span class="o">=</span> <span class="n">Ax</span><span class="p">(</span><span class="n">approx_ticks</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">snap</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>
        <span class="n">guru</span> <span class="o">=</span> <span class="n">ScaleGuru</span><span class="p">([(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)],</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="n">xax</span><span class="p">,</span> <span class="n">yax</span><span class="p">))</span>
        <span class="n">gmt</span><span class="o">.</span><span class="n">psbasemap</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">JXY</span><span class="p">()</span> <span class="o">+</span> <span class="n">guru</span><span class="o">.</span><span class="n">RB</span><span class="p">(</span><span class="n">ax_projection</span><span class="o">=</span><span class="k">True</span><span class="p">)))</span>
        <span class="n">gmt</span><span class="o">.</span><span class="n">psxy</span><span class="p">(</span><span class="n">in_columns</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="o">*</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">JXY</span><span class="p">()</span> <span class="o">+</span> <span class="n">guru</span><span class="o">.</span><span class="n">R</span><span class="p">()))</span>

    <span class="n">gmt</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">pjoin</span><span class="p">(</span><span class="n">examples_dir</span><span class="p">,</span> <span class="s">&#39;example6.pdf&#39;</span><span class="p">),</span> <span class="n">bbox</span><span class="o">=</span><span class="n">layout</span><span class="o">.</span><span class="n">bbox</span><span class="p">())</span>
</pre></div>

          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
    &nbsp;
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, The Pyrocko Developers.
    </div>
  </body>
</html>